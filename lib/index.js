!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).LGE=e()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};function e(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}function r(t){return"function"==typeof t}var n=!1,o={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;n=t},get useDeprecatedSynchronousErrorHandling(){return n}};function i(t){setTimeout((function(){throw t}),0)}var s={closed:!0,next:function(t){},error:function(t){if(o.useDeprecatedSynchronousErrorHandling)throw t;i(t)},complete:function(){}},u=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();function c(t){return null!==t&&"object"==typeof t}var a=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),h=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var e;if(!this.closed){var n=this._parentOrParents,o=this._ctorUnsubscribe,i=this._unsubscribe,s=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof t)n.remove(this);else if(null!==n)for(var h=0;h<n.length;++h){n[h].remove(this)}if(r(i)){o&&(this._unsubscribe=void 0);try{i.call(this)}catch(t){e=t instanceof a?l(t.errors):[t]}}if(u(s)){h=-1;for(var f=s.length;++h<f;){var p=s[h];if(c(p))try{p.unsubscribe()}catch(t){e=e||[],t instanceof a?e=e.concat(l(t.errors)):e.push(t)}}}if(e)throw new a(e)}},t.prototype.add=function(e){var r=e;if(!e)return t.EMPTY;switch(typeof e){case"function":r=new t(e);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof t)){var n=r;(r=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var o=r._parentOrParents;if(null===o)r._parentOrParents=this;else if(o instanceof t){if(o===this)return r;r._parentOrParents=[o,this]}else{if(-1!==o.indexOf(this))return r;o.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[r]:i.push(r),r},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function l(t){return t.reduce((function(t,e){return t.concat(e instanceof a?e.errors:e)}),[])}var f=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),p=function(t){function r(e,n,o){var i=t.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=s;break;case 1:if(!e){i.destination=s;break}if("object"==typeof e){e instanceof r?(i.syncErrorThrowable=e.syncErrorThrowable,i.destination=e,e.add(i)):(i.syncErrorThrowable=!0,i.destination=new b(i,e));break}default:i.syncErrorThrowable=!0,i.destination=new b(i,e,n,o)}return i}return e(r,t),r.prototype[f]=function(){return this},r.create=function(t,e,n){var o=new r(t,e,n);return o.syncErrorThrowable=!1,o},r.prototype.next=function(t){this.isStopped||this._next(t)},r.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},r.prototype._next=function(t){this.destination.next(t)},r.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},r}(h),b=function(t){function n(e,n,o,i){var u,c=t.call(this)||this;c._parentSubscriber=e;var a=c;return r(n)?u=n:n&&(u=n.next,o=n.error,i=n.complete,n!==s&&(r((a=Object.create(n)).unsubscribe)&&c.add(a.unsubscribe.bind(a)),a.unsubscribe=c.unsubscribe.bind(c))),c._context=a,c._next=u,c._error=o,c._complete=i,c}return e(n,t),n.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;o.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},n.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,r=o.useDeprecatedSynchronousErrorHandling;if(this._error)r&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):i(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;i(t)}}},n.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var r=function(){return t._complete.call(t._context)};o.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},n.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),o.useDeprecatedSynchronousErrorHandling)throw t;i(t)}},n.prototype.__tryOrSetError=function(t,e,r){if(!o.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(e){return o.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(i(e),!0)}return!1},n.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},n}(p);var d=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function v(t){return t}function y(t){return 0===t.length?v:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var _=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n=this.operator,i=function(t,e,r){if(t){if(t instanceof p)return t;if(t[f])return t[f]()}return t||e||r?new p(t,e,r):new p(s)}(t,e,r);if(n?i.add(n.call(i,this.source)):i.add(this.source||o.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),o.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){o.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),!function(t){for(;t;){var e=t,r=e.closed,n=e.destination,o=e.isStopped;if(r||o)return!1;t=n&&n instanceof p?n:null}return!0}(t)?console.warn(e):t.error(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=g(e))((function(e,n){var o;o=r.subscribe((function(e){try{t(e)}catch(t){n(t),o&&o.unsubscribe()}}),n,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[d]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:y(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=g(t))((function(t,r){var n;e.subscribe((function(t){return n=t}),(function(t){return r(t)}),(function(){return t(n)}))}))},t.create=function(e){return new t(e)},t}();function g(t){if(t||(t=Promise),!t)throw new Error("no Promise impl found");return t}var E=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),w=function(t){function r(e,r){var n=t.call(this)||this;return n.subject=e,n.subscriber=r,n.closed=!1,n}return e(r,t),r.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var r=e.indexOf(this.subscriber);-1!==r&&e.splice(r,1)}}},r}(h),j=function(t){function r(e){var r=t.call(this,e)||this;return r.destination=e,r}return e(r,t),r}(p),S=function(t){function r(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return e(r,t),r.prototype[f]=function(){return new j(this)},r.prototype.lift=function(t){var e=new m(this,this);return e.operator=t,e},r.prototype.next=function(t){if(this.closed)throw new E;if(!this.isStopped)for(var e=this.observers,r=e.length,n=e.slice(),o=0;o<r;o++)n[o].next(t)},r.prototype.error=function(t){if(this.closed)throw new E;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,r=e.length,n=e.slice(),o=0;o<r;o++)n[o].error(t);this.observers.length=0},r.prototype.complete=function(){if(this.closed)throw new E;this.isStopped=!0;for(var t=this.observers,e=t.length,r=t.slice(),n=0;n<e;n++)r[n].complete();this.observers.length=0},r.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},r.prototype._trySubscribe=function(e){if(this.closed)throw new E;return t.prototype._trySubscribe.call(this,e)},r.prototype._subscribe=function(t){if(this.closed)throw new E;return this.hasError?(t.error(this.thrownError),h.EMPTY):this.isStopped?(t.complete(),h.EMPTY):(this.observers.push(t),new w(this,t))},r.prototype.asObservable=function(){var t=new _;return t.source=this,t},r.create=function(t,e){return new m(t,e)},r}(_),m=function(t){function r(e,r){var n=t.call(this)||this;return n.destination=e,n.source=r,n}return e(r,t),r.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},r.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},r.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},r.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):h.EMPTY},r}(S),x=function(t){function r(e){var r=t.call(this)||this;return r._value=e,r}return e(r,t),Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),r.prototype._subscribe=function(e){var r=t.prototype._subscribe.call(this,e);return r&&!r.closed&&e.next(this._value),r},r.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new E;return this._value},r.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},r}(S),O=function(t){function r(e,r){var n=t.call(this,e,r)||this;return n.scheduler=e,n.work=r,n.pending=!1,n}return e(r,t),r.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var r=this.id,n=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(n,r,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(n,this.id,e),this},r.prototype.requestAsyncId=function(t,e,r){return void 0===r&&(r=0),setInterval(t.flush.bind(t,this),r)},r.prototype.recycleAsyncId=function(t,e,r){if(void 0===r&&(r=0),null!==r&&this.delay===r&&!1===this.pending)return e;clearInterval(e)},r.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(t,e);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},r.prototype._execute=function(t,e){var r=!1,n=void 0;try{this.work(t)}catch(t){r=!0,n=!!t&&t||new Error(t)}if(r)return this.unsubscribe(),n},r.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,r=e.actions,n=r.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==n&&r.splice(n,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},r}(function(t){function r(e,r){return t.call(this)||this}return e(r,t),r.prototype.schedule=function(t,e){return this},r}(h)),T=function(){function t(e,r){void 0===r&&(r=t.now),this.SchedulerAction=e,this.now=r}return t.prototype.schedule=function(t,e,r){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(r,e)},t.now=function(){return Date.now()},t}();function A(t){return t&&"function"==typeof t.schedule}var M=function(t){return function(e){for(var r=0,n=t.length;r<n&&!e.closed;r++)e.next(t[r]);e.complete()}};function P(t,e){return new _((function(r){var n=new h,o=0;return n.add(e.schedule((function(){o!==t.length?(r.next(t[o++]),r.closed||n.add(this.schedule())):r.complete()}))),n}))}function I(t,e){return e?P(t,e):new _(M(t))}function R(t){var e=t.error;t.subscriber.error(e)}var k=new(function(t){function r(e,n){void 0===n&&(n=T.now);var o=t.call(this,e,(function(){return r.delegate&&r.delegate!==o?r.delegate.now():n()}))||this;return o.actions=[],o.active=!1,o.scheduled=void 0,o}return e(r,t),r.prototype.schedule=function(e,n,o){return void 0===n&&(n=0),r.delegate&&r.delegate!==this?r.delegate.schedule(e,n,o):t.prototype.schedule.call(this,e,n,o)},r.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var r;this.active=!0;do{if(r=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,r){for(;t=e.shift();)t.unsubscribe();throw r}}},r}(T))(O),C=function(){function t(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return t.prototype=Object.create(Error.prototype),t}();function z(t,e){return function(r){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new $(t,e))}}var $=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new L(t,this.project,this.thisArg))},t}(),L=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.project=r,o.count=0,o.thisArg=n||o,o}return e(r,t),r.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},r}(p),F=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e(r,t),r.prototype.notifyNext=function(t,e,r,n,o){this.destination.next(e)},r.prototype.notifyError=function(t,e){this.destination.error(t)},r.prototype.notifyComplete=function(t){this.destination.complete()},r}(p),V=function(t){function r(e,r,n){var o=t.call(this)||this;return o.parent=e,o.outerValue=r,o.outerIndex=n,o.index=0,o}return e(r,t),r.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},r.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},r}(p);function N(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var D=N(),U=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function q(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var B=function(t){if(t&&"function"==typeof t[d])return n=t,function(t){var e=n[d]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if(U(t))return M(t);if(q(t))return r=t,function(t){return r.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,i),t};if(t&&"function"==typeof t[D])return e=t,function(t){for(var r=e[D]();;){var n=void 0;try{n=r.next()}catch(e){return t.error(e),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}return"function"==typeof r.return&&t.add((function(){r.return&&r.return()})),t};var e,r,n,o=c(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+o+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function H(t,e,r,n,o){if(void 0===o&&(o=new V(t,r,n)),!o.closed)return e instanceof _?e.subscribe(o):B(e)(o)}var G={};var Y=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new K(t,this.resultSelector))},t}(),K=function(t){function r(e,r){var n=t.call(this,e)||this;return n.resultSelector=r,n.active=0,n.values=[],n.observables=[],n}return e(r,t),r.prototype._next=function(t){this.values.push(G),this.observables.push(t)},r.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var r=0;r<e;r++){var n=t[r];this.add(H(this,n,void 0,r))}}},r.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},r.prototype.notifyNext=function(t,e,r){var n=this.values,o=n[r],i=this.toRespond?o===G?--this.toRespond:this.toRespond:0;n[r]=e,0===i&&(this.resultSelector?this._tryResultSelector(n):this.destination.next(n.slice()))},r.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},r}(F);function W(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[d]}(t))return function(t,e){return new _((function(r){var n=new h;return n.add(e.schedule((function(){var o=t[d]();n.add(o.subscribe({next:function(t){n.add(e.schedule((function(){return r.next(t)})))},error:function(t){n.add(e.schedule((function(){return r.error(t)})))},complete:function(){n.add(e.schedule((function(){return r.complete()})))}}))}))),n}))}(t,e);if(q(t))return function(t,e){return new _((function(r){var n=new h;return n.add(e.schedule((function(){return t.then((function(t){n.add(e.schedule((function(){r.next(t),n.add(e.schedule((function(){return r.complete()})))})))}),(function(t){n.add(e.schedule((function(){return r.error(t)})))}))}))),n}))}(t,e);if(U(t))return P(t,e);if(function(t){return t&&"function"==typeof t[D]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new _((function(r){var n,o=new h;return o.add((function(){n&&"function"==typeof n.return&&n.return()})),o.add(e.schedule((function(){n=t[D](),o.add(e.schedule((function(){if(!r.closed){var t,e;try{var o=n.next();t=o.value,e=o.done}catch(t){return void r.error(t)}e?r.complete():(r.next(t),this.schedule())}})))}))),o}))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}var J=function(t){function r(e){var r=t.call(this)||this;return r.parent=e,r}return e(r,t),r.prototype._next=function(t){this.parent.notifyNext(t)},r.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},r}(p),X=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e(r,t),r.prototype.notifyNext=function(t){this.destination.next(t)},r.prototype.notifyError=function(t){this.destination.error(t)},r.prototype.notifyComplete=function(){this.destination.complete()},r}(p);function Q(t,e){return function(r){return r.lift(new Z(t,e))}}var Z=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new tt(t,this.predicate,this.thisArg))},t}(),tt=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.predicate=r,o.thisArg=n,o.count=0,o}return e(r,t),r.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},r}(p);function et(t,e){return function(r){return r.lift(new rt(t,e))}}var rt=function(){function t(t,e){this.compare=t,this.keySelector=e}return t.prototype.call=function(t,e){return e.subscribe(new nt(t,this.compare,this.keySelector))},t}(),nt=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.keySelector=n,o.hasKey=!1,"function"==typeof r&&(o.compare=r),o}return e(r,t),r.prototype.compare=function(t,e){return t===e},r.prototype._next=function(t){var e;try{var r=this.keySelector;e=r?r(t):t}catch(t){return this.destination.error(t)}var n=!1;if(this.hasKey)try{n=(0,this.compare)(this.key,e)}catch(t){return this.destination.error(t)}else this.hasKey=!0;n||(this.key=e,this.destination.next(t))},r}(p);function ot(t,e,r){return void 0===r&&(r=k),function(n){var o,i=(o=t)instanceof Date&&!isNaN(+o),s=i?+t-r.now():Math.abs(t);return n.lift(new it(s,i,e,r))}}var it=function(){function t(t,e,r,n){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=r,this.scheduler=n}return t.prototype.call=function(t,e){return e.subscribe(new st(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},t}(),st=function(t){function r(e,r,n,o,i){var s=t.call(this,e)||this;return s.absoluteTimeout=r,s.waitFor=n,s.withObservable=o,s.scheduler=i,s.scheduleTimeout(),s}return e(r,t),r.dispatchTimeout=function(t){var e=t.withObservable;t._unsubscribeAndRecycle(),t.add(function(t,e){if(!e.closed)return t instanceof _?t.subscribe(e):B(t)(e)}(e,new J(t)))},r.prototype.scheduleTimeout=function(){var t=this.action;t?this.action=t.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(r.dispatchTimeout,this.waitFor,this))},r.prototype._next=function(e){this.absoluteTimeout||this.scheduleTimeout(),t.prototype._next.call(this,e)},r.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},r}(X);function ut(t,e){return void 0===e&&(e=k),ot(t,function(t,e){return new _(e?function(r){return e.schedule(R,0,{error:t,subscriber:r})}:function(e){return e.error(t)})}(new C),e)}var ct=function(){this.__data__=[],this.size=0};var at=function(t,e){return t===e||t!=t&&e!=e};var ht=function(t,e){for(var r=t.length;r--;)if(at(t[r][0],e))return r;return-1},lt=Array.prototype.splice;var ft=function(t){var e=this.__data__,r=ht(e,t);return!(r<0)&&(r==e.length-1?e.pop():lt.call(e,r,1),--this.size,!0)};var pt=function(t){var e=this.__data__,r=ht(e,t);return r<0?void 0:e[r][1]};var bt=function(t){return ht(this.__data__,t)>-1};var dt=function(t,e){var r=this.__data__,n=ht(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function vt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}vt.prototype.clear=ct,vt.prototype.delete=ft,vt.prototype.get=pt,vt.prototype.has=bt,vt.prototype.set=dt;var yt=vt;var _t=function(){this.__data__=new yt,this.size=0};var gt=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r};var Et=function(t){return this.__data__.get(t)};var wt=function(t){return this.__data__.has(t)},jt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function St(t,e){return t(e={exports:{}},e.exports),e.exports}var mt="object"==typeof jt&&jt&&jt.Object===Object&&jt,xt="object"==typeof self&&self&&self.Object===Object&&self,Ot=mt||xt||Function("return this")(),Tt=Ot.Symbol,At=Object.prototype,Mt=At.hasOwnProperty,Pt=At.toString,It=Tt?Tt.toStringTag:void 0;var Rt=function(t){var e=Mt.call(t,It),r=t[It];try{t[It]=void 0;var n=!0}catch(t){}var o=Pt.call(t);return n&&(e?t[It]=r:delete t[It]),o},kt=Object.prototype.toString;var Ct=function(t){return kt.call(t)},zt=Tt?Tt.toStringTag:void 0;var $t=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":zt&&zt in Object(t)?Rt(t):Ct(t)};var Lt=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var Ft,Vt=function(t){if(!Lt(t))return!1;var e=$t(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},Nt=Ot["__core-js_shared__"],Dt=(Ft=/[^.]+$/.exec(Nt&&Nt.keys&&Nt.keys.IE_PROTO||""))?"Symbol(src)_1."+Ft:"";var Ut=function(t){return!!Dt&&Dt in t},qt=Function.prototype.toString;var Bt=function(t){if(null!=t){try{return qt.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Ht=/^\[object .+?Constructor\]$/,Gt=Function.prototype,Yt=Object.prototype,Kt=Gt.toString,Wt=Yt.hasOwnProperty,Jt=RegExp("^"+Kt.call(Wt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Xt=function(t){return!(!Lt(t)||Ut(t))&&(Vt(t)?Jt:Ht).test(Bt(t))};var Qt=function(t,e){return null==t?void 0:t[e]};var Zt=function(t,e){var r=Qt(t,e);return Xt(r)?r:void 0},te=Zt(Ot,"Map"),ee=Zt(Object,"create");var re=function(){this.__data__=ee?ee(null):{},this.size=0};var ne=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},oe=Object.prototype.hasOwnProperty;var ie=function(t){var e=this.__data__;if(ee){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return oe.call(e,t)?e[t]:void 0},se=Object.prototype.hasOwnProperty;var ue=function(t){var e=this.__data__;return ee?void 0!==e[t]:se.call(e,t)};var ce=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=ee&&void 0===e?"__lodash_hash_undefined__":e,this};function ae(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ae.prototype.clear=re,ae.prototype.delete=ne,ae.prototype.get=ie,ae.prototype.has=ue,ae.prototype.set=ce;var he=ae;var le=function(){this.size=0,this.__data__={hash:new he,map:new(te||yt),string:new he}};var fe=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var pe=function(t,e){var r=t.__data__;return fe(e)?r["string"==typeof e?"string":"hash"]:r.map};var be=function(t){var e=pe(this,t).delete(t);return this.size-=e?1:0,e};var de=function(t){return pe(this,t).get(t)};var ve=function(t){return pe(this,t).has(t)};var ye=function(t,e){var r=pe(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function _e(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}_e.prototype.clear=le,_e.prototype.delete=be,_e.prototype.get=de,_e.prototype.has=ve,_e.prototype.set=ye;var ge=_e;var Ee=function(t,e){var r=this.__data__;if(r instanceof yt){var n=r.__data__;if(!te||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new ge(n)}return r.set(t,e),this.size=r.size,this};function we(t){var e=this.__data__=new yt(t);this.size=e.size}we.prototype.clear=_t,we.prototype.delete=gt,we.prototype.get=Et,we.prototype.has=wt,we.prototype.set=Ee;var je=we;var Se=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var me=function(t){return this.__data__.has(t)};function xe(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new ge;++e<r;)this.add(t[e])}xe.prototype.add=xe.prototype.push=Se,xe.prototype.has=me;var Oe=xe;var Te=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1};var Ae=function(t,e){return t.has(e)};var Me=function(t,e,r,n,o,i){var s=1&r,u=t.length,c=e.length;if(u!=c&&!(s&&c>u))return!1;var a=i.get(t),h=i.get(e);if(a&&h)return a==e&&h==t;var l=-1,f=!0,p=2&r?new Oe:void 0;for(i.set(t,e),i.set(e,t);++l<u;){var b=t[l],d=e[l];if(n)var v=s?n(d,b,l,e,t,i):n(b,d,l,t,e,i);if(void 0!==v){if(v)continue;f=!1;break}if(p){if(!Te(e,(function(t,e){if(!Ae(p,e)&&(b===t||o(b,t,r,n,i)))return p.push(e)}))){f=!1;break}}else if(b!==d&&!o(b,d,r,n,i)){f=!1;break}}return i.delete(t),i.delete(e),f},Pe=Ot.Uint8Array;var Ie=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r};var Re=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r},ke=Tt?Tt.prototype:void 0,Ce=ke?ke.valueOf:void 0;var ze=function(t,e,r,n,o,i,s){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new Pe(t),new Pe(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return at(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var u=Ie;case"[object Set]":var c=1&n;if(u||(u=Re),t.size!=e.size&&!c)return!1;var a=s.get(t);if(a)return a==e;n|=2,s.set(t,e);var h=Me(u(t),u(e),n,o,i,s);return s.delete(t),h;case"[object Symbol]":if(Ce)return Ce.call(t)==Ce.call(e)}return!1};var $e=function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t},Le=Array.isArray;var Fe=function(t,e,r){var n=e(t);return Le(t)?n:$e(n,r(t))};var Ve=function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var s=t[r];e(s,r,t)&&(i[o++]=s)}return i};var Ne=function(){return[]},De=Object.prototype.propertyIsEnumerable,Ue=Object.getOwnPropertySymbols,qe=Ue?function(t){return null==t?[]:(t=Object(t),Ve(Ue(t),(function(e){return De.call(t,e)})))}:Ne;var Be=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n};var He=function(t){return null!=t&&"object"==typeof t};var Ge=function(t){return He(t)&&"[object Arguments]"==$t(t)},Ye=Object.prototype,Ke=Ye.hasOwnProperty,We=Ye.propertyIsEnumerable,Je=Ge(function(){return arguments}())?Ge:function(t){return He(t)&&Ke.call(t,"callee")&&!We.call(t,"callee")};var Xe=function(){return!1},Qe=St((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r?Ot.Buffer:void 0,i=(o?o.isBuffer:void 0)||Xe;t.exports=i})),Ze=/^(?:0|[1-9]\d*)$/;var tr=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&Ze.test(t))&&t>-1&&t%1==0&&t<e};var er=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},rr={};rr["[object Float32Array]"]=rr["[object Float64Array]"]=rr["[object Int8Array]"]=rr["[object Int16Array]"]=rr["[object Int32Array]"]=rr["[object Uint8Array]"]=rr["[object Uint8ClampedArray]"]=rr["[object Uint16Array]"]=rr["[object Uint32Array]"]=!0,rr["[object Arguments]"]=rr["[object Array]"]=rr["[object ArrayBuffer]"]=rr["[object Boolean]"]=rr["[object DataView]"]=rr["[object Date]"]=rr["[object Error]"]=rr["[object Function]"]=rr["[object Map]"]=rr["[object Number]"]=rr["[object Object]"]=rr["[object RegExp]"]=rr["[object Set]"]=rr["[object String]"]=rr["[object WeakMap]"]=!1;var nr=function(t){return He(t)&&er(t.length)&&!!rr[$t(t)]};var or=function(t){return function(e){return t(e)}},ir=St((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r&&mt.process,i=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i})),sr=ir&&ir.isTypedArray,ur=sr?or(sr):nr,cr=Object.prototype.hasOwnProperty;var ar=function(t,e){var r=Le(t),n=!r&&Je(t),o=!r&&!n&&Qe(t),i=!r&&!n&&!o&&ur(t),s=r||n||o||i,u=s?Be(t.length,String):[],c=u.length;for(var a in t)!e&&!cr.call(t,a)||s&&("length"==a||o&&("offset"==a||"parent"==a)||i&&("buffer"==a||"byteLength"==a||"byteOffset"==a)||tr(a,c))||u.push(a);return u},hr=Object.prototype;var lr=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||hr)};var fr=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),pr=Object.prototype.hasOwnProperty;var br=function(t){if(!lr(t))return fr(t);var e=[];for(var r in Object(t))pr.call(t,r)&&"constructor"!=r&&e.push(r);return e};var dr=function(t){return null!=t&&er(t.length)&&!Vt(t)};var vr=function(t){return dr(t)?ar(t):br(t)};var yr=function(t){return Fe(t,vr,qe)},_r=Object.prototype.hasOwnProperty;var gr=function(t,e,r,n,o,i){var s=1&r,u=yr(t),c=u.length;if(c!=yr(e).length&&!s)return!1;for(var a=c;a--;){var h=u[a];if(!(s?h in e:_r.call(e,h)))return!1}var l=i.get(t),f=i.get(e);if(l&&f)return l==e&&f==t;var p=!0;i.set(t,e),i.set(e,t);for(var b=s;++a<c;){var d=t[h=u[a]],v=e[h];if(n)var y=s?n(v,d,h,e,t,i):n(d,v,h,t,e,i);if(!(void 0===y?d===v||o(d,v,r,n,i):y)){p=!1;break}b||(b="constructor"==h)}if(p&&!b){var _=t.constructor,g=e.constructor;_==g||!("constructor"in t)||!("constructor"in e)||"function"==typeof _&&_ instanceof _&&"function"==typeof g&&g instanceof g||(p=!1)}return i.delete(t),i.delete(e),p},Er=Zt(Ot,"DataView"),wr=Zt(Ot,"Promise"),jr=Zt(Ot,"Set"),Sr=Zt(Ot,"WeakMap"),mr=Bt(Er),xr=Bt(te),Or=Bt(wr),Tr=Bt(jr),Ar=Bt(Sr),Mr=$t;(Er&&"[object DataView]"!=Mr(new Er(new ArrayBuffer(1)))||te&&"[object Map]"!=Mr(new te)||wr&&"[object Promise]"!=Mr(wr.resolve())||jr&&"[object Set]"!=Mr(new jr)||Sr&&"[object WeakMap]"!=Mr(new Sr))&&(Mr=function(t){var e=$t(t),r="[object Object]"==e?t.constructor:void 0,n=r?Bt(r):"";if(n)switch(n){case mr:return"[object DataView]";case xr:return"[object Map]";case Or:return"[object Promise]";case Tr:return"[object Set]";case Ar:return"[object WeakMap]"}return e});var Pr=Mr,Ir=Object.prototype.hasOwnProperty;var Rr=function(t,e,r,n,o,i){var s=Le(t),u=Le(e),c=s?"[object Array]":Pr(t),a=u?"[object Array]":Pr(e),h="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),l="[object Object]"==(a="[object Arguments]"==a?"[object Object]":a),f=c==a;if(f&&Qe(t)){if(!Qe(e))return!1;s=!0,h=!1}if(f&&!h)return i||(i=new je),s||ur(t)?Me(t,e,r,n,o,i):ze(t,e,c,r,n,o,i);if(!(1&r)){var p=h&&Ir.call(t,"__wrapped__"),b=l&&Ir.call(e,"__wrapped__");if(p||b){var d=p?t.value():t,v=b?e.value():e;return i||(i=new je),o(d,v,r,n,i)}}return!!f&&(i||(i=new je),gr(t,e,r,n,o,i))};var kr=function t(e,r,n,o,i){return e===r||(null==e||null==r||!He(e)&&!He(r)?e!=e&&r!=r:Rr(e,r,n,o,t,i))};var Cr=function(t,e){return kr(t,e)};var zr=function(t){return"symbol"==typeof t||He(t)&&"[object Symbol]"==$t(t)},$r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Lr=/^\w*$/;var Fr=function(t,e){if(Le(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!zr(t))||(Lr.test(t)||!$r.test(t)||null!=e&&t in Object(e))};function Vr(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var s=t.apply(this,n);return r.cache=i.set(o,s)||i,s};return r.cache=new(Vr.Cache||ge),r}Vr.Cache=ge;var Nr=Vr;var Dr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ur=/\\(\\)?/g,qr=function(t){var e=Nr(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Dr,(function(t,r,n,o){e.push(n?o.replace(Ur,"$1"):r||t)})),e}));var Br=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o},Hr=Tt?Tt.prototype:void 0,Gr=Hr?Hr.toString:void 0;var Yr=function t(e){if("string"==typeof e)return e;if(Le(e))return Br(e,t)+"";if(zr(e))return Gr?Gr.call(e):"";var r=e+"";return"0"==r&&1/e==-1/0?"-0":r};var Kr=function(t){return null==t?"":Yr(t)};var Wr=function(t,e){return Le(t)?t:Fr(t,e)?[t]:qr(Kr(t))};var Jr=function(t){if("string"==typeof t||zr(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e};var Xr=function(t,e){for(var r=0,n=(e=Wr(e,t)).length;null!=t&&r<n;)t=t[Jr(e[r++])];return r&&r==n?t:void 0};var Qr=function(t,e,r){var n=null==t?void 0:Xr(t,e);return void 0===n?r:n};const Zr="A_SET",tn=["E_INITIAL","E_RESTRICT","E_FILTER","E_VALIDATE","E_PRECOMMIT","E_COMMIT","E_COMPLETE"],en=new Map([["next",["E_INITIAL","E_FILTER","E_VALIDATE","E_PRECOMMIT","E_COMMIT","E_COMPLETE"]],[Zr,[...tn]],["A_ANY",["E_INITIAL","E_COMMIT","E_COMPLETE"]]]),rn=["E_INITIAL","E_FILTER","E_VALIDATE","E_PRE_MAP_MERGE","E_MAP_MERGE","E_PRECOMMIT","E_COMMIT","E_COMPLETE"],nn="ABSENT",on=(t,e)=>{"string"==typeof t&&(t=new Error(t));try{e&&(t.meta=e)}catch(t){}return t},sn=t=>{if(!t)return new Map;if(t instanceof Map)return t;const e=new Map;return"object"==typeof t?([...Object.keys(t)].forEach(r=>e.set(r,t[r])),e):e},un=t=>t;var cn=Object.freeze({__proto__:null,E_INITIAL:"E_INITIAL",E_FILTER:"E_FILTER",E_VALIDATE:"E_VALIDATE",E_PRECOMMIT:"E_PRECOMMIT",E_PRE_MAP_MERGE:"E_PRE_MAP_MERGE",E_MAP_MERGE:"E_MAP_MERGE",E_COMMIT:"E_COMMIT",E_COMPLETE:"E_COMPLETE",E_RESTRICT:"E_RESTRICT",A_NEXT:"next",A_ANY:"A_ANY",A_ACTION:"A_ACTION",A_SET:Zr,A_DELETE:"A_DELETE",setEvents:tn,defaultEventTree:en,mapNextEvents:rn,ABSENT:"ABSENT","Å":nn,"eqÅ":(t,e)=>void 0===e||e===nn||t===e,e:on,toMap:sn,NOOP:un,SR_FROM_SET:"SR_FROM_SET"});const an="action,stage,value,target".split(",");var hn=(...t)=>{const e=((t,e,r,n)=>t&&"object"==typeof t?an.map(e=>e in t?t[e]:nn):[t,e,r,n])(...t),r=new Map;return an.forEach((t,n)=>{if(e.length<=n)return;const o=e[n];o!==nn&&("function"==typeof o?r.set(t,o):void 0!==o&&r.set(t,t=>t===o))}),r.size||console.warn("eventFilter with no tests has been crated, with args",t),Object.assign(t=>{if("function"==typeof r.get("value")&&t.target&&t.target.debug&&console.log("----- matchEvent:",e),t.isComplete||!r.size)return"function"==typeof r.get("value")&&t.target&&t.target.debug&&console.log("----- matchEvent on complete event, returning false"),!1;const n=[...r.keys()].reduce((e,n)=>{if(!e)return e;const o=r.get(n),i=t[n];let s=!0;try{s=o(i)}catch(t){console.log("matchEvent error with ",o.toString(),"on",i),s=!1}return"function"==typeof r.get("value")&&t.target&&t.target.debug&&console.log("test of ",n,"result ",s,"for",t.toString()),s},!0);return"function"==typeof r.get("value")&&t.target&&t.target.debug&&console.log("----- matchEvent:     final result:",n,"for",t),n},{tests:r,props:e})};class ln extends x{constructor(t,e){super(t),this._initParams(e)}_initParams({action:t="ABSENT",stage:e="ABSENT",target:r}){this.action=t,this.stage=e,this.target=r}get completed(){return this._completed||(this._completed=new Set),this._completed}set stage(t){this.completed.add(this.stage),this._stage=t}complete(){try{this.completed.add(this.stage),super.complete()}catch(t){throw super.delete(this.stage),t}}get stage(){return this._stage}get value(){try{return this.getValue()}catch(t){return nn}}get activeStream(){return!this.isStopped&&!this.hasError}valueToString(){try{if(null===this.value)return"null";if(void 0===this.value)return"undefined";if("object"==typeof this.value){if(this.value instanceof Map){const t=[...this.value.entries()],e={...this.value};return JSON.stringify({entries:t,props:e})}if("function"==typeof this.value.toString)return this.value.toString()}return""+this.value}catch(t){return console.log("error in valueToString:",t.message),""+this.value}}toString(){const t=["<<"];return this.action!==nn&&t.push("action: ",this.action.toString()),this.stage!==nn&&t.push("stage:",this.stage.toString()),this.value!==nn&&t.push("value",this.valueToString()),t.push(">>"),t.join(" ")}}const fn=/^set(.+)$/i;var pn=(t,e)=>Object.assign(t,{addActions:e=>(sn(e).forEach((e,r)=>{t.addAction(r,e)}),t),_actions:sn(e),addAction:(e,r)=>"function"!=typeof r?(console.error("cannot add ",e," -- not a function",r),t):(t._actions.has(e)&&console.warn("redefining action",e),t._actions.set(e,r),delete t._doProxy,t),get do(){return t._doProxy||("undefined"==typeof Proxy?t._doProxy=(t=>{const e={};if(t._actions.forEach((r,n)=>{e[n]=(...e)=>(t.debug&&console.warn("using non-proxy action"),r(t,...e))}),"function"==typeof t.set){(t.value instanceof Map?t.value.keys():Object.keys(t.value)).forEach(r=>{e[r]=e=>(t.debug&&console.warn("using non-proxy set"),t.set(r,e))})}return e})(t):t._doProxy=(t=>new Proxy(t,{get(e,r){if("constructor"===r)return t.debug&&console.warn("--- why do we care about constructor"),null;if(e._actions.has(r))return(...t)=>e._actions.get(r)(e,...t);if("function"==typeof e.set){const t=""+r;if(fn.test(t)){const[r,n]=fn.exec(t),o=n.substr(0,1).toLowerCase()+n.substr(1);if(e.has(o))return t=>e.set(o,t);if(e.has(n))return t=>e.set(n,t)}}throw console.log("unknown action:",r,"called on stream.do of ",t),on("no action "+r,e)}}))(t)),t._doProxy}});class bn{constructor(t,e={}){this._updateValue(t);const{name:r,debug:n=!1,finalize:o,actions:i}=e;this.name=r||"state_"+Math.random(),this.debug=n,i&&pn(this,i)}get _valueSubject(){return this._$valueSubject||(this._$valueSubject=new x),this._$valueSubject}get _errorSubject(){return this._$errorSubject||(this._$errorSubject=(new S).pipe(z(t=>t.error&&t.error.message&&!t.message?{...t,message:t.error.message}:t)),this._$errorSubject.subscribe(t=>{t&&(this._lastError=t)},un)),this._$errorSubject}error(t,e){return Qr(t,"error")?this._errorSubject.next({...t,target:this}):this._errorSubject.next({target:this,event:e,error:t}),this}_updateValue(t){this._valueSubject.next(t)}get isStopped(){return this._valueSubject.isStopped}get closed(){return this._valueSubject.closed}next(t){this._updateValue(t)}get value(){return this._valueSubject.value}getValue(){return this.value}complete(){this._valueSubject.complete(),this._errorSubject.complete()}subscribe(t,e,r){if(this.isStopped)throw new Error("cannot subscribe to a stopped stream");if("object"==typeof t){const{next:e,error:r,complete:n}=t;return this.subscribe(e,r,n)}let n;"function"==typeof e?n=this._errorSubject.subscribe(e):e=un;const o={complete:()=>{n&&(n.unsubscribe(),"function"==typeof r&&r())}};return"function"==typeof e&&(o.error=e),"function"==typeof t&&(o.next=t),this._valueSubject.subscribe(o)}pipe(...t){return this._valueSubject.pipe(...t)}}const dn=hn({action:"next",stage:"E_INITIAL"}),vn=hn({action:"next",stage:"E_MAP_MERGE"}),yn=hn({action:Zr,stage:"E_PRECOMMIT"}),_n=hn({action:Zr,stage:"E_COMMIT"}),gn=hn({action:Zr,stage:"E_RESTRICT"}),En=hn({action:"A_DELETE",stage:"E_COMMIT"}),wn=hn({action:"next",stage:"E_COMMIT"}),jn=hn({action:"next",stage:"E_PRECOMMIT"});class Sn extends bn{constructor(t,e={}){super(t,e),this.debugTrans=!!e.debugTrans;const{filter:r,finalize:n}=e;"function"==typeof r&&this.filter(r),"function"==typeof n&&this.finalize(n),this._watchEvents()}setStages(t,e){if(!Array.isArray(e)||!e.length)throw new Error("setStages requires a non-empty array");this._eventTree.set(t,e)}get _eventTree(){return this._$eventTree||(this._$eventTree=new Map(en)),this._$eventTree}get _eventSubject(){return this._$eventSubject||(this._$eventSubject=new S,this._$eventSubject.subscribe(t=>{this._lastEvent=t},un)),this._$eventSubject}_watchEvents(){this.when(t=>{this._updateValue(t.value),t.complete()},wn)}filter(t){return this.on(e=>{try{const r=t(e.value,e,this);e.next(r)}catch(t){this.debugFilter&&console.log("error thrown in filter:",t,"in event",e),e.error(t,e)}},"next","E_FILTER")}finalize(t){return this.when(t,jn)}on(t,e="next",r="E_FILTER",n=nn){if("function"!=typeof t)throw on("on() requires function",t);if("function"==typeof e)return this.when(t,e);const o=hn({action:e,stage:r,value:n});return this.when(t,o)}when(t,e){if("function"!=typeof t)throw on("when() requires function",t);const r=this,n=this._eventSubject.pipe(Q(t=>{try{return e(t)}catch(e){return console.log("filter error: ",e),t.error(e),!1}}));return n.subscribe(e=>{try{t(e,r),this.debug&&console.log("when:performed ",e.toString(),t.toString())}catch(r){this.debug&&console.log("---- when:error performed ",t.toString(),": ",r.message),e.error(r)}},un),n}send(t,e,r){const n=r||this._eventTree.get(t)||this._eventTree.get("A_ANY"),o=this._errorSubject.next.bind(this._errorSubject),i=new ln(e,{action:t,stages:n[0],target:this});var s,u;return i.subscribe({error:o}),(s=n,u?W(s,u):s instanceof _?s:new _(B(s))).pipe(z(t=>(i.stage=t,i)),Q(t=>!t.isStopped)).subscribe({next:t=>this._eventSubject.next(t),error:t=>{console.log("error in fromEffect:",t.message)},complete(){i.isStopped||i.complete()}}),i}next(t){this.send("next",t)}get _transSubject(){return this._$transSubject||(this._$transSubject=new x(new Set)),this._$transSubject}remTrans(t){if(!t)return;const e=this._transSubject.value;e.delete(t),this._transSubject.next(e)}trans(t,e=1e3){"number"==typeof t&&(e=t,t=null),t||(t=new S),e>0&&(t=t.pipe(ut(e))),0===e&&("function"==typeof requestAnimationFrame?requestAnimationFrame(()=>{t.isStopped||t.complete()}):t=t.pipe(ut(1)));const r=this._transSubject.value;r.add(t),this._transSubject.next(r);const n=this.remTrans.bind(this);return t.subscribe({error(){n(t)},complete(){n(t)}}),t}get _baseSubject(){if(!this._$baseSubject){this._$baseSubject=new x(null);const t=this._valueSubject,e=this._errorSubject,{debugTrans:r}=this;this._$baseSubjectObserver=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=void 0,n=void 0;return A(t[t.length-1])&&(n=t.pop()),"function"==typeof t[t.length-1]&&(r=t.pop()),1===t.length&&u(t[0])&&(t=t[0]),I(t,n).lift(new Y(r))}(this._$baseSubject,this._transSubject).pipe(Q(([t,e])=>(r&&console.log("filtering trans: size = ",e.size),e.size<1)),z(([t])=>t)).subscribe({next(e){r&&console.log("passing on value to valueSubject: ",e),t.next(e)},error(t){e.next(t)},complete(){this._valueSubject.complete()}})}return this._$baseSubject}_updateValue(t){this._baseSubject.next(t)}}var mn=Tt?Tt.isConcatSpreadable:void 0;var xn=function(t){return Le(t)||Je(t)||!!(mn&&t&&t[mn])};var On=function t(e,r,n,o,i){var s=-1,u=e.length;for(n||(n=xn),i||(i=[]);++s<u;){var c=e[s];r>0&&n(c)?r>1?t(c,r-1,n,o,i):$e(i,c):o||(i[i.length]=c)}return i};var Tn=function(t){return(null==t?0:t.length)?On(t,1/0):[]};function An(t,e){if(this.fieldSubjects.has(t))throw on("cannot redefine field subject "+t,{key:t,stream:e,target:this});this.fieldSubjects.set(t,e);const r=this,n=e.pipe(et()).subscribe({next(e){r.set(t,e,!0)}});return n.add(e.subscribe({error(e){r.error(on(e,{fieldSubject:n,target:r,field:t}))}})),this.subscribe({complete(){n.unsubscribe()}}),e}function Mn(t){Object.defineProperty(t.prototype,"addFieldSubject",{value:An}),Object.defineProperty(t.prototype,"fields",{get:function(){return"undefined"!=typeof Proxy?(this._fields||(this._fields=new Proxy(this,{get:(t,e)=>(t.fieldSubjects.has(e)||console.log("attempt to get undefined fieldSubject",e),t.fieldSubjects.get(e))})),this._fields):this._fieldObj}}),Object.defineProperty(t.prototype,"fieldSubjects",{get:function(){return this._fieldSubjects||(this._fieldSubjects=new Map),this._fieldSubjects}}),Object.defineProperty(t.prototype,"_fieldObj",{get:function(){const t={};return this._fieldSubjects.forEach((e,r)=>{t[r]=e}),t}})}var Pn=(...t)=>Tn(t).reduce((t,e)=>(e instanceof Map&&e.forEach((e,r)=>{t.set(r,e)}),t),new Map);const In=t=>{try{return Array.from(t.keys()).sort().join(",")}catch{return null}},Rn=(t,e)=>{if(!(t instanceof Map&&e instanceof Map))return!1;if(t.size!==e.size)return!1;if(!t.size)return!0;const r=In(t),n=In(e);if(!r||!n||r!==n)return!1;let o=!0;return t.forEach((t,r)=>{o&&(o=Cr(t,e.get(r)))}),o};function kn(t){t.value instanceof Map||t.error("only accepts map values")}function Cn(t,e){const r=[...e.value.keys()];t.value.forEach((t,n)=>{if(!r.includes(n))throw on(`key ${n} must be present in ${r.join(", ")}`,e)})}const zn=(t,e)=>{const r=Pn(e.value,t.value);t.isStopped||t.complete(),r._$from="SR_FROM_SET",e.next(r)},$n=(t,e)=>{const r=t.value;t.subscribe({error:un,complete(){e.fieldSubjects.has(r)&&(e.fieldSubjects.get(r).complete(),e.fieldSubjects.delete(r));const t=new Map(e.value);t.delete(r),e._valueSubject.next(t)}})},Ln=(t,e)=>{t.next(Pn(e.value,t.value))};class Fn extends Sn{constructor(t,e){super(sn(t),e),this.setStages("next",rn),this.setStages(Zr,tn),Qr(e,"noNewKeys")&&this.when(Cn,gn),this._watchSet()}_watchSet(){this.when(kn,yn),this.when(Ln,vn),this.when(kn,dn),this.when(zn,_n),this.when($n,En)}onField(t,e,r="E_PRECOMMIT"){let n;n="function"==typeof e?t=>e(t,this):(t=>{const e=Array.isArray(t)?[...t]:[t];return t=>t instanceof Map&&("SR_FROM_SET"!==t._$from&&!![...t.keys()].find(t=>e.includes(t)))})(e);const o=hn({action:Zr,value:n,stage:r}),i=this.when(t,o),s=hn({action:"next",stage:"E_PRE_MAP_MERGE",value:n}),u=this.when(t,s);return u.subscribe({complete:()=>i.complete(),error:t=>i.error(t)}),u}has(t){return this.value.has(t)}set(t,e,r){try{if(t instanceof Map)return this.send(Zr,t);if(!r&&this.fieldSubjects.has(t)){this._lastEvent=null,this._lastError=null;const r=this.fieldSubjects.get(t);r._lastError=null,r._lastEvent=null,r.next(e);let n=this._lastEvent;if(!r._lastError||n&&n.thrownError||(n=r._lastEvent&&r._lastEvent.thrownError?r._lastEvent:{thrownError:r._lastError}),n)try{n.value}catch{return{value:nn,thrownError:n.thrownError}}return n}return this.send(Zr,new Map([[t,e]]))}catch(t){console.log("error in set:",t)}}get(t){return this.value.get(t)}get object(){return[...this.value.keys()].reduce((t,e)=>{try{t[e]=this.get(e)}catch(t){}return t},{})}_valueProxy(){return new Proxy(this,{get:(t,e)=>t.get(e),set:(t,e,r)=>t.set(e,r)})}get my(){return"undefined"!=typeof Proxy?(this._myProxy||(this._myProxy=this._valueProxy()),this._myProxy):this.object}delete(t){this.send("A_DELETE",t)}watch(...t){const e=Tn(t),r="function"==typeof e[e.length-1]?e.pop():null,n=new Map;e.forEach(t=>{this.value.has(t)&&n.set(t,this.value.get(t))});const o=new x(n);return this.on(t=>{t.subscribe({complete:()=>{o.next(t.target.value)},error:un})},"next","E_COMMIT"),o.pipe(z(t=>{const r=new Map;return e.forEach(e=>{t.has(e)&&r.set(e,t.get(e))}),r}),et(r||Rn))}}Mn(Fn);class Vn extends bn{constructor(t,e){super(sn(t),e)}has(t){return this.value.has(t)}set(t,e,r){return t instanceof Map?this.next(t):!r&&this.fieldSubjects.has(t)?this.fieldSubjects.get(t).next(e):this.next(new Map([[t,e]])),this}get(t){return this.value.get(t)}get object(){return[...this.value.keys()].reduce((t,e)=>{try{t[e]=this.get(e)}catch(t){}return t},{})}_valueProxy(){return new Proxy(this,{get:(t,e)=>t.get(e),set:(t,e,r)=>t.set(e,r)})}get my(){return"undefined"!=typeof Proxy?(this._myProxy||(this._myProxy=this._valueProxy()),this._myProxy):this.object}get fields(){return"undefined"!=typeof Proxy?(this._fields||(this._fields=this._fieldProxy()),this._fields):this._fieldObj}get _fieldObj(){const t={};return this.fieldSubjects.forEach((e,r)=>t[r]=e),t}delete(t){const e=this.value,r=new Map(e);r.delete(t),this._updateValue(r)}next(t){if(!(t instanceof Map))throw new Error("ValueMapStreamFast.next() requires a Map input");this._updateValue(Pn(this.value,t))}}Mn(Vn);var Nn=function(t,e,r,n){for(var o=t.length,i=r+(n?1:-1);n?i--:++i<o;)if(e(t[i],i,t))return i;return-1};var Dn=function(t){return t!=t};var Un=function(t,e,r){for(var n=r-1,o=t.length;++n<o;)if(t[n]===e)return n;return-1};var qn=function(t,e,r){return e==e?Un(t,e,r):Nn(t,Dn,r)};var Bn=function(t,e){return!!(null==t?0:t.length)&&qn(t,e,0)>-1};var Hn=function(t,e,r){for(var n=-1,o=null==t?0:t.length;++n<o;)if(r(e,t[n]))return!0;return!1},Gn=Math.min;var Yn=function(t,e,r){for(var n=r?Hn:Bn,o=t[0].length,i=t.length,s=i,u=Array(i),c=1/0,a=[];s--;){var h=t[s];s&&e&&(h=Br(h,or(e))),c=Gn(h.length,c),u[s]=!r&&(e||o>=120&&h.length>=120)?new Oe(s&&h):void 0}h=t[0];var l=-1,f=u[0];t:for(;++l<o&&a.length<c;){var p=h[l],b=e?e(p):p;if(p=r||0!==p?p:0,!(f?Ae(f,b):n(a,b,r))){for(s=i;--s;){var d=u[s];if(!(d?Ae(d,b):n(t[s],b,r)))continue t}f&&f.push(b),a.push(p)}}return a};var Kn=function(t){return t};var Wn=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)},Jn=Math.max;var Xn=function(t,e,r){return e=Jn(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,i=Jn(n.length-e,0),s=Array(i);++o<i;)s[o]=n[e+o];o=-1;for(var u=Array(e+1);++o<e;)u[o]=n[o];return u[e]=r(s),Wn(t,this,u)}};var Qn=function(t){return function(){return t}},Zn=function(){try{var t=Zt(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),to=Zn?function(t,e){return Zn(t,"toString",{configurable:!0,enumerable:!1,value:Qn(e),writable:!0})}:Kn,eo=Date.now;var ro=function(t){var e=0,r=0;return function(){var n=eo(),o=16-(n-r);if(r=n,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(to);var no=function(t){return He(t)&&dr(t)};var oo=function(t){return no(t)?t:[]};io=function(t){var e=Br(t,oo);return e.length&&e[0]===t[0]?Yn(e):[]},ro(Xn(io,so,Kn),io+"");var io,so;function uo(t){t.value&&"object"==typeof t.value||t.error("only accepts map values")}class co extends Object{}const ao=(t,e)=>{const r=Array.from(Object.keys(t)),n=Array.from(Object.keys(e));return!!Cr(new Set(r),new Set(n))&&r.reduce((r,n)=>r&&e[n]===t[n],!0)};function ho(t,e){const r=[...e.value.keys()];t.value.forEach((t,n)=>{if(!r.includes(n))throw on(`key ${n} must be present in ${r.join(", ")}`,e)})}const lo=(t,e)=>{const r=new co;if(Object.assign(r,e.value),Array.isArray(t.value)){const e=[...t.value];for(;e.length;){r[e.shift()]=e.shift()}}else Object.assign(r,t.value);t.complete(),e.send("next",r)},fo=(t,e)=>{const r=t.value;t.subscribe({complete(){e.fieldSubjects.has(r)&&(e.fieldSubjects.get(r).complete(),e.fieldSubjects.delete(r));const t={...e.value};delete t[r],e._valueSubject.next(t)}})},po=(t,e)=>{const r={...e.value};Object.assign(r,t.value),t.next(r)};class bo extends Sn{constructor(t,e){if("object"!=typeof t)throw new Error("ValueObjectStream requires an object as a starting value");super({...t},e),this.setStages("next",rn),this.setStages(Zr,tn),Qr(e,"noNewKeys")&&this.when(ho,gn),this._watchSet()}_watchSet(){this.when(uo,yn),this.when(po,vn),this.when(uo,dn),this.when(lo,_n),this.when(fo,En)}onField(t,e,r="E_PRECOMMIT"){let n;n="function"==typeof e?t=>e(t,this):function(t){const e=Array.isArray(t)?t:[t];return t=>!(!t||"object"!=typeof t)&&(!(t instanceof co)&&!!e.find(e=>e in t))}(e);const o=hn({action:Zr,value:n,stage:r}),i=this.when(t,o),s=hn({action:"next",stage:"E_PRE_MAP_MERGE",value:n});return this.when(t,s).subscribe({complete:()=>i.complete(),error:t=>i.error(t)})}has(t){return t in this.value}set(t,e,r){if("object"==typeof t)return this.send(Zr,t);if(!r&&this.fieldSubjects.has(t)){this._lastEvent=null,this._lastError=null;const r=this.fieldSubjects.get(t);r._lastError=null,r._lastEvent=null,r.next(e);let n=this._lastEvent;if(!r._lastError||n&&n.thrownError||(n=r._lastEvent&&r._lastEvent.thrownError?r._lastEvent:{thrownError:r._lastError}),n)try{n.value}catch{return{value:nn,thrownError:n.thrownError}}return n}return this.send(Zr,{[t]:e})}get(t){return this.value[t]}get object(){return{...this.value}}_valueProxy(){return new Proxy(this,{get:(t,e)=>t.get(e),set:(t,e,r)=>t.set(e,r)})}get my(){return"undefined"!=typeof Proxy?(this._myProxy||(this._myProxy=this._valueProxy()),this._myProxy):this.object}delete(t){this.send("A_DELETE",t)}watch(...t){const e=Tn(t),r="function"==typeof e[e.length-1]?e.pop():null,n=new Map;e.forEach(t=>{t in this.value&&(n[t]=this.value[t])});const o=new x(n);return this.on(t=>{t.subscribe({complete:()=>{o.next(t.target.value)}})},"next","E_COMMIT"),o.pipe(z(t=>{const r={};return e.forEach(e=>{e in t&&(r[e]=t[e])}),r}),et(r||ao))}}return Mn(bo),{...cn,addActions:pn,matchEvent:hn,Event:ln,ValueStream:Sn,ValueStreamFast:bn,ValueMapStream:Fn,ValueMapStreamFast:Vn,ValueObjectStream:bo,setProxy:function(t){if("undefined"!=typeof Proxy){return new Proxy(new Set,{get(e,r){if(r in e)return"function"==typeof e[r]?(...n)=>{t(r,n,nn);const o=e[r].apply(e,n);return t(r,n,o),o}:e[r]}})}return new Set}}}));
