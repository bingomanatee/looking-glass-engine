!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).LGE=e()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};function e(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}function r(t){return"function"==typeof t}var n=!1,o={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;n=t},get useDeprecatedSynchronousErrorHandling(){return n}};function i(t){setTimeout((function(){throw t}),0)}var s={closed:!0,next:function(t){},error:function(t){if(o.useDeprecatedSynchronousErrorHandling)throw t;i(t)},complete:function(){}},u=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();function a(t){return null!==t&&"object"==typeof t}var c=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),h=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var e;if(!this.closed){var n=this._parentOrParents,o=this._ctorUnsubscribe,i=this._unsubscribe,s=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof t)n.remove(this);else if(null!==n)for(var h=0;h<n.length;++h){n[h].remove(this)}if(r(i)){o&&(this._unsubscribe=void 0);try{i.call(this)}catch(t){e=t instanceof c?l(t.errors):[t]}}if(u(s)){h=-1;for(var f=s.length;++h<f;){var p=s[h];if(a(p))try{p.unsubscribe()}catch(t){e=e||[],t instanceof c?e=e.concat(l(t.errors)):e.push(t)}}}if(e)throw new c(e)}},t.prototype.add=function(e){var r=e;if(!e)return t.EMPTY;switch(typeof e){case"function":r=new t(e);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof t)){var n=r;(r=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var o=r._parentOrParents;if(null===o)r._parentOrParents=this;else if(o instanceof t){if(o===this)return r;r._parentOrParents=[o,this]}else{if(-1!==o.indexOf(this))return r;o.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[r]:i.push(r),r},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function l(t){return t.reduce((function(t,e){return t.concat(e instanceof c?e.errors:e)}),[])}var f=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),p=function(t){function r(e,n,o){var i=t.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=s;break;case 1:if(!e){i.destination=s;break}if("object"==typeof e){e instanceof r?(i.syncErrorThrowable=e.syncErrorThrowable,i.destination=e,e.add(i)):(i.syncErrorThrowable=!0,i.destination=new b(i,e));break}default:i.syncErrorThrowable=!0,i.destination=new b(i,e,n,o)}return i}return e(r,t),r.prototype[f]=function(){return this},r.create=function(t,e,n){var o=new r(t,e,n);return o.syncErrorThrowable=!1,o},r.prototype.next=function(t){this.isStopped||this._next(t)},r.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},r.prototype._next=function(t){this.destination.next(t)},r.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},r}(h),b=function(t){function n(e,n,o,i){var u,a=t.call(this)||this;a._parentSubscriber=e;var c=a;return r(n)?u=n:n&&(u=n.next,o=n.error,i=n.complete,n!==s&&(r((c=Object.create(n)).unsubscribe)&&a.add(c.unsubscribe.bind(c)),c.unsubscribe=a.unsubscribe.bind(a))),a._context=c,a._next=u,a._error=o,a._complete=i,a}return e(n,t),n.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;o.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},n.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,r=o.useDeprecatedSynchronousErrorHandling;if(this._error)r&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):i(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;i(t)}}},n.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var r=function(){return t._complete.call(t._context)};o.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},n.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),o.useDeprecatedSynchronousErrorHandling)throw t;i(t)}},n.prototype.__tryOrSetError=function(t,e,r){if(!o.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(e){return o.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(i(e),!0)}return!1},n.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},n}(p);var v=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function d(t){return t}function y(t){return 0===t.length?d:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var _=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n=this.operator,i=function(t,e,r){if(t){if(t instanceof p)return t;if(t[f])return t[f]()}return t||e||r?new p(t,e,r):new p(s)}(t,e,r);if(n?i.add(n.call(i,this.source)):i.add(this.source||o.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),o.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){o.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),!function(t){for(;t;){var e=t,r=e.closed,n=e.destination,o=e.isStopped;if(r||o)return!1;t=n&&n instanceof p?n:null}return!0}(t)?console.warn(e):t.error(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=g(e))((function(e,n){var o;o=r.subscribe((function(e){try{t(e)}catch(t){n(t),o&&o.unsubscribe()}}),n,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[v]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:y(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=g(t))((function(t,r){var n;e.subscribe((function(t){return n=t}),(function(t){return r(t)}),(function(){return t(n)}))}))},t.create=function(e){return new t(e)},t}();function g(t){if(t||(t=Promise),!t)throw new Error("no Promise impl found");return t}var E=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),w=function(t){function r(e,r){var n=t.call(this)||this;return n.subject=e,n.subscriber=r,n.closed=!1,n}return e(r,t),r.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var r=e.indexOf(this.subscriber);-1!==r&&e.splice(r,1)}}},r}(h),m=function(t){function r(e){var r=t.call(this,e)||this;return r.destination=e,r}return e(r,t),r}(p),S=function(t){function r(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return e(r,t),r.prototype[f]=function(){return new m(this)},r.prototype.lift=function(t){var e=new j(this,this);return e.operator=t,e},r.prototype.next=function(t){if(this.closed)throw new E;if(!this.isStopped)for(var e=this.observers,r=e.length,n=e.slice(),o=0;o<r;o++)n[o].next(t)},r.prototype.error=function(t){if(this.closed)throw new E;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,r=e.length,n=e.slice(),o=0;o<r;o++)n[o].error(t);this.observers.length=0},r.prototype.complete=function(){if(this.closed)throw new E;this.isStopped=!0;for(var t=this.observers,e=t.length,r=t.slice(),n=0;n<e;n++)r[n].complete();this.observers.length=0},r.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},r.prototype._trySubscribe=function(e){if(this.closed)throw new E;return t.prototype._trySubscribe.call(this,e)},r.prototype._subscribe=function(t){if(this.closed)throw new E;return this.hasError?(t.error(this.thrownError),h.EMPTY):this.isStopped?(t.complete(),h.EMPTY):(this.observers.push(t),new w(this,t))},r.prototype.asObservable=function(){var t=new _;return t.source=this,t},r.create=function(t,e){return new j(t,e)},r}(_),j=function(t){function r(e,r){var n=t.call(this)||this;return n.destination=e,n.source=r,n}return e(r,t),r.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},r.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},r.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},r.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):h.EMPTY},r}(S),x=function(t){function r(e){var r=t.call(this)||this;return r._value=e,r}return e(r,t),Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),r.prototype._subscribe=function(e){var r=t.prototype._subscribe.call(this,e);return r&&!r.closed&&e.next(this._value),r},r.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new E;return this._value},r.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},r}(S);function O(t,e){return function(r){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new T(t,e))}}var T=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new M(t,this.project,this.thisArg))},t}(),M=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.project=r,o.count=0,o.thisArg=n||o,o}return e(r,t),r.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},r}(p),A=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e(r,t),r.prototype.notifyNext=function(t,e,r,n,o){this.destination.next(e)},r.prototype.notifyError=function(t,e){this.destination.error(t)},r.prototype.notifyComplete=function(t){this.destination.complete()},r}(p),P=function(t){function r(e,r,n){var o=t.call(this)||this;return o.parent=e,o.outerValue=r,o.outerIndex=n,o.index=0,o}return e(r,t),r.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},r.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},r}(p);function I(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var R=I(),C=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function k(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var z=function(t){if(t&&"function"==typeof t[v])return o=t,function(t){var e=o[v]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if(C(t))return n=t,function(t){for(var e=0,r=n.length;e<r&&!t.closed;e++)t.next(n[e]);t.complete()};if(k(t))return r=t,function(t){return r.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,i),t};if(t&&"function"==typeof t[R])return e=t,function(t){for(var r=e[R]();;){var n=void 0;try{n=r.next()}catch(e){return t.error(e),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}return"function"==typeof r.return&&t.add((function(){r.return&&r.return()})),t};var e,r,n,o,s=a(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+s+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function L(t,e,r,n,o){if(void 0===o&&(o=new P(t,r,n)),!o.closed)return e instanceof _?e.subscribe(o):z(e)(o)}var V={},F=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new D(t,this.resultSelector))},t}(),D=function(t){function r(e,r){var n=t.call(this,e)||this;return n.resultSelector=r,n.active=0,n.values=[],n.observables=[],n}return e(r,t),r.prototype._next=function(t){this.values.push(V),this.observables.push(t)},r.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var r=0;r<e;r++){var n=t[r];this.add(L(this,n,void 0,r))}}},r.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},r.prototype.notifyNext=function(t,e,r){var n=this.values,o=n[r],i=this.toRespond?o===V?--this.toRespond:this.toRespond:0;n[r]=e,0===i&&(this.resultSelector?this._tryResultSelector(n):this.destination.next(n.slice()))},r.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},r}(A);function N(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[v]}(t))return function(t,e){return new _((function(r){var n=new h;return n.add(e.schedule((function(){var o=t[v]();n.add(o.subscribe({next:function(t){n.add(e.schedule((function(){return r.next(t)})))},error:function(t){n.add(e.schedule((function(){return r.error(t)})))},complete:function(){n.add(e.schedule((function(){return r.complete()})))}}))}))),n}))}(t,e);if(k(t))return function(t,e){return new _((function(r){var n=new h;return n.add(e.schedule((function(){return t.then((function(t){n.add(e.schedule((function(){r.next(t),n.add(e.schedule((function(){return r.complete()})))})))}),(function(t){n.add(e.schedule((function(){return r.error(t)})))}))}))),n}))}(t,e);if(C(t))return function(t,e){return new _((function(r){var n=new h,o=0;return n.add(e.schedule((function(){o!==t.length?(r.next(t[o++]),r.closed||n.add(this.schedule())):r.complete()}))),n}))}(t,e);if(function(t){return t&&"function"==typeof t[R]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new _((function(r){var n,o=new h;return o.add((function(){n&&"function"==typeof n.return&&n.return()})),o.add(e.schedule((function(){n=t[R](),o.add(e.schedule((function(){if(!r.closed){var t,e;try{var o=n.next();t=o.value,e=o.done}catch(t){return void r.error(t)}e?r.complete():(r.next(t),this.schedule())}})))}))),o}))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function $(t,e){return e?N(t,e):t instanceof _?t:new _(z(t))}function q(t,e){return function(r){return r.lift(new U(t,e))}}var U=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new H(t,this.predicate,this.thisArg))},t}(),H=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.predicate=r,o.thisArg=n,o.count=0,o}return e(r,t),r.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},r}(p);function G(t,e){return function(r){return r.lift(new Y(t,e))}}var Y=function(){function t(t,e){this.compare=t,this.keySelector=e}return t.prototype.call=function(t,e){return e.subscribe(new B(t,this.compare,this.keySelector))},t}(),B=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.keySelector=n,o.hasKey=!1,"function"==typeof r&&(o.compare=r),o}return e(r,t),r.prototype.compare=function(t,e){return t===e},r.prototype._next=function(t){var e;try{var r=this.keySelector;e=r?r(t):t}catch(t){return this.destination.error(t)}var n=!1;if(this.hasKey)try{n=(0,this.compare)(this.key,e)}catch(t){return this.destination.error(t)}else this.hasKey=!0;n||(this.key=e,this.destination.next(t))},r}(p);var K=function(){this.__data__=[],this.size=0};var W=function(t,e){return t===e||t!=t&&e!=e};var J=function(t,e){for(var r=t.length;r--;)if(W(t[r][0],e))return r;return-1},X=Array.prototype.splice;var Q=function(t){var e=this.__data__,r=J(e,t);return!(r<0)&&(r==e.length-1?e.pop():X.call(e,r,1),--this.size,!0)};var Z=function(t){var e=this.__data__,r=J(e,t);return r<0?void 0:e[r][1]};var tt=function(t){return J(this.__data__,t)>-1};var et=function(t,e){var r=this.__data__,n=J(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function rt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}rt.prototype.clear=K,rt.prototype.delete=Q,rt.prototype.get=Z,rt.prototype.has=tt,rt.prototype.set=et;var nt=rt;var ot=function(){this.__data__=new nt,this.size=0};var it=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r};var st=function(t){return this.__data__.get(t)};var ut=function(t){return this.__data__.has(t)},at="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ct(t,e){return t(e={exports:{}},e.exports),e.exports}var ht="object"==typeof at&&at&&at.Object===Object&&at,lt="object"==typeof self&&self&&self.Object===Object&&self,ft=ht||lt||Function("return this")(),pt=ft.Symbol,bt=Object.prototype,vt=bt.hasOwnProperty,dt=bt.toString,yt=pt?pt.toStringTag:void 0;var _t=function(t){var e=vt.call(t,yt),r=t[yt];try{t[yt]=void 0;var n=!0}catch(t){}var o=dt.call(t);return n&&(e?t[yt]=r:delete t[yt]),o},gt=Object.prototype.toString;var Et=function(t){return gt.call(t)},wt=pt?pt.toStringTag:void 0;var mt=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":wt&&wt in Object(t)?_t(t):Et(t)};var St=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var jt,xt=function(t){if(!St(t))return!1;var e=mt(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},Ot=ft["__core-js_shared__"],Tt=(jt=/[^.]+$/.exec(Ot&&Ot.keys&&Ot.keys.IE_PROTO||""))?"Symbol(src)_1."+jt:"";var Mt=function(t){return!!Tt&&Tt in t},At=Function.prototype.toString;var Pt=function(t){if(null!=t){try{return At.call(t)}catch(t){}try{return t+""}catch(t){}}return""},It=/^\[object .+?Constructor\]$/,Rt=Function.prototype,Ct=Object.prototype,kt=Rt.toString,zt=Ct.hasOwnProperty,Lt=RegExp("^"+kt.call(zt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Vt=function(t){return!(!St(t)||Mt(t))&&(xt(t)?Lt:It).test(Pt(t))};var Ft=function(t,e){return null==t?void 0:t[e]};var Dt=function(t,e){var r=Ft(t,e);return Vt(r)?r:void 0},Nt=Dt(ft,"Map"),$t=Dt(Object,"create");var qt=function(){this.__data__=$t?$t(null):{},this.size=0};var Ut=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Ht=Object.prototype.hasOwnProperty;var Gt=function(t){var e=this.__data__;if($t){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return Ht.call(e,t)?e[t]:void 0},Yt=Object.prototype.hasOwnProperty;var Bt=function(t){var e=this.__data__;return $t?void 0!==e[t]:Yt.call(e,t)};var Kt=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=$t&&void 0===e?"__lodash_hash_undefined__":e,this};function Wt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Wt.prototype.clear=qt,Wt.prototype.delete=Ut,Wt.prototype.get=Gt,Wt.prototype.has=Bt,Wt.prototype.set=Kt;var Jt=Wt;var Xt=function(){this.size=0,this.__data__={hash:new Jt,map:new(Nt||nt),string:new Jt}};var Qt=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var Zt=function(t,e){var r=t.__data__;return Qt(e)?r["string"==typeof e?"string":"hash"]:r.map};var te=function(t){var e=Zt(this,t).delete(t);return this.size-=e?1:0,e};var ee=function(t){return Zt(this,t).get(t)};var re=function(t){return Zt(this,t).has(t)};var ne=function(t,e){var r=Zt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function oe(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}oe.prototype.clear=Xt,oe.prototype.delete=te,oe.prototype.get=ee,oe.prototype.has=re,oe.prototype.set=ne;var ie=oe;var se=function(t,e){var r=this.__data__;if(r instanceof nt){var n=r.__data__;if(!Nt||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new ie(n)}return r.set(t,e),this.size=r.size,this};function ue(t){var e=this.__data__=new nt(t);this.size=e.size}ue.prototype.clear=ot,ue.prototype.delete=it,ue.prototype.get=st,ue.prototype.has=ut,ue.prototype.set=se;var ae=ue;var ce=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var he=function(t){return this.__data__.has(t)};function le(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new ie;++e<r;)this.add(t[e])}le.prototype.add=le.prototype.push=ce,le.prototype.has=he;var fe=le;var pe=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1};var be=function(t,e){return t.has(e)};var ve=function(t,e,r,n,o,i){var s=1&r,u=t.length,a=e.length;if(u!=a&&!(s&&a>u))return!1;var c=i.get(t),h=i.get(e);if(c&&h)return c==e&&h==t;var l=-1,f=!0,p=2&r?new fe:void 0;for(i.set(t,e),i.set(e,t);++l<u;){var b=t[l],v=e[l];if(n)var d=s?n(v,b,l,e,t,i):n(b,v,l,t,e,i);if(void 0!==d){if(d)continue;f=!1;break}if(p){if(!pe(e,(function(t,e){if(!be(p,e)&&(b===t||o(b,t,r,n,i)))return p.push(e)}))){f=!1;break}}else if(b!==v&&!o(b,v,r,n,i)){f=!1;break}}return i.delete(t),i.delete(e),f},de=ft.Uint8Array;var ye=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r};var _e=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r},ge=pt?pt.prototype:void 0,Ee=ge?ge.valueOf:void 0;var we=function(t,e,r,n,o,i,s){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new de(t),new de(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return W(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var u=ye;case"[object Set]":var a=1&n;if(u||(u=_e),t.size!=e.size&&!a)return!1;var c=s.get(t);if(c)return c==e;n|=2,s.set(t,e);var h=ve(u(t),u(e),n,o,i,s);return s.delete(t),h;case"[object Symbol]":if(Ee)return Ee.call(t)==Ee.call(e)}return!1};var me=function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t},Se=Array.isArray;var je=function(t,e,r){var n=e(t);return Se(t)?n:me(n,r(t))};var xe=function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var s=t[r];e(s,r,t)&&(i[o++]=s)}return i};var Oe=function(){return[]},Te=Object.prototype.propertyIsEnumerable,Me=Object.getOwnPropertySymbols,Ae=Me?function(t){return null==t?[]:(t=Object(t),xe(Me(t),(function(e){return Te.call(t,e)})))}:Oe;var Pe=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n};var Ie=function(t){return null!=t&&"object"==typeof t};var Re=function(t){return Ie(t)&&"[object Arguments]"==mt(t)},Ce=Object.prototype,ke=Ce.hasOwnProperty,ze=Ce.propertyIsEnumerable,Le=Re(function(){return arguments}())?Re:function(t){return Ie(t)&&ke.call(t,"callee")&&!ze.call(t,"callee")};var Ve=function(){return!1},Fe=ct((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r?ft.Buffer:void 0,i=(o?o.isBuffer:void 0)||Ve;t.exports=i})),De=/^(?:0|[1-9]\d*)$/;var Ne=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&De.test(t))&&t>-1&&t%1==0&&t<e};var $e=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},qe={};qe["[object Float32Array]"]=qe["[object Float64Array]"]=qe["[object Int8Array]"]=qe["[object Int16Array]"]=qe["[object Int32Array]"]=qe["[object Uint8Array]"]=qe["[object Uint8ClampedArray]"]=qe["[object Uint16Array]"]=qe["[object Uint32Array]"]=!0,qe["[object Arguments]"]=qe["[object Array]"]=qe["[object ArrayBuffer]"]=qe["[object Boolean]"]=qe["[object DataView]"]=qe["[object Date]"]=qe["[object Error]"]=qe["[object Function]"]=qe["[object Map]"]=qe["[object Number]"]=qe["[object Object]"]=qe["[object RegExp]"]=qe["[object Set]"]=qe["[object String]"]=qe["[object WeakMap]"]=!1;var Ue=function(t){return Ie(t)&&$e(t.length)&&!!qe[mt(t)]};var He=function(t){return function(e){return t(e)}},Ge=ct((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r&&ht.process,i=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i})),Ye=Ge&&Ge.isTypedArray,Be=Ye?He(Ye):Ue,Ke=Object.prototype.hasOwnProperty;var We=function(t,e){var r=Se(t),n=!r&&Le(t),o=!r&&!n&&Fe(t),i=!r&&!n&&!o&&Be(t),s=r||n||o||i,u=s?Pe(t.length,String):[],a=u.length;for(var c in t)!e&&!Ke.call(t,c)||s&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Ne(c,a))||u.push(c);return u},Je=Object.prototype;var Xe=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Je)};var Qe=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),Ze=Object.prototype.hasOwnProperty;var tr=function(t){if(!Xe(t))return Qe(t);var e=[];for(var r in Object(t))Ze.call(t,r)&&"constructor"!=r&&e.push(r);return e};var er=function(t){return null!=t&&$e(t.length)&&!xt(t)};var rr=function(t){return er(t)?We(t):tr(t)};var nr=function(t){return je(t,rr,Ae)},or=Object.prototype.hasOwnProperty;var ir=function(t,e,r,n,o,i){var s=1&r,u=nr(t),a=u.length;if(a!=nr(e).length&&!s)return!1;for(var c=a;c--;){var h=u[c];if(!(s?h in e:or.call(e,h)))return!1}var l=i.get(t),f=i.get(e);if(l&&f)return l==e&&f==t;var p=!0;i.set(t,e),i.set(e,t);for(var b=s;++c<a;){var v=t[h=u[c]],d=e[h];if(n)var y=s?n(d,v,h,e,t,i):n(v,d,h,t,e,i);if(!(void 0===y?v===d||o(v,d,r,n,i):y)){p=!1;break}b||(b="constructor"==h)}if(p&&!b){var _=t.constructor,g=e.constructor;_==g||!("constructor"in t)||!("constructor"in e)||"function"==typeof _&&_ instanceof _&&"function"==typeof g&&g instanceof g||(p=!1)}return i.delete(t),i.delete(e),p},sr=Dt(ft,"DataView"),ur=Dt(ft,"Promise"),ar=Dt(ft,"Set"),cr=Dt(ft,"WeakMap"),hr=Pt(sr),lr=Pt(Nt),fr=Pt(ur),pr=Pt(ar),br=Pt(cr),vr=mt;(sr&&"[object DataView]"!=vr(new sr(new ArrayBuffer(1)))||Nt&&"[object Map]"!=vr(new Nt)||ur&&"[object Promise]"!=vr(ur.resolve())||ar&&"[object Set]"!=vr(new ar)||cr&&"[object WeakMap]"!=vr(new cr))&&(vr=function(t){var e=mt(t),r="[object Object]"==e?t.constructor:void 0,n=r?Pt(r):"";if(n)switch(n){case hr:return"[object DataView]";case lr:return"[object Map]";case fr:return"[object Promise]";case pr:return"[object Set]";case br:return"[object WeakMap]"}return e});var dr=vr,yr=Object.prototype.hasOwnProperty;var _r=function(t,e,r,n,o,i){var s=Se(t),u=Se(e),a=s?"[object Array]":dr(t),c=u?"[object Array]":dr(e),h="[object Object]"==(a="[object Arguments]"==a?"[object Object]":a),l="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),f=a==c;if(f&&Fe(t)){if(!Fe(e))return!1;s=!0,h=!1}if(f&&!h)return i||(i=new ae),s||Be(t)?ve(t,e,r,n,o,i):we(t,e,a,r,n,o,i);if(!(1&r)){var p=h&&yr.call(t,"__wrapped__"),b=l&&yr.call(e,"__wrapped__");if(p||b){var v=p?t.value():t,d=b?e.value():e;return i||(i=new ae),o(v,d,r,n,i)}}return!!f&&(i||(i=new ae),ir(t,e,r,n,o,i))};var gr=function t(e,r,n,o,i){return e===r||(null==e||null==r||!Ie(e)&&!Ie(r)?e!=e&&r!=r:_r(e,r,n,o,t,i))};var Er=function(t,e){return gr(t,e)};var wr=function(t){return"symbol"==typeof t||Ie(t)&&"[object Symbol]"==mt(t)},mr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Sr=/^\w*$/;var jr=function(t,e){if(Se(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!wr(t))||(Sr.test(t)||!mr.test(t)||null!=e&&t in Object(e))};function xr(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var s=t.apply(this,n);return r.cache=i.set(o,s)||i,s};return r.cache=new(xr.Cache||ie),r}xr.Cache=ie;var Or=xr;var Tr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Mr=/\\(\\)?/g,Ar=function(t){var e=Or(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Tr,(function(t,r,n,o){e.push(n?o.replace(Mr,"$1"):r||t)})),e}));var Pr=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o},Ir=pt?pt.prototype:void 0,Rr=Ir?Ir.toString:void 0;var Cr=function t(e){if("string"==typeof e)return e;if(Se(e))return Pr(e,t)+"";if(wr(e))return Rr?Rr.call(e):"";var r=e+"";return"0"==r&&1/e==-1/0?"-0":r};var kr=function(t){return null==t?"":Cr(t)};var zr=function(t,e){return Se(t)?t:jr(t,e)?[t]:Ar(kr(t))};var Lr=function(t){if("string"==typeof t||wr(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e};var Vr=function(t,e){for(var r=0,n=(e=zr(e,t)).length;null!=t&&r<n;)t=t[Lr(e[r++])];return r&&r==n?t:void 0};var Fr=function(t,e,r){var n=null==t?void 0:Vr(t,e);return void 0===n?r:n},Dr=pt?pt.isConcatSpreadable:void 0;var Nr=function(t){return Se(t)||Le(t)||!!(Dr&&t&&t[Dr])};var $r=function t(e,r,n,o,i){var s=-1,u=e.length;for(n||(n=Nr),i||(i=[]);++s<u;){var a=e[s];r>0&&n(a)?r>1?t(a,r-1,n,o,i):me(i,a):o||(i[i.length]=a)}return i};var qr=function(t){return(null==t?0:t.length)?$r(t,1/0):[]};const Ur="A_SET",Hr=["E_INITIAL","E_RESTRICT","E_FILTER","E_VALIDATE","E_PRECOMMIT","E_COMMIT","E_COMPLETE"],Gr=new Map([["next",["E_INITIAL","E_FILTER","E_VALIDATE","E_PRECOMMIT","E_COMMIT","E_COMPLETE"]],[Ur,[...Hr]],["A_ANY",["E_INITIAL","E_COMMIT","E_COMPLETE"]]]),Yr=["E_INITIAL","E_FILTER","E_VALIDATE","E_PRE_MAP_MERGE","E_MAP_MERGE","E_PRECOMMIT","E_COMMIT","E_COMPLETE"],Br="ABSENT",Kr=Br,Wr=(t,e)=>{"string"!=typeof t&&(t="");const r=new Error(t);try{e&&(r.meta=e)}catch(t){}return r},Jr=t=>{if(!t)return new Map;if(t instanceof Map)return t;const e=new Map;return"object"==typeof t?([...Object.keys(t)].forEach(r=>e.set(r,t[r])),e):e},Xr=(...t)=>qr(t).reduce((t,e)=>(e instanceof Map&&e.forEach((e,r)=>{t.set(r,e)}),t),new Map),Qr=t=>t;var Zr=Object.freeze({__proto__:null,E_INITIAL:"E_INITIAL",E_FILTER:"E_FILTER",E_VALIDATE:"E_VALIDATE",E_PRECOMMIT:"E_PRECOMMIT",E_PRE_MAP_MERGE:"E_PRE_MAP_MERGE",E_MAP_MERGE:"E_MAP_MERGE",E_COMMIT:"E_COMMIT",E_COMPLETE:"E_COMPLETE",E_RESTRICT:"E_RESTRICT",A_NEXT:"next",A_ANY:"A_ANY",A_ACTION:"A_ACTION",A_SET:Ur,A_DELETE:"A_DELETE",setEvents:Hr,defaultEventTree:Gr,mapNextEvents:Yr,ABSENT:Br,"Å":Kr,"eqÅ":(t,e)=>void 0===e||e===Kr||t===e,e:Wr,toMap:Jr,mergeMaps:Xr,NOOP:Qr,SR_FROM_SET:"SR_FROM_SET"});class tn{constructor(t,e,r,n){"object"==typeof t?this._initParams(t):this._initArgs(t,e,r,n),this.target=n}_initParams({action:t=Br,valueStream:e=Br,stage:r=Br}){this._initArgs(t,e,r)}_initArgs(t=Kr,e=Kr,r=Kr,n=Kr){this.action=t,this.valueStream=e,this.stage=r,this.target=n,this.completed=[]}set stage(t){this.stage&&this.completed.push(this.stage),this._stage=t}get stage(){return this._stage}get value(){try{return this.valueStream.getValue()}catch(t){return Kr}}get thrownError(){return this.valueStream.thrownError}get activeStream(){return!this.valueStream.isStopped&&!this.valueStream.hasError}get isStopped(){return this.valueStream.isStopped}next(t){if(!this.activeStream)throw Wr("attempt to update a stalled stream",this);this.valueStream.next(t)}error(t){if(this.activeStream){if(this.valueStream===Br)throw console.warn("attempting to throw error on absent stram",t),t;this.valueStream.error(t)}else console.error("cannot register an error on suspended stream",t,this)}complete(){this.valueStream&&this.valueStream.complete()}subscribe(...t){if(this.valueStream)return this.valueStream.subscribe(...t);throw Wr("attempted to subscribe to a stream-less Event",this)}valueToString(){try{if(null===this.value)return"null";if(void 0===this.value)return"undefined";if("object"==typeof this.value){if(this.value instanceof Map){const t=[...this.value.entries()],e={...this.value};return JSON.stringify({entries:t,props:e})}if("function"==typeof this.value.toString)return this.value.toString()}return""+this.value}catch(t){return console.log("error in valueToString:",t.message),""+this.value}}toString(){const t=["<<"];return this.action!==Kr&&t.push("action: ",this.action.toString()),this.stage!==Kr&&t.push("stage:",this.stage.toString()),this.value!==Kr&&t.push("value",this.valueToString()),t.push(">>"),t.join(" ")}}tn.toEvent=t=>{if(!t)throw new Error("toEvent requires data");return t instanceof tn?t:Array.isArray(t)?new tn(...t):new tn(t)};class en{constructor(t,e,r,n){"object"==typeof t?this._initParams(t):this._initArgs(t,e,r,n)}_initArgs(t=Kr,e=Kr,r=Kr,n=Kr){this.action=t,this.value=e,this.stage=r,this.target=n}_initParams({action:t=Br,value:e=Br,stage:r=Br}){this._initArgs(t,e,r)}_matches(t,e,r){const n=Fr(this,e);if(t instanceof en)return console.error("comparing two EventFilters",this,t),!1;if(n===Kr)return!0;if(t instanceof tn&&(t=Fr(t,e)),"function"==typeof n){return n(t,this)}return t===n}valueMatches(t,e){return this._matches(t,"value",e)}stageMatches(t,e){return this._matches(t,"stage",e)}actionMatches(t,e){return this._matches(t,"action",e)}matches(t,e){try{return this.actionMatches(t,e)&&this.stageMatches(t,e)&&this.valueMatches(t,e)}catch(t){return this.debug&&console.log("match error: ",t.message),!1}}_equals(t,e,r){if(t instanceof en)return console.error("comparing two EventFilters",this,t),!1;if(t instanceof tn)return this._equals(Fr(t,e,Br),e);if(r){const r=Fr(t,e,Br);if(r!==Br)return this._equals(r,e)}return"function"==typeof this[e]?this[e](t,this):Er(Fr(this,e),t)}valueEquals(t,e){return this._equals(t,"value",e)}stageEquals(t,e){return this._equals(t,"stage",e)}nameEquals(t,e){return this._equals(t,"action",e)}equals(t,e){return this.nameEquals(t,e)&&this.stageEquals(t,e)&&this.valueEquals(t,e)}}tn.EventFilter=en;class rn{constructor(t,e={}){this._valueSubject=new x(t);const{name:r,debug:n=!1,finalize:o}=e;this.name=r||"state_"+Math.random(),this.debug=n}get _errorSubject(){return this._$errorSubject||(this._$errorSubject=(new S).pipe(O(t=>t.error&&t.error.message&&!t.message?{...t,message:t.error.message}:t)),this._$errorSubject.subscribe(t=>{t&&(this._lastError=t)},Qr)),this._$errorSubject}error(t,e){return Fr(t,"error")?this._errorSubject.next({...t,target:this}):this._errorSubject.next({target:this,event:e,error:t}),this}_updateValue(t){this._valueSubject.next(t)}get isStopped(){return this._valueSubject.isStopped}get closed(){return this._valueSubject.closed}next(t){this._updateValue(t)}get value(){return this._valueSubject.value}getValue(){return this.value}complete(){this._valueSubject.complete(),this._errorSubject.complete()}subscribe(t,e,r){if(this.isStopped)throw new Error("cannot subscribe to a stopped stream");if("object"==typeof t){const{next:e,error:r,complete:n}=t;return this.subscribe(e,r,n)}let n;"function"==typeof e?n=this._errorSubject.subscribe(e):e=Qr;const o={complete:()=>{n&&(n.unsubscribe(),"function"==typeof r&&r())}};return"function"==typeof e&&(o.error=e),"function"==typeof t&&(o.next=t),this._valueSubject.subscribe(o)}pipe(...t){return this._valueSubject.pipe(...t)}}const nn=new en({action:"next",stage:"E_COMMIT"}),on=new en({action:"next",stage:"E_PRECOMMIT"});class sn extends rn{constructor(t,e={}){super(t,e),this._eventTree=new Map(Gr);const{filter:r,finalize:n}=e;"function"==typeof r&&this.filter(r),"function"==typeof n&&this.finalize(n),this._watchEvents()}setStages(t,e){if(!Array.isArray(e)||!e.length)throw new Error("setStages requires a non-empty array");this._eventTree.set(t,e)}get _eventSubject(){return this._$eventSubject||(this._$eventSubject=new S,this._$eventSubject.subscribe(t=>{this._lastEvent=t},Qr)),this._$eventSubject}_watchEvents(){this.when(({valueStream:t})=>{this._updateValue(t.value),t.complete()},nn)}filter(t){return this.on(e=>{try{const r=t(e.value,e,this);e.next(r)}catch(t){this.debugFilter&&console.log("error thrown in filter:",t,"in event",e),e.error(t,e)}},"next","E_FILTER")}finalize(t){return this.when(t,on)}on(t,e="next",r="E_FILTER",n=Kr){if("function"!=typeof t)throw Wr("on() requires function",t);if(e instanceof en)return this.when(t,e);const o=new en({action:e,stage:r,value:n});return this.when(t,o)}when(t,e){if("function"!=typeof t)throw Wr("when() requires function",t);if(!(e instanceof en))throw Wr("cannot call when() without a formal event filter",e);const r=this,n=this._eventSubject.pipe(q(t=>e.matches(t)));return n.subscribe(e=>{this.debug&&console.log("doing ",e.toString(),t.toString()),t(e,r)},Qr),n}send(t,e,r){const n=r||this._eventTree.get(t)||this._eventTree.get("A_ANY"),o=this._errorSubject.next.bind(this._errorSubject),i=new tn(t,new x(e),n[0],this);return i.subscribe({error:o}),$(n).pipe(O(t=>(i.stage=t,i)),q(t=>!t.isStopped)).subscribe({next:t=>this._eventSubject.next(t),error:t=>{console.log("error in fromEffect:",t.message)},complete(){i.isStopped||i.complete()}}),i}next(t){this.send("next",t)}}function un(t){return new Proxy(t,{get:(t,e)=>(console.log("target: ",t,"target fieldSubjects",t.fieldSubjects),t.fieldSubjects.has(e)||console.log("attempt to get undefined fieldSubject",e),t.fieldSubjects.get(e))})}function an(t,e){if(this.fieldSubjects.has(t))throw Wr("cannot redefine field subject "+t,{key:t,stream:e,target:this});{this.fieldSubjects.set(t,e);const r=e.pipe(G()).subscribe(e=>this.set(t,e,!0));this.subscribe({complete(){r.unsubscribe()}})}}function cn(t){Object.defineProperty(t.prototype,"addFieldSubject",{value:an}),Object.defineProperty(t.prototype,"fields",{get:function(){return"undefined"!=typeof Proxy?(this._fields||(this._fields=un(this)),this._fields):this._fieldObj}}),Object.defineProperty(t.prototype,"fieldSubjects",{get:function(){return this._fieldSubjects||(this._fieldSubjects=new Map),this._fieldSubjects}}),Object.defineProperty(t.prototype,"_fieldObj",{get:function(){return"undefined"!=typeof Proxy?(this._fields||(this._fields=un(this)),this._fields):this._fieldObj}})}const hn=new en({action:"next",stage:"E_INITIAL"}),ln=new en({action:"next",stage:"E_MAP_MERGE"}),fn=new en({action:Ur,stage:"E_PRECOMMIT"}),pn=new en({action:Ur,stage:"E_COMMIT"}),bn=new en({action:Ur,stage:"E_RESTRICT"}),vn=new en({action:"A_DELETE",stage:"E_COMMIT"}),dn=t=>{try{return Array.from(t.keys()).sort().join(",")}catch{return null}},yn=(t,e)=>{if(!(t instanceof Map&&e instanceof Map))return!1;if(t.size!==e.size)return!1;if(!t.size)return!0;const r=dn(t),n=dn(e);if(!r||!n||r!==n)return!1;let o=!0;return t.forEach((t,r)=>{o&&(o=Er(t,e.get(r)))}),o};function _n(t){t.value instanceof Map||t.error("only accepts map values")}function gn(t,e){const r=[...e.value.keys()];t.value.forEach((t,n)=>{if(!r.includes(n))throw Wr(`key ${n} must be present in ${r.join(", ")}`,e)})}const En=(t,e)=>{const r=Xr(e.value,t.value);t.isStopped||t.complete(),r._$from="SR_FROM_SET",e.next(r)},wn=(t,e)=>{const r=t.value;t.subscribe({error:Qr,complete(){e.fieldSubjects.has(r)&&(e.fieldSubjects.get(r).complete(),e.fieldSubjects.delete(r));const t=new Map(e.value);t.delete(r),e._valueSubject.next(t)}})},mn=(t,e)=>{t.next(Xr(e.value,t.value))};class Sn extends sn{constructor(t,e){super(Jr(t),e),this.setStages("next",Yr),this.setStages(Ur,Hr),Fr(e,"noNewKeys")&&this.when(gn,bn),this._watchSet()}_watchSet(){this.when(_n,fn),this.when(mn,ln),this.when(_n,hn),this.when(En,pn),this.when(wn,vn)}onField(t,e,r="E_PRECOMMIT"){const n=Array.isArray(e)?[...e]:[e],o=t=>t instanceof Map&&("SR_FROM_SET"!==t._$from&&!![...t.keys()].find(t=>n.includes(t))),i=new en(Ur,o,r),s=this.when(t,i),u=new en({action:"next",stage:"E_PRE_MAP_MERGE",value:o}),a=this.when(t,u);return a.subscribe({complete:()=>s.complete(),error:t=>s.error(t)}),a}has(t){return this.value.has(t)}set(t,e,r){try{if(t instanceof Map)return this.send(Ur,t);if(!r&&this.fieldSubjects.has(t)){this._lastEvent=null,this._lastError=null;const r=this.fieldSubjects.get(t);r._lastError=null,r._lastEvent=null,r.next(e);let n=this._lastEvent;if(!r._lastError||n&&n.thrownError||(n=r._lastEvent&&r._lastEvent.thrownError?r._lastEvent:{thrownError:r._lastError}),n)try{n.value}catch{return{value:Kr,thrownError:n.thrownError}}return n}return this.send(Ur,new Map([[t,e]]))}catch(t){console.log("error in set:",t)}}get(t){return this.value.get(t)}get object(){return[...this.value.keys()].reduce((t,e)=>{try{t[e]=this.get(e)}catch(t){}return t},{})}_valueProxy(){return new Proxy(this,{get:(t,e)=>t.get(e),set:(t,e,r)=>t.set(e,r)})}get my(){return"undefined"!=typeof Proxy?(this._myProxy||(this._myProxy=this._valueProxy()),this._myProxy):this.object}delete(t){this.send("A_DELETE",t)}watch(...t){const e=qr(t),r="function"==typeof e[e.length-1]?e.pop():null,n=new Map;e.forEach(t=>{this.value.has(t)&&n.set(t,this.value.get(t))});const o=new x(n);return this.on(t=>{t.subscribe({complete:()=>{o.next(t.target.value)},error:Qr})},"next","E_COMMIT"),o.pipe(O(t=>{const r=new Map;return e.forEach(e=>{t.has(e)&&r.set(e,t.get(e))}),r}),G(r||yn))}}cn(Sn);class jn extends rn{constructor(t,e){super(Jr(t),e)}has(t){return this.value.has(t)}set(t,e,r){return t instanceof Map?this.next(t):!r&&this.fieldSubjects.has(t)?this.fieldSubjects.get(t).next(e):this.next(new Map([[t,e]])),this}get(t){return this.value.get(t)}get object(){return[...this.value.keys()].reduce((t,e)=>{try{t[e]=this.get(e)}catch(t){}return t},{})}_valueProxy(){return new Proxy(this,{get:(t,e)=>t.get(e),set:(t,e,r)=>t.set(e,r)})}get my(){return"undefined"!=typeof Proxy?(this._myProxy||(this._myProxy=this._valueProxy()),this._myProxy):this.object}get fields(){return"undefined"!=typeof Proxy?(this._fields||(this._fields=this._fieldProxy()),this._fields):this._fieldObj}get _fieldObj(){const t={};return this.fieldSubjects.forEach((e,r)=>t[r]=e),t}delete(t){const e=this.value,r=new Map(e);r.delete(t),this._updateValue(r)}next(t){if(!(t instanceof Map))throw new Error("ValueMapStreamFast.next() requires a Map input");this._updateValue(Xr(this.value,t))}}cn(jn);var xn=function(t,e,r,n){for(var o=t.length,i=r+(n?1:-1);n?i--:++i<o;)if(e(t[i],i,t))return i;return-1};var On=function(t){return t!=t};var Tn=function(t,e,r){for(var n=r-1,o=t.length;++n<o;)if(t[n]===e)return n;return-1};var Mn=function(t,e,r){return e==e?Tn(t,e,r):xn(t,On,r)};var An=function(t,e){return!!(null==t?0:t.length)&&Mn(t,e,0)>-1};var Pn=function(t,e,r){for(var n=-1,o=null==t?0:t.length;++n<o;)if(r(e,t[n]))return!0;return!1},In=Math.min;var Rn=function(t,e,r){for(var n=r?Pn:An,o=t[0].length,i=t.length,s=i,u=Array(i),a=1/0,c=[];s--;){var h=t[s];s&&e&&(h=Pr(h,He(e))),a=In(h.length,a),u[s]=!r&&(e||o>=120&&h.length>=120)?new fe(s&&h):void 0}h=t[0];var l=-1,f=u[0];t:for(;++l<o&&c.length<a;){var p=h[l],b=e?e(p):p;if(p=r||0!==p?p:0,!(f?be(f,b):n(c,b,r))){for(s=i;--s;){var v=u[s];if(!(v?be(v,b):n(t[s],b,r)))continue t}f&&f.push(b),c.push(p)}}return c};var Cn=function(t){return t};var kn=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)},zn=Math.max;var Ln=function(t,e,r){return e=zn(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,i=zn(n.length-e,0),s=Array(i);++o<i;)s[o]=n[e+o];o=-1;for(var u=Array(e+1);++o<e;)u[o]=n[o];return u[e]=r(s),kn(t,this,u)}};var Vn=function(t){return function(){return t}},Fn=function(){try{var t=Dt(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Dn=Fn?function(t,e){return Fn(t,"toString",{configurable:!0,enumerable:!1,value:Vn(e),writable:!0})}:Cn,Nn=Date.now;var $n=function(t){var e=0,r=0;return function(){var n=Nn(),o=16-(n-r);if(r=n,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(Dn);var qn=function(t){return Ie(t)&&er(t)};var Un=function(t){return qn(t)?t:[]};Hn=function(t){var e=Pr(t,Un);return e.length&&e[0]===t[0]?Rn(e):[]},$n(Ln(Hn,Gn,Cn),Hn+"");var Hn,Gn;function Yn(t){t.value&&"object"==typeof t.value||t.error("only accepts map values")}const Bn=(t,e)=>{const r=Array.from(Object.keys(t)),n=Array.from(Object.keys(e));return!!Er(new Set(r),new Set(n))&&r.reduce((r,n)=>r&&e[n]===t[n],!0)};class Kn extends Object{}function Wn(t,e){const r=[...e.value.keys()];t.value.forEach((t,n)=>{if(!r.includes(n))throw Wr(`key ${n} must be present in ${r.join(", ")}`,e)})}const Jn=(t,e)=>{const r=new Kn;if(Object.assign(r,e.value),Array.isArray(t.value)){const e=[...t.value];for(;e.length;){r[e.shift()]=e.shift()}}else Object.assign(r,t.value);t.complete(),e.send("next",r)},Xn=(t,e)=>{const r=t.value;t.subscribe({complete(){e.fieldSubjects.has(r)&&(e.fieldSubjects.get(r).complete(),e.fieldSubjects.delete(r));const t={...e.value};delete t[r],e._valueSubject.next(t)}})},Qn=(t,e)=>{const r={...e.value};Object.assign(r,t.value),t.next(r)};class Zn extends sn{constructor(t,e){if("object"!=typeof t)throw new Error("ValueObjectStream requires an object as a starting value");super({...t},e),this.setStages("next",Yr),this.setStages(Ur,Hr),Fr(e,"noNewKeys")&&this.when(Wn,bn),this._watchSet()}_watchSet(){this.when(Yn,fn),this.when(Qn,ln),this.when(Yn,hn),this.when(Jn,pn),this.when(Xn,vn)}onField(t,e,r="E_PRECOMMIT"){const n=Array.isArray(e)?[...e]:[e],o=t=>!(!t||"object"!=typeof t)&&(!(t instanceof Kn)&&!!n.find(e=>e in t)),i=new en(Ur,o,r),s=this.when(t,i),u=new en({action:"next",stage:"E_PRE_MAP_MERGE",value:o});return this.when(t,u).subscribe({complete:()=>s.complete(),error:t=>s.error(t)})}has(t){return t in this.value}set(t,e,r){if("object"==typeof t)return this.send(Ur,t);if(!r&&this.fieldSubjects.has(t)){this._lastEvent=null,this._lastError=null;const r=this.fieldSubjects.get(t);r._lastError=null,r._lastEvent=null,r.next(e);let n=this._lastEvent;if(!r._lastError||n&&n.thrownError||(n=r._lastEvent&&r._lastEvent.thrownError?r._lastEvent:{thrownError:r._lastError}),n)try{n.value}catch{return{value:Kr,thrownError:n.thrownError}}return n}return this.send(Ur,{[t]:e})}get(t){return this.value[t]}get object(){return{...this.value}}_valueProxy(){return new Proxy(this,{get:(t,e)=>t.get(e),set:(t,e,r)=>t.set(e,r)})}get my(){return"undefined"!=typeof Proxy?(this._myProxy||(this._myProxy=this._valueProxy()),this._myProxy):this.object}delete(t){this.send("A_DELETE",t)}watch(...t){const e=qr(t),r="function"==typeof e[e.length-1]?e.pop():null,n=new Map;e.forEach(t=>{t in this.value&&(n[t]=this.value[t])});const o=new x(n);return this.on(t=>{t.subscribe({complete:()=>{o.next(t.target.value)}})},"next","E_COMMIT"),o.pipe(O(t=>{const r={};return e.forEach(e=>{e in t&&(r[e]=t[e])}),r}),G(r||Bn))}}cn(Zn);const to=/^set(.+)$/i;const eo="action,stage,value,target".split(",");return{...Zr,addActions:(t,e)=>Object.assign(t,{addActions:e=>(Jr(e).forEach((e,r)=>{t.addAction(r,e)}),t),_actions:Jr(e),addAction:(e,r)=>"function"!=typeof r?(console.error("cannot add ",e," -- not a function",r),t):(t._actions.has(e)&&console.warn("redefining action",e),t._actions.set(e,r),t),get do(){return t._doProxy||("undefined"==typeof Proxy?t._doProxy=(t=>{const e={};t._actions.forEach((r,n)=>{e[n]=(...e)=>(t.debug&&console.warn("using non-proxy action"),r(t,...e))});return(t.value instanceof Map?t.value.keys():Object.keys(t.value)).forEach(r=>{e[r]=e=>(t.debug&&console.warn("using non-proxy set"),t.set(r,e))}),e})(t):t._doProxy=(t=>new Proxy(t,{get(e,r){if("constructor"===r)return console.log("--- why do we care about constructor"),null;if(e._actions.has(r))return(...t)=>e._actions.get(r)(e,...t);if("function"==typeof e.set){const t=""+r;if(to.test(t)){const[r,n]=to.exec(t),o=n.substr(0,1).toLowerCase()+n.substr(1);if(e.has(o))return t=>e.set(o,t);if(e.has(n))return t=>e.set(n,t)}}throw console.log("unknown action:",r,"in stream",t),Wr("no action "+r,e)}}))(t)),t._doProxy}}),matchEvent:(...t)=>{const e=((t,e,r,n)=>t&&"object"==typeof t?eo.map(e=>e in t?t[e]:Kr):[t,e,r,n])(...t),r=new Map;return eo.forEach((t,n)=>{if(e.length<=n)return;const o=e[n];o!==Kr&&("function"==typeof o?r.set(t,o):void 0!==o&&r.set(t,t=>t===o))}),r.size||console.warn("eventFilter with no tests has been crated, with args",t),Object.assign(t=>{if("function"==typeof r.get("value")&&t.target&&t.target.debug&&console.log("----- matchEvent:",e),t.isComplete||!r.size)return"function"==typeof r.get("value")&&t.target&&t.target.debug&&console.log("----- matchEvent on complete event, returning false"),!1;const n=[...r.keys()].reduce((e,n)=>{if(!e)return e;const o=r.get(n),i=t[n];let s=!0;try{s=o(i)}catch(t){console.log("matchEvent error with ",o.toString(),"on",i),s=!1}return console.log("test of ",n,"result ",s,"for",t.toString()),s},!0);return console.log("----- matchEvent:     final result:",n,"for",t),n},{tests:r,props:e})},Event:tn,EventFilter:en,ValueStream:sn,ValueStreamFast:rn,ValueMapStream:Sn,ValueMapStreamFast:jn,ValueObjectStream:Zn,setProxy:function(t){if("undefined"!=typeof Proxy){return new Proxy(new Set,{get(e,r){if(r in e)return"function"==typeof e[r]?(...n)=>{t(r,n,Kr);const o=e[r].apply(e,n);return t(r,n,o),o}:e[r]}})}return new Set},addTrans:t=>Object.assign(t,{_transStream:new x(new Set),addTrans(e){e||(e=new S);const r=t._transStream.value;r.add(e),t._transStream.next(r);const n=()=>{t.finishTrans(e)};return e.subscribe({complete:n,error:n}),e},subscribe:(...e)=>function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=null;return"function"==typeof t[t.length-1]&&(r=t.pop()),1===t.length&&u(t[0])&&(t=t[0].slice()),function(e){return e.lift.call($([e].concat(t)),new F(r))}}([t._valueSubject,t._transStream]).pipe(O(([t,e])=>[t,e.size]),q(([t,e])=>e<1),O(([t])=>t),G()).subscribe(...e),doTrans(t,...e){if("function"!=typeof t)throw Wr("doTrans requires a function",this);const r=this.addTrans();let n=null;try{n=t(r,...e)}catch(t){throw r.isStopped||r.error(t),t}return r.isStopped||r.complete(),n},finishTrans(e){const r=new Set(t._transStream.value);r.has(e)&&(r.remove(e),t._transStream.next(r))}})}}));
