!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).LGE=e()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};function e(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}function r(t){return"function"==typeof t}var n=!1,o={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;n=t},get useDeprecatedSynchronousErrorHandling(){return n}};function i(t){setTimeout((function(){throw t}),0)}var s={closed:!0,next:function(t){},error:function(t){if(o.useDeprecatedSynchronousErrorHandling)throw t;i(t)},complete:function(){}},u=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();function c(t){return null!==t&&"object"==typeof t}var a=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),h=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var e;if(!this.closed){var n=this._parentOrParents,o=this._ctorUnsubscribe,i=this._unsubscribe,s=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof t)n.remove(this);else if(null!==n)for(var h=0;h<n.length;++h){n[h].remove(this)}if(r(i)){o&&(this._unsubscribe=void 0);try{i.call(this)}catch(t){e=t instanceof a?f(t.errors):[t]}}if(u(s)){h=-1;for(var l=s.length;++h<l;){var p=s[h];if(c(p))try{p.unsubscribe()}catch(t){e=e||[],t instanceof a?e=e.concat(f(t.errors)):e.push(t)}}}if(e)throw new a(e)}},t.prototype.add=function(e){var r=e;if(!e)return t.EMPTY;switch(typeof e){case"function":r=new t(e);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof t)){var n=r;(r=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var o=r._parentOrParents;if(null===o)r._parentOrParents=this;else if(o instanceof t){if(o===this)return r;r._parentOrParents=[o,this]}else{if(-1!==o.indexOf(this))return r;o.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[r]:i.push(r),r},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function f(t){return t.reduce((function(t,e){return t.concat(e instanceof a?e.errors:e)}),[])}var l=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),p=function(t){function r(e,n,o){var i=t.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=s;break;case 1:if(!e){i.destination=s;break}if("object"==typeof e){e instanceof r?(i.syncErrorThrowable=e.syncErrorThrowable,i.destination=e,e.add(i)):(i.syncErrorThrowable=!0,i.destination=new b(i,e));break}default:i.syncErrorThrowable=!0,i.destination=new b(i,e,n,o)}return i}return e(r,t),r.prototype[l]=function(){return this},r.create=function(t,e,n){var o=new r(t,e,n);return o.syncErrorThrowable=!1,o},r.prototype.next=function(t){this.isStopped||this._next(t)},r.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},r.prototype._next=function(t){this.destination.next(t)},r.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},r}(h),b=function(t){function n(e,n,o,i){var u,c=t.call(this)||this;c._parentSubscriber=e;var a=c;return r(n)?u=n:n&&(u=n.next,o=n.error,i=n.complete,n!==s&&(r((a=Object.create(n)).unsubscribe)&&c.add(a.unsubscribe.bind(a)),a.unsubscribe=c.unsubscribe.bind(c))),c._context=a,c._next=u,c._error=o,c._complete=i,c}return e(n,t),n.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;o.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},n.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,r=o.useDeprecatedSynchronousErrorHandling;if(this._error)r&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):i(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;i(t)}}},n.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var r=function(){return t._complete.call(t._context)};o.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},n.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),o.useDeprecatedSynchronousErrorHandling)throw t;i(t)}},n.prototype.__tryOrSetError=function(t,e,r){if(!o.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(e){return o.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(i(e),!0)}return!1},n.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},n}(p);var d=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function v(t){return t}function y(t){return 0===t.length?v:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var _=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n=this.operator,i=function(t,e,r){if(t){if(t instanceof p)return t;if(t[l])return t[l]()}return t||e||r?new p(t,e,r):new p(s)}(t,e,r);if(n?i.add(n.call(i,this.source)):i.add(this.source||o.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),o.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){o.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),!function(t){for(;t;){var e=t,r=e.closed,n=e.destination,o=e.isStopped;if(r||o)return!1;t=n&&n instanceof p?n:null}return!0}(t)?console.warn(e):t.error(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=g(e))((function(e,n){var o;o=r.subscribe((function(e){try{t(e)}catch(t){n(t),o&&o.unsubscribe()}}),n,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[d]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:y(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=g(t))((function(t,r){var n;e.subscribe((function(t){return n=t}),(function(t){return r(t)}),(function(){return t(n)}))}))},t.create=function(e){return new t(e)},t}();function g(t){if(t||(t=Promise),!t)throw new Error("no Promise impl found");return t}var w=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),E=function(t){function r(e,r){var n=t.call(this)||this;return n.subject=e,n.subscriber=r,n.closed=!1,n}return e(r,t),r.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var r=e.indexOf(this.subscriber);-1!==r&&e.splice(r,1)}}},r}(h),m=function(t){function r(e){var r=t.call(this,e)||this;return r.destination=e,r}return e(r,t),r}(p),S=function(t){function r(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return e(r,t),r.prototype[l]=function(){return new m(this)},r.prototype.lift=function(t){var e=new j(this,this);return e.operator=t,e},r.prototype.next=function(t){if(this.closed)throw new w;if(!this.isStopped)for(var e=this.observers,r=e.length,n=e.slice(),o=0;o<r;o++)n[o].next(t)},r.prototype.error=function(t){if(this.closed)throw new w;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,r=e.length,n=e.slice(),o=0;o<r;o++)n[o].error(t);this.observers.length=0},r.prototype.complete=function(){if(this.closed)throw new w;this.isStopped=!0;for(var t=this.observers,e=t.length,r=t.slice(),n=0;n<e;n++)r[n].complete();this.observers.length=0},r.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},r.prototype._trySubscribe=function(e){if(this.closed)throw new w;return t.prototype._trySubscribe.call(this,e)},r.prototype._subscribe=function(t){if(this.closed)throw new w;return this.hasError?(t.error(this.thrownError),h.EMPTY):this.isStopped?(t.complete(),h.EMPTY):(this.observers.push(t),new E(this,t))},r.prototype.asObservable=function(){var t=new _;return t.source=this,t},r.create=function(t,e){return new j(t,e)},r}(_),j=function(t){function r(e,r){var n=t.call(this)||this;return n.destination=e,n.source=r,n}return e(r,t),r.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},r.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},r.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},r.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):h.EMPTY},r}(S),x=function(t){function r(e){var r=t.call(this)||this;return r._value=e,r}return e(r,t),Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),r.prototype._subscribe=function(e){var r=t.prototype._subscribe.call(this,e);return r&&!r.closed&&e.next(this._value),r},r.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new w;return this._value},r.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},r}(S);function O(t,e){return function(r){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new T(t,e))}}var T=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new M(t,this.project,this.thisArg))},t}(),M=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.project=r,o.count=0,o.thisArg=n||o,o}return e(r,t),r.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},r}(p),A=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e(r,t),r.prototype.notifyNext=function(t,e,r,n,o){this.destination.next(e)},r.prototype.notifyError=function(t,e){this.destination.error(t)},r.prototype.notifyComplete=function(t){this.destination.complete()},r}(p),P=function(t){function r(e,r,n){var o=t.call(this)||this;return o.parent=e,o.outerValue=r,o.outerIndex=n,o.index=0,o}return e(r,t),r.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},r.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},r}(p);function I(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var R=I(),C=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function L(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var k=function(t){if(t&&"function"==typeof t[d])return o=t,function(t){var e=o[d]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if(C(t))return n=t,function(t){for(var e=0,r=n.length;e<r&&!t.closed;e++)t.next(n[e]);t.complete()};if(L(t))return r=t,function(t){return r.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,i),t};if(t&&"function"==typeof t[R])return e=t,function(t){for(var r=e[R]();;){var n=void 0;try{n=r.next()}catch(e){return t.error(e),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}return"function"==typeof r.return&&t.add((function(){r.return&&r.return()})),t};var e,r,n,o,s=c(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+s+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function z(t,e,r,n,o){if(void 0===o&&(o=new P(t,r,n)),!o.closed)return e instanceof _?e.subscribe(o):k(e)(o)}var V={},D=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new N(t,this.resultSelector))},t}(),N=function(t){function r(e,r){var n=t.call(this,e)||this;return n.resultSelector=r,n.active=0,n.values=[],n.observables=[],n}return e(r,t),r.prototype._next=function(t){this.values.push(V),this.observables.push(t)},r.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var r=0;r<e;r++){var n=t[r];this.add(z(this,n,void 0,r))}}},r.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},r.prototype.notifyNext=function(t,e,r){var n=this.values,o=n[r],i=this.toRespond?o===V?--this.toRespond:this.toRespond:0;n[r]=e,0===i&&(this.resultSelector?this._tryResultSelector(n):this.destination.next(n.slice()))},r.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},r}(A);function F(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[d]}(t))return function(t,e){return new _((function(r){var n=new h;return n.add(e.schedule((function(){var o=t[d]();n.add(o.subscribe({next:function(t){n.add(e.schedule((function(){return r.next(t)})))},error:function(t){n.add(e.schedule((function(){return r.error(t)})))},complete:function(){n.add(e.schedule((function(){return r.complete()})))}}))}))),n}))}(t,e);if(L(t))return function(t,e){return new _((function(r){var n=new h;return n.add(e.schedule((function(){return t.then((function(t){n.add(e.schedule((function(){r.next(t),n.add(e.schedule((function(){return r.complete()})))})))}),(function(t){n.add(e.schedule((function(){return r.error(t)})))}))}))),n}))}(t,e);if(C(t))return function(t,e){return new _((function(r){var n=new h,o=0;return n.add(e.schedule((function(){o!==t.length?(r.next(t[o++]),r.closed||n.add(this.schedule())):r.complete()}))),n}))}(t,e);if(function(t){return t&&"function"==typeof t[R]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new _((function(r){var n,o=new h;return o.add((function(){n&&"function"==typeof n.return&&n.return()})),o.add(e.schedule((function(){n=t[R](),o.add(e.schedule((function(){if(!r.closed){var t,e;try{var o=n.next();t=o.value,e=o.done}catch(t){return void r.error(t)}e?r.complete():(r.next(t),this.schedule())}})))}))),o}))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function q(t,e){return e?F(t,e):t instanceof _?t:new _(k(t))}var $=function(t){function r(e){var r=t.call(this)||this;return r.parent=e,r}return e(r,t),r.prototype._next=function(t){this.parent.notifyNext(t)},r.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},r}(p),U=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e(r,t),r.prototype.notifyNext=function(t){this.destination.next(t)},r.prototype.notifyError=function(t){this.destination.error(t)},r.prototype.notifyComplete=function(){this.destination.complete()},r}(p);function H(t,e){if(!e.closed)return t instanceof _?t.subscribe(e):k(t)(e)}function Y(t,e){return function(r){return r.lift(new G(t,e))}}var G=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new B(t,this.predicate,this.thisArg))},t}(),B=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.predicate=r,o.thisArg=n,o.count=0,o}return e(r,t),r.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},r}(p);var K=function(){function t(t){this.selector=t}return t.prototype.call=function(t,e){return e.subscribe(new W(t,this.selector,this.caught))},t}(),W=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.selector=r,o.caught=n,o}return e(r,t),r.prototype.error=function(e){if(!this.isStopped){var r=void 0;try{r=this.selector(e,this.caught)}catch(e){return void t.prototype.error.call(this,e)}this._unsubscribeAndRecycle();var n=new $(this);this.add(n);var o=H(r,n);o!==n&&this.add(o)}},r}(U);var X=function(){function t(t,e){this.compare=t,this.keySelector=e}return t.prototype.call=function(t,e){return e.subscribe(new J(t,this.compare,this.keySelector))},t}(),J=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.keySelector=n,o.hasKey=!1,"function"==typeof r&&(o.compare=r),o}return e(r,t),r.prototype.compare=function(t,e){return t===e},r.prototype._next=function(t){var e;try{var r=this.keySelector;e=r?r(t):t}catch(t){return this.destination.error(t)}var n=!1;if(this.hasKey)try{n=(0,this.compare)(this.key,e)}catch(t){return this.destination.error(t)}else this.hasKey=!0;n||(this.key=e,this.destination.next(t))},r}(p);var Q=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new Z(t,this.project))},t}(),Z=function(t){function r(e,r){var n=t.call(this,e)||this;return n.project=r,n.index=0,n}return e(r,t),r.prototype._next=function(t){var e,r=this.index++;try{e=this.project(t,r)}catch(t){return void this.destination.error(t)}this._innerSub(e)},r.prototype._innerSub=function(t){var e=this.innerSubscription;e&&e.unsubscribe();var r=new $(this),n=this.destination;n.add(r),this.innerSubscription=H(t,r),this.innerSubscription!==r&&n.add(this.innerSubscription)},r.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},r.prototype._unsubscribe=function(){this.innerSubscription=void 0},r.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&t.prototype._complete.call(this)},r.prototype.notifyNext=function(t){this.destination.next(t)},r}(U);var tt=function(){this.__data__=[],this.size=0};var et=function(t,e){return t===e||t!=t&&e!=e};var rt=function(t,e){for(var r=t.length;r--;)if(et(t[r][0],e))return r;return-1},nt=Array.prototype.splice;var ot=function(t){var e=this.__data__,r=rt(e,t);return!(r<0)&&(r==e.length-1?e.pop():nt.call(e,r,1),--this.size,!0)};var it=function(t){var e=this.__data__,r=rt(e,t);return r<0?void 0:e[r][1]};var st=function(t){return rt(this.__data__,t)>-1};var ut=function(t,e){var r=this.__data__,n=rt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function ct(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ct.prototype.clear=tt,ct.prototype.delete=ot,ct.prototype.get=it,ct.prototype.has=st,ct.prototype.set=ut;var at=ct;var ht=function(){this.__data__=new at,this.size=0};var ft=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r};var lt=function(t){return this.__data__.get(t)};var pt=function(t){return this.__data__.has(t)},bt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function dt(t,e){return t(e={exports:{}},e.exports),e.exports}var vt="object"==typeof bt&&bt&&bt.Object===Object&&bt,yt="object"==typeof self&&self&&self.Object===Object&&self,_t=vt||yt||Function("return this")(),gt=_t.Symbol,wt=Object.prototype,Et=wt.hasOwnProperty,mt=wt.toString,St=gt?gt.toStringTag:void 0;var jt=function(t){var e=Et.call(t,St),r=t[St];try{t[St]=void 0;var n=!0}catch(t){}var o=mt.call(t);return n&&(e?t[St]=r:delete t[St]),o},xt=Object.prototype.toString;var Ot=function(t){return xt.call(t)},Tt=gt?gt.toStringTag:void 0;var Mt=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Tt&&Tt in Object(t)?jt(t):Ot(t)};var At=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var Pt,It=function(t){if(!At(t))return!1;var e=Mt(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},Rt=_t["__core-js_shared__"],Ct=(Pt=/[^.]+$/.exec(Rt&&Rt.keys&&Rt.keys.IE_PROTO||""))?"Symbol(src)_1."+Pt:"";var Lt=function(t){return!!Ct&&Ct in t},kt=Function.prototype.toString;var zt=function(t){if(null!=t){try{return kt.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Vt=/^\[object .+?Constructor\]$/,Dt=Function.prototype,Nt=Object.prototype,Ft=Dt.toString,qt=Nt.hasOwnProperty,$t=RegExp("^"+Ft.call(qt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Ut=function(t){return!(!At(t)||Lt(t))&&(It(t)?$t:Vt).test(zt(t))};var Ht=function(t,e){return null==t?void 0:t[e]};var Yt=function(t,e){var r=Ht(t,e);return Ut(r)?r:void 0},Gt=Yt(_t,"Map"),Bt=Yt(Object,"create");var Kt=function(){this.__data__=Bt?Bt(null):{},this.size=0};var Wt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Xt=Object.prototype.hasOwnProperty;var Jt=function(t){var e=this.__data__;if(Bt){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return Xt.call(e,t)?e[t]:void 0},Qt=Object.prototype.hasOwnProperty;var Zt=function(t){var e=this.__data__;return Bt?void 0!==e[t]:Qt.call(e,t)};var te=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Bt&&void 0===e?"__lodash_hash_undefined__":e,this};function ee(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ee.prototype.clear=Kt,ee.prototype.delete=Wt,ee.prototype.get=Jt,ee.prototype.has=Zt,ee.prototype.set=te;var re=ee;var ne=function(){this.size=0,this.__data__={hash:new re,map:new(Gt||at),string:new re}};var oe=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var ie=function(t,e){var r=t.__data__;return oe(e)?r["string"==typeof e?"string":"hash"]:r.map};var se=function(t){var e=ie(this,t).delete(t);return this.size-=e?1:0,e};var ue=function(t){return ie(this,t).get(t)};var ce=function(t){return ie(this,t).has(t)};var ae=function(t,e){var r=ie(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function he(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}he.prototype.clear=ne,he.prototype.delete=se,he.prototype.get=ue,he.prototype.has=ce,he.prototype.set=ae;var fe=he;var le=function(t,e){var r=this.__data__;if(r instanceof at){var n=r.__data__;if(!Gt||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new fe(n)}return r.set(t,e),this.size=r.size,this};function pe(t){var e=this.__data__=new at(t);this.size=e.size}pe.prototype.clear=ht,pe.prototype.delete=ft,pe.prototype.get=lt,pe.prototype.has=pt,pe.prototype.set=le;var be=pe;var de=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var ve=function(t){return this.__data__.has(t)};function ye(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new fe;++e<r;)this.add(t[e])}ye.prototype.add=ye.prototype.push=de,ye.prototype.has=ve;var _e=ye;var ge=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1};var we=function(t,e){return t.has(e)};var Ee=function(t,e,r,n,o,i){var s=1&r,u=t.length,c=e.length;if(u!=c&&!(s&&c>u))return!1;var a=i.get(t),h=i.get(e);if(a&&h)return a==e&&h==t;var f=-1,l=!0,p=2&r?new _e:void 0;for(i.set(t,e),i.set(e,t);++f<u;){var b=t[f],d=e[f];if(n)var v=s?n(d,b,f,e,t,i):n(b,d,f,t,e,i);if(void 0!==v){if(v)continue;l=!1;break}if(p){if(!ge(e,(function(t,e){if(!we(p,e)&&(b===t||o(b,t,r,n,i)))return p.push(e)}))){l=!1;break}}else if(b!==d&&!o(b,d,r,n,i)){l=!1;break}}return i.delete(t),i.delete(e),l},me=_t.Uint8Array;var Se=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r};var je=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r},xe=gt?gt.prototype:void 0,Oe=xe?xe.valueOf:void 0;var Te=function(t,e,r,n,o,i,s){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new me(t),new me(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return et(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var u=Se;case"[object Set]":var c=1&n;if(u||(u=je),t.size!=e.size&&!c)return!1;var a=s.get(t);if(a)return a==e;n|=2,s.set(t,e);var h=Ee(u(t),u(e),n,o,i,s);return s.delete(t),h;case"[object Symbol]":if(Oe)return Oe.call(t)==Oe.call(e)}return!1};var Me=function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t},Ae=Array.isArray;var Pe=function(t,e,r){var n=e(t);return Ae(t)?n:Me(n,r(t))};var Ie=function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var s=t[r];e(s,r,t)&&(i[o++]=s)}return i};var Re=function(){return[]},Ce=Object.prototype.propertyIsEnumerable,Le=Object.getOwnPropertySymbols,ke=Le?function(t){return null==t?[]:(t=Object(t),Ie(Le(t),(function(e){return Ce.call(t,e)})))}:Re;var ze=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n};var Ve=function(t){return null!=t&&"object"==typeof t};var De=function(t){return Ve(t)&&"[object Arguments]"==Mt(t)},Ne=Object.prototype,Fe=Ne.hasOwnProperty,qe=Ne.propertyIsEnumerable,$e=De(function(){return arguments}())?De:function(t){return Ve(t)&&Fe.call(t,"callee")&&!qe.call(t,"callee")};var Ue=function(){return!1},He=dt((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r?_t.Buffer:void 0,i=(o?o.isBuffer:void 0)||Ue;t.exports=i})),Ye=/^(?:0|[1-9]\d*)$/;var Ge=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&Ye.test(t))&&t>-1&&t%1==0&&t<e};var Be=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},Ke={};Ke["[object Float32Array]"]=Ke["[object Float64Array]"]=Ke["[object Int8Array]"]=Ke["[object Int16Array]"]=Ke["[object Int32Array]"]=Ke["[object Uint8Array]"]=Ke["[object Uint8ClampedArray]"]=Ke["[object Uint16Array]"]=Ke["[object Uint32Array]"]=!0,Ke["[object Arguments]"]=Ke["[object Array]"]=Ke["[object ArrayBuffer]"]=Ke["[object Boolean]"]=Ke["[object DataView]"]=Ke["[object Date]"]=Ke["[object Error]"]=Ke["[object Function]"]=Ke["[object Map]"]=Ke["[object Number]"]=Ke["[object Object]"]=Ke["[object RegExp]"]=Ke["[object Set]"]=Ke["[object String]"]=Ke["[object WeakMap]"]=!1;var We=function(t){return Ve(t)&&Be(t.length)&&!!Ke[Mt(t)]};var Xe=function(t){return function(e){return t(e)}},Je=dt((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r&&vt.process,i=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i})),Qe=Je&&Je.isTypedArray,Ze=Qe?Xe(Qe):We,tr=Object.prototype.hasOwnProperty;var er=function(t,e){var r=Ae(t),n=!r&&$e(t),o=!r&&!n&&He(t),i=!r&&!n&&!o&&Ze(t),s=r||n||o||i,u=s?ze(t.length,String):[],c=u.length;for(var a in t)!e&&!tr.call(t,a)||s&&("length"==a||o&&("offset"==a||"parent"==a)||i&&("buffer"==a||"byteLength"==a||"byteOffset"==a)||Ge(a,c))||u.push(a);return u},rr=Object.prototype;var nr=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||rr)};var or=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),ir=Object.prototype.hasOwnProperty;var sr=function(t){if(!nr(t))return or(t);var e=[];for(var r in Object(t))ir.call(t,r)&&"constructor"!=r&&e.push(r);return e};var ur=function(t){return null!=t&&Be(t.length)&&!It(t)};var cr=function(t){return ur(t)?er(t):sr(t)};var ar=function(t){return Pe(t,cr,ke)},hr=Object.prototype.hasOwnProperty;var fr=function(t,e,r,n,o,i){var s=1&r,u=ar(t),c=u.length;if(c!=ar(e).length&&!s)return!1;for(var a=c;a--;){var h=u[a];if(!(s?h in e:hr.call(e,h)))return!1}var f=i.get(t),l=i.get(e);if(f&&l)return f==e&&l==t;var p=!0;i.set(t,e),i.set(e,t);for(var b=s;++a<c;){var d=t[h=u[a]],v=e[h];if(n)var y=s?n(v,d,h,e,t,i):n(d,v,h,t,e,i);if(!(void 0===y?d===v||o(d,v,r,n,i):y)){p=!1;break}b||(b="constructor"==h)}if(p&&!b){var _=t.constructor,g=e.constructor;_==g||!("constructor"in t)||!("constructor"in e)||"function"==typeof _&&_ instanceof _&&"function"==typeof g&&g instanceof g||(p=!1)}return i.delete(t),i.delete(e),p},lr=Yt(_t,"DataView"),pr=Yt(_t,"Promise"),br=Yt(_t,"Set"),dr=Yt(_t,"WeakMap"),vr=zt(lr),yr=zt(Gt),_r=zt(pr),gr=zt(br),wr=zt(dr),Er=Mt;(lr&&"[object DataView]"!=Er(new lr(new ArrayBuffer(1)))||Gt&&"[object Map]"!=Er(new Gt)||pr&&"[object Promise]"!=Er(pr.resolve())||br&&"[object Set]"!=Er(new br)||dr&&"[object WeakMap]"!=Er(new dr))&&(Er=function(t){var e=Mt(t),r="[object Object]"==e?t.constructor:void 0,n=r?zt(r):"";if(n)switch(n){case vr:return"[object DataView]";case yr:return"[object Map]";case _r:return"[object Promise]";case gr:return"[object Set]";case wr:return"[object WeakMap]"}return e});var mr=Er,Sr=Object.prototype.hasOwnProperty;var jr=function(t,e,r,n,o,i){var s=Ae(t),u=Ae(e),c=s?"[object Array]":mr(t),a=u?"[object Array]":mr(e),h="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),f="[object Object]"==(a="[object Arguments]"==a?"[object Object]":a),l=c==a;if(l&&He(t)){if(!He(e))return!1;s=!0,h=!1}if(l&&!h)return i||(i=new be),s||Ze(t)?Ee(t,e,r,n,o,i):Te(t,e,c,r,n,o,i);if(!(1&r)){var p=h&&Sr.call(t,"__wrapped__"),b=f&&Sr.call(e,"__wrapped__");if(p||b){var d=p?t.value():t,v=b?e.value():e;return i||(i=new be),o(d,v,r,n,i)}}return!!l&&(i||(i=new be),fr(t,e,r,n,o,i))};var xr=function t(e,r,n,o,i){return e===r||(null==e||null==r||!Ve(e)&&!Ve(r)?e!=e&&r!=r:jr(e,r,n,o,t,i))};var Or=function(t,e){return xr(t,e)};var Tr=function(t){return"symbol"==typeof t||Ve(t)&&"[object Symbol]"==Mt(t)},Mr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ar=/^\w*$/;var Pr=function(t,e){if(Ae(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!Tr(t))||(Ar.test(t)||!Mr.test(t)||null!=e&&t in Object(e))};function Ir(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var s=t.apply(this,n);return r.cache=i.set(o,s)||i,s};return r.cache=new(Ir.Cache||fe),r}Ir.Cache=fe;var Rr=Ir;var Cr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Lr=/\\(\\)?/g,kr=function(t){var e=Rr(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Cr,(function(t,r,n,o){e.push(n?o.replace(Lr,"$1"):r||t)})),e}));var zr=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o},Vr=gt?gt.prototype:void 0,Dr=Vr?Vr.toString:void 0;var Nr=function t(e){if("string"==typeof e)return e;if(Ae(e))return zr(e,t)+"";if(Tr(e))return Dr?Dr.call(e):"";var r=e+"";return"0"==r&&1/e==-1/0?"-0":r};var Fr=function(t){return null==t?"":Nr(t)};var qr=function(t,e){return Ae(t)?t:Pr(t,e)?[t]:kr(Fr(t))};var $r=function(t){if("string"==typeof t||Tr(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e};var Ur=function(t,e){for(var r=0,n=(e=qr(e,t)).length;null!=t&&r<n;)t=t[$r(e[r++])];return r&&r==n?t:void 0};var Hr=function(t,e,r){var n=null==t?void 0:Ur(t,e);return void 0===n?r:n};const Yr="A_SET",Gr=["E_INITIAL","E_RESTRICT","E_FILTER","E_VALIDATE","E_PRECOMMIT","E_COMMIT","E_COMPLETE"],Br=new Map([["next",["E_INITIAL","E_FILTER","E_VALIDATE","E_PRECOMMIT","E_COMMIT","E_COMPLETE"]],[Yr,[...Gr]],["A_ANY",["E_INITIAL","E_COMMIT","E_COMPLETE"]]]),Kr=["E_INITIAL","E_FILTER","E_VALIDATE","E_PRE_MAP_MERGE","E_MAP_MERGE","E_PRECOMMIT","E_COMMIT","E_COMPLETE"],Wr="ABSENT",Xr=Wr,Jr=(t,e)=>Object.assign(new Error(t),{meta:e}),Qr=t=>{if(!t)return new Map;if(t instanceof Map)return t;const e=new Map;return"object"==typeof t?([...Object.keys(t)].forEach(r=>e.set(r,t[r])),e):e};var Zr=Object.freeze({__proto__:null,E_INITIAL:"E_INITIAL",E_FILTER:"E_FILTER",E_VALIDATE:"E_VALIDATE",E_PRECOMMIT:"E_PRECOMMIT",E_PRE_MAP_MERGE:"E_PRE_MAP_MERGE",E_MAP_MERGE:"E_MAP_MERGE",E_COMMIT:"E_COMMIT",E_COMPLETE:"E_COMPLETE",E_RESTRICT:"E_RESTRICT",A_NEXT:"next",A_ANY:"A_ANY",A_ACTION:"A_ACTION",A_SET:Yr,A_DELETE:"A_DELETE",setEvents:Gr,defaultEventTree:Br,mapNextEvents:Kr,ABSENT:Wr,"Å":Xr,"eqÅ":(t,e)=>void 0===e||e===Xr||t===e,e:Jr,toMap:Qr});class tn{constructor(t,e,r,n){"object"==typeof t?this._initParams(t):this._initArgs(t,e,r,n),this.target=n}_initParams({action:t=Wr,valueStream:e=Wr,stage:r=Wr}){this._initArgs(t,e,r)}_initArgs(t=Xr,e=Xr,r=Xr,n=Xr){this.action=t,this.valueStream=e,this.stage=r,this.target=n,this.completed=[]}set stage(t){this.stage&&this.completed.push(this.stage),this._stage=t}get stage(){return this._stage}get value(){return this.activeStream?this.valueStream.getValue():Xr}get activeStream(){return!this.valueStream.isStopped&&!this.valueStream.hasError}get isStopped(){return this.valueStream.isStopped}next(t){if(!this.activeStream)throw Jr("attempt to update a stalled stream",this);this.valueStream.next(t)}error(t){this.activeStream?this.valueStream.error(t):console.error("cannot register an error on suspended stream",t,this)}complete(){this.valueStream&&this.valueStream.complete()}subscribe(...t){if(this.valueStream)return this.valueStream.subscribe(...t);throw Jr("attempted to subscribe to a stream-less Event",this)}toString(){const t=["<<"];return this.action!==Xr&&t.push("action: ",this.action.toString()),this.stage!==Xr&&t.push("stage:",this.stage.toString()),this.value!==Xr&&t.push("value",this.value.toString()),t.push(">>"),t.join(" ")}}tn.toEvent=t=>t?t instanceof tn?t:Array.isArray(t)?new tn(...t):new tn(t):new tn({});class en{constructor(t,e,r,n){"object"==typeof t?this._initParams(t):this._initArgs(t,e,r,n)}_initArgs(t=Xr,e=Xr,r=Xr,n=Xr){this.action=t,this.value=e,this.stage=r,this.target=n}_initParams({action:t=Wr,valueStream:e=Wr,stage:r=Wr}){this._initArgs(t,e,r)}_matches(t,e,r){const n=Hr(this,e);if(n===Xr)return!0;if(t instanceof en)return console.error("comparing two EventFilters",this,t),!1;if(t instanceof tn)return this._matches(Hr(t,e),e);if(r){const r=Hr(t,e,Xr);if(r!==Xr)return this._matches(r,e)}return"function"==typeof n?n(t,this):t===n}valueMatches(t,e){return this._matches(t,"value",e)}stageMatches(t,e){return this._matches(t,"stage",e)}nameMatches(t,e){return this._matches(t,"action",e)}matches(t,e){return this.nameMatches(t,e)&&this.stageMatches(t,e)&&this.valueMatches(t,e)}_equals(t,e,r){if(t instanceof en)return console.error("comparing two EventFilters",this,t),!1;if(t instanceof tn)return this._equals(Hr(t,e,Wr),e);if(r){const r=Hr(t,e,Wr);if(r!==Wr)return this._equals(r,e)}return"function"==typeof this[e]?this[e](t,this):Or(Hr(this,e),t)}valueEquals(t,e){return this._equals(t,"value",e)}stageEquals(t,e){return this._equals(t,"stage",e)}nameEquals(t,e){return this._equals(t,"action",e)}equals(t,e){return this.nameEquals(t,e)&&this.stageEquals(t,e)&&this.valueEquals(t,e)}}tn.EventFilter=en;class rn{constructor(t,e={}){this._valueSubject=new x(t),this._errorStream=(new S).pipe(O(t=>t.error&&t.error.message&&!t.message?{...t,message:t.error.message}:t));const{name:r,debug:n=!1,finalize:o}=e;this.name=r||"state_"+Math.random(),this.debug=n}error(t,e){return Hr(t,"error")?this._errorStream.next({...t,target:this}):this._errorStream.next({target:this,event:e,error:t}),this}_updateValue(t){this._valueSubject.next(t)}get isStopped(){return this._valueSubject.isStopped}get closed(){return this._valueSubject.closed}next(t){this._updateValue(t)}get value(){return this._valueSubject.value}getValue(){return this.value}complete(){this._valueSubject.complete(),this._errorStream.complete()}subscribe(t,e,r){if(this.isStopped)throw new Error("cannot subscribe to a stopped stream");if("object"==typeof t){const{next:e,error:r,complete:n}=t;return this.subscribe(e,r,n)}let n;"function"==typeof e&&(n=this._errorStream.subscribe(e));const o={complete:()=>{n&&(n.unsubscribe(),"function"==typeof r&&r())}};return"function"==typeof e&&(o.error=e),"function"==typeof t&&(o.next=t),this._valueSubject.subscribe(o)}pipe(...t){return this._valueSubject.pipe(...t)}}const nn=new en({action:"next",stage:"E_COMMIT"}),on=new en({action:"next",stage:"E_PRECOMMIT"});class sn extends rn{constructor(t,e={}){super(t,e),this._eventTree=new Map(Br),this._errorStream=(new S).pipe(O(t=>t.error&&t.error.message&&!t.message?{...t,message:t.error.message}:t));const{filter:r,finalize:n}=e;"function"==typeof r&&this.filter(r),"function"==typeof n&&this.finalize(n),this._watchEvents()}setStages(t,e){if(!Array.isArray(e)||!e.length)throw new Error("setStages requires a non-empty array");this._eventTree.set(t,e)}get _eventSubject(){return this._$eventSubject||(this._$eventSubject=new S),this._$eventSubject}get _eventStream(){var t;return this._$eventStream||(this._$eventStream=(new S).pipe(function t(e,r){return"function"==typeof r?function(n){return n.pipe(t((function(t,n){return q(e(t,n)).pipe(O((function(e,o){return r(t,e,n,o)})))})))}:function(t){return t.lift(new Q(e))}}(t=>new x(t)),(t=()=>q([Xr]),function(e){var r=new K(t),n=e.lift(r);return r.caught=n}),Y(t=>t instanceof tn))),this._$eventStream}_watchEvents(){this.when(({valueStream:t})=>{this._updateValue(t.value),t.complete()},nn)}filter(t){return this.on(e=>{try{const r=t(e.value,e,this);e.next(r)}catch(t){e.error(t)}},"next","E_FILTER")}finalize(t){return this.when(t,on)}on(t,e="next",r="E_FILTER",n=Xr){if("function"!=typeof t)throw Jr("on() requires function",t);if(e instanceof en)return this.when(t,e);const o=new en({action:e,stage:r,value:n});return this.when(t,o)}when(t,e){if("function"!=typeof t)throw Jr("when() requires function",t);if(!(e instanceof en))throw Jr("cannot call when() without a formal event filter",e);const r=this,n=this._eventStream.pipe(Y(r=>{const n=e.matches(r);return this.debug&&n&&console.log("matched",r.toString(),"to:",t.toString()),n}));return n.subscribe(e=>{this.debug&&console.log("doing ",e.toString(),t.toString()),t(e,r)}),n}send(t,e,r){const n=r||this._eventTree.get(t)||this._eventTree.get("A_ANY"),o=this._errorStream.next.bind(this._errorStream),i=new tn(t,new x(e),n[0],this);i.subscribe({error:o}),q(n).pipe(O(t=>(i.stage=t,i)),Y(t=>!t.isStopped)).subscribe({next:t=>this._eventStream.next(t),complete(){i.isStopped||i.complete()}})}next(t){this.send("next",t)}}var un=gt?gt.isConcatSpreadable:void 0;var cn=function(t){return Ae(t)||$e(t)||!!(un&&t&&t[un])};var an=function t(e,r,n,o,i){var s=-1,u=e.length;for(n||(n=cn),i||(i=[]);++s<u;){var c=e[s];r>0&&n(c)?r>1?t(c,r-1,n,o,i):Me(i,c):o||(i[i.length]=c)}return i};var hn=function(t){return(null==t?0:t.length)?an(t,1/0):[]};const fn=t=>{try{return Array.from(t.keys()).sort().join(",")}catch{return null}},ln=(t,e)=>{if(!(t instanceof Map&&e instanceof Map))return!1;if(t.size!==e.size)return!1;if(!t.size)return!0;const r=fn(t),n=fn(e);if(!r||!n||r!==n)return!1;let o=!0;return t.forEach((t,r)=>{o&&(o=Or(t,e.get(r)))}),o},pn=new en({action:"next",stage:"E_INITIAL"}),bn=new en({action:"next",stage:"E_MAP_MERGE"}),dn=new en({action:Yr,stage:"E_PRECOMMIT"}),vn=new en({action:Yr,stage:"E_COMMIT"}),yn=new en({action:Yr,stage:"E_RESTRICT"}),_n=new en({action:"A_DELETE",stage:"E_COMMIT"}),gn=Symbol("action:set");function wn(t){t.value instanceof Map||t.error("only accepts map values")}function En(t,e){const r=[...e.value.keys()];t.value.forEach((t,n)=>{if(!r.includes(n))throw Jr(`key ${n} must be present in ${r.join(", ")}`,e)})}const mn=(t,e)=>{const r=new Map(e.value);t.value instanceof Map&&t.value.forEach((t,e)=>r.set(e,t)),t.complete(),e.send("next",r)},Sn=(t,e)=>{const r=t.value;t.subscribe({complete(){e.fieldSubjects.has(r)&&(e.fieldSubjects.get(r).complete(),e.fieldSubjects.delete(r));new Map(e.value).delete(r),e._valueSubject.value.delete(r)}})},jn=(t,e)=>{const r=new Map(e.value);t.value instanceof Map&&t.value.forEach((t,e)=>r.set(e,t)),t.next(r)};class xn extends sn{constructor(t,e){super(Qr(t),e),this.fieldSubjects=new Map,this.setStages("next",Kr),this.setStages(Yr,Gr),Hr(e,"noNewKeys")&&this.when(En,yn),this._watchSet()}_watchSet(){this.when(wn,dn),this.when(jn,bn),this.when(wn,pn),this.when(mn,vn),this.when(Sn,_n)}onField(t,e,r="E_PRECOMMIT"){const n=Array.isArray(e)?[...e]:[e],o=t=>{if(!(t instanceof Map))return!1;return[...t.keys()].filter(t=>n.includes(t)).length},i=new en(Yr,o,r),s=this.when(t,i),u=new en({action:"next",stage:"E_PRE_MAP_MERGE",value:o,source:t=>t!==gn}),c=this.when(t,u);return c.subscribe({complete:()=>s.complete(),error:t=>s.error(t)}),c}set(t,e,r){return t instanceof Map?this.send(Yr,t):!r&&this.fieldSubjects.has(t)?this.fieldSubjects.get(t).next(e):this.send(Yr,new Map([[t,e]])),this}addFieldSubject(t,e){if(this.fieldSubjects.has(t))throw Jr("cannot redefine field subject "+t,{key:t,stream:e,target:this});{this.fieldSubjects.set(t,e);const r=e.subscribe(e=>this.set(t,e,!0));this.subscribe({complete(){r.unsubscribe()}})}}get(t){return this.value.get(t)}get object(){return[...this.value.keys()].reduce((t,e)=>{try{t[e]=this.get(e)}catch(t){}return t},{})}_valueProxy(){return new Proxy(this,{get:(t,e)=>t.get(e),set:(t,e,r)=>t.set(e,r)})}get my(){return"undefined"!=typeof Proxy?(this._myProxy||(this._myProxy=this._valueProxy()),this._myProxy):this.object}_fieldProxy(){return new Proxy(this.fieldSubjects,{get:(t,e)=>t.get(e)})}get fields(){return"undefined"!=typeof Proxy?(this._fields||(this._fields=this._fieldProxy()),this._fields):this._fieldObj}get _fieldObj(){const t={};return this.fieldSubjects.forEach((e,r)=>t[r]=e),t}delete(t){this.send("A_DELETE",t)}watch(...t){const e=hn(t),r="function"==typeof e[e.length-1]?e.pop():null,n=new Map;e.forEach(t=>{this.value.has(t)&&n.set(t,this.value.get(t))});const o=new x(n);return this.on(t=>{t.subscribe({complete:()=>{o.next(t.target.value)}})},"next","E_COMMIT"),o.pipe(O(t=>{const r=new Map;return e.forEach(e=>{t.has(e)&&r.set(e,t.get(e))}),r}),(i=r||ln,function(t){return t.lift(new X(i,s))}));var i,s}}const On=/^set(.+)$/i;return{...Zr,addActions:(t,e)=>Object.assign(t,{addActions:e=>(Qr(e).forEach((e,r)=>{t.addAction(r,e)}),t),_actions:Qr(e),addAction:(e,r)=>"function"!=typeof r?(console.error("cannot add ",e," -- not a function",r),t):(t._actions.has(e)&&console.warn("redefining action",e),t._actions.set(e,r),t),get do(){return"undefined"==typeof Proxy?(t=>{const e={};return t._actions.forEach((r,n)=>{e[n]=(...e)=>r(t,...e)}),e})(t):(t._doProxy||(t._doProxy=(t=>new Proxy(t,{get(t,e){if(t._actions.has(e))return(...r)=>t._actions.get(e)(t,...r);if(t instanceof xn){const r=""+e;if(On.test(r)){const[e,n]=On.exec(r),o=n.substr(0,1).toLowerCase+n.substr(1);if(t.value.has(o))return e=>t.set(o,e);const i=n.toLowerCase(),s=[...t.value.keys()].reduce((t,e)=>t||("string"==typeof e?e.toLowerCase()===i&&e:void 0),!1);if(s)return e=>t.set(s,e)}}throw Jr("no action "+e,t)}}))(t)),t._doProxy)}}),Event:tn,EventFilter:en,ValueStream:sn,ValueStreamFast:rn,ValueMapStream:xn,ValueMapStreamFast:class extends rn{constructor(t,e){super(Qr(t),e),this.fieldSubjects=new Map}set(t,e,r){return t instanceof Map?this.next(t):!r&&this.fieldSubjects.has(t)?this.fieldSubjects.get(t).next(e):this.next(new Map([[t,e]])),this}addFieldSubject(t,e){if(this.fieldSubjects.has(t))throw Jr("cannot redefine field subject "+t,{key:t,stream:e,target:this});{this.fieldSubjects.set(t,e);const r=e.subscribe(e=>this.set(t,e,!0));this.subscribe({complete(){r.unsubscribe()}})}}get(t){return this.value.get(t)}get object(){return[...this.value.keys()].reduce((t,e)=>{try{t[e]=this.get(e)}catch(t){}return t},{})}_valueProxy(){return new Proxy(this,{get:(t,e)=>t.get(e),set:(t,e,r)=>t.set(e,r)})}get my(){return"undefined"!=typeof Proxy?(this._myProxy||(this._myProxy=this._valueProxy()),this._myProxy):this.object}_fieldProxy(){return new Proxy(this.fieldSubjects,{get:(t,e)=>t.get(e)})}get fields(){return"undefined"!=typeof Proxy?(this._fields||(this._fields=this._fieldProxy()),this._fields):this._fieldObj}get _fieldObj(){const t={};return this.fieldSubjects.forEach((e,r)=>t[r]=e),t}delete(t){const e=this.value,r=new Map(e);r.delete(t),console.log("deleted: ",t,"from",e,"made",r),this._updateValue(r),console.log("--- after delete value is ",this.value)}next(t){if(!(t instanceof Map))throw new Error("ValueMapStreamFast.next() requires a Map input");const e=this.value,r=new Map(e);t.forEach((t,e)=>{r.set(e,t)}),this._updateValue(r)}},setProxy:function(t){if("undefined"!=typeof Proxy){return new Proxy(new Set,{get(e,r){if(r in e)return"function"==typeof e[r]?(...n)=>{t(r,n,Xr);const o=e[r].apply(e,n);return t(r,n,o),o}:e[r]}})}return new Set},addTrans:t=>Object.assign(t,{transStream:new x(new Set),addTrans(e){const r=new Set(t.transStream.value);r.add(e),t.transStream.next(r);const n=()=>{t.finishTrans(e)};e.subscribe({complete:n,error:n})},subscribe:(...e)=>function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=null;return"function"==typeof t[t.length-1]&&(r=t.pop()),1===t.length&&u(t[0])&&(t=t[0].slice()),function(e){return e.lift.call(q([e].concat(t)),new D(r))}}(t._valueSubject,t.transStream).pipe(O(([t,e])=>[t,e.size]),Y(([t,e])=>e<1),O(([t])=>t)).subscribe(...e),finishTrans(e){const r=new Set(t.transStream.value);r.remove(e),t.transStream.next(r)}})}}));
