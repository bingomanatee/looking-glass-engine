!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).LGE=e()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};function e(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}function r(t){return"function"==typeof t}var n=!1,o={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;n=t},get useDeprecatedSynchronousErrorHandling(){return n}};function i(t){setTimeout((function(){throw t}),0)}var s={closed:!0,next:function(t){},error:function(t){if(o.useDeprecatedSynchronousErrorHandling)throw t;i(t)},complete:function(){}},u=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();function c(t){return null!==t&&"object"==typeof t}var a=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),h=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var e;if(!this.closed){var n=this._parentOrParents,o=this._ctorUnsubscribe,i=this._unsubscribe,s=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof t)n.remove(this);else if(null!==n)for(var h=0;h<n.length;++h){n[h].remove(this)}if(r(i)){o&&(this._unsubscribe=void 0);try{i.call(this)}catch(t){e=t instanceof a?f(t.errors):[t]}}if(u(s)){h=-1;for(var l=s.length;++h<l;){var p=s[h];if(c(p))try{p.unsubscribe()}catch(t){e=e||[],t instanceof a?e=e.concat(f(t.errors)):e.push(t)}}}if(e)throw new a(e)}},t.prototype.add=function(e){var r=e;if(!e)return t.EMPTY;switch(typeof e){case"function":r=new t(e);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof t)){var n=r;(r=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var o=r._parentOrParents;if(null===o)r._parentOrParents=this;else if(o instanceof t){if(o===this)return r;r._parentOrParents=[o,this]}else{if(-1!==o.indexOf(this))return r;o.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[r]:i.push(r),r},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function f(t){return t.reduce((function(t,e){return t.concat(e instanceof a?e.errors:e)}),[])}var l=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),p=function(t){function r(e,n,o){var i=t.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=s;break;case 1:if(!e){i.destination=s;break}if("object"==typeof e){e instanceof r?(i.syncErrorThrowable=e.syncErrorThrowable,i.destination=e,e.add(i)):(i.syncErrorThrowable=!0,i.destination=new b(i,e));break}default:i.syncErrorThrowable=!0,i.destination=new b(i,e,n,o)}return i}return e(r,t),r.prototype[l]=function(){return this},r.create=function(t,e,n){var o=new r(t,e,n);return o.syncErrorThrowable=!1,o},r.prototype.next=function(t){this.isStopped||this._next(t)},r.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},r.prototype._next=function(t){this.destination.next(t)},r.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},r}(h),b=function(t){function n(e,n,o,i){var u,c=t.call(this)||this;c._parentSubscriber=e;var a=c;return r(n)?u=n:n&&(u=n.next,o=n.error,i=n.complete,n!==s&&(r((a=Object.create(n)).unsubscribe)&&c.add(a.unsubscribe.bind(a)),a.unsubscribe=c.unsubscribe.bind(c))),c._context=a,c._next=u,c._error=o,c._complete=i,c}return e(n,t),n.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;o.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},n.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,r=o.useDeprecatedSynchronousErrorHandling;if(this._error)r&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):i(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;i(t)}}},n.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var r=function(){return t._complete.call(t._context)};o.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},n.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),o.useDeprecatedSynchronousErrorHandling)throw t;i(t)}},n.prototype.__tryOrSetError=function(t,e,r){if(!o.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(e){return o.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(i(e),!0)}return!1},n.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},n}(p);var d=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function v(t){return t}function y(t){return 0===t.length?v:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var _=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n=this.operator,i=function(t,e,r){if(t){if(t instanceof p)return t;if(t[l])return t[l]()}return t||e||r?new p(t,e,r):new p(s)}(t,e,r);if(n?i.add(n.call(i,this.source)):i.add(this.source||o.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),o.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){o.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),!function(t){for(;t;){var e=t,r=e.closed,n=e.destination,o=e.isStopped;if(r||o)return!1;t=n&&n instanceof p?n:null}return!0}(t)?console.warn(e):t.error(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=g(e))((function(e,n){var o;o=r.subscribe((function(e){try{t(e)}catch(t){n(t),o&&o.unsubscribe()}}),n,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[d]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:y(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=g(t))((function(t,r){var n;e.subscribe((function(t){return n=t}),(function(t){return r(t)}),(function(){return t(n)}))}))},t.create=function(e){return new t(e)},t}();function g(t){if(t||(t=Promise),!t)throw new Error("no Promise impl found");return t}var w=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),m=function(t){function r(e,r){var n=t.call(this)||this;return n.subject=e,n.subscriber=r,n.closed=!1,n}return e(r,t),r.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var r=e.indexOf(this.subscriber);-1!==r&&e.splice(r,1)}}},r}(h),E=function(t){function r(e){var r=t.call(this,e)||this;return r.destination=e,r}return e(r,t),r}(p),S=function(t){function r(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return e(r,t),r.prototype[l]=function(){return new E(this)},r.prototype.lift=function(t){var e=new j(this,this);return e.operator=t,e},r.prototype.next=function(t){if(this.closed)throw new w;if(!this.isStopped)for(var e=this.observers,r=e.length,n=e.slice(),o=0;o<r;o++)n[o].next(t)},r.prototype.error=function(t){if(this.closed)throw new w;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,r=e.length,n=e.slice(),o=0;o<r;o++)n[o].error(t);this.observers.length=0},r.prototype.complete=function(){if(this.closed)throw new w;this.isStopped=!0;for(var t=this.observers,e=t.length,r=t.slice(),n=0;n<e;n++)r[n].complete();this.observers.length=0},r.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},r.prototype._trySubscribe=function(e){if(this.closed)throw new w;return t.prototype._trySubscribe.call(this,e)},r.prototype._subscribe=function(t){if(this.closed)throw new w;return this.hasError?(t.error(this.thrownError),h.EMPTY):this.isStopped?(t.complete(),h.EMPTY):(this.observers.push(t),new m(this,t))},r.prototype.asObservable=function(){var t=new _;return t.source=this,t},r.create=function(t,e){return new j(t,e)},r}(_),j=function(t){function r(e,r){var n=t.call(this)||this;return n.destination=e,n.source=r,n}return e(r,t),r.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},r.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},r.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},r.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):h.EMPTY},r}(S),x=function(t){function r(e){var r=t.call(this)||this;return r._value=e,r}return e(r,t),Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),r.prototype._subscribe=function(e){var r=t.prototype._subscribe.call(this,e);return r&&!r.closed&&e.next(this._value),r},r.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new w;return this._value},r.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},r}(S);function O(t,e){return function(r){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new P(t,e))}}var P=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new A(t,this.project,this.thisArg))},t}(),A=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.project=r,o.count=0,o.thisArg=n||o,o}return e(r,t),r.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},r}(p),T=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e(r,t),r.prototype.notifyNext=function(t,e,r,n,o){this.destination.next(e)},r.prototype.notifyError=function(t,e){this.destination.error(t)},r.prototype.notifyComplete=function(t){this.destination.complete()},r}(p),M=function(t){function r(e,r,n){var o=t.call(this)||this;return o.parent=e,o.outerValue=r,o.outerIndex=n,o.index=0,o}return e(r,t),r.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},r.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},r}(p);function I(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var R=I(),z=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function k(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var C=function(t){if(t&&"function"==typeof t[d])return o=t,function(t){var e=o[d]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if(z(t))return n=t,function(t){for(var e=0,r=n.length;e<r&&!t.closed;e++)t.next(n[e]);t.complete()};if(k(t))return r=t,function(t){return r.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,i),t};if(t&&"function"==typeof t[R])return e=t,function(t){for(var r=e[R]();;){var n=void 0;try{n=r.next()}catch(e){return t.error(e),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}return"function"==typeof r.return&&t.add((function(){r.return&&r.return()})),t};var e,r,n,o,s=c(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+s+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function L(t,e,r,n,o){if(void 0===o&&(o=new M(t,r,n)),!o.closed)return e instanceof _?e.subscribe(o):C(e)(o)}var V={},D=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new F(t,this.resultSelector))},t}(),F=function(t){function r(e,r){var n=t.call(this,e)||this;return n.resultSelector=r,n.active=0,n.values=[],n.observables=[],n}return e(r,t),r.prototype._next=function(t){this.values.push(V),this.observables.push(t)},r.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var r=0;r<e;r++){var n=t[r];this.add(L(this,n,void 0,r))}}},r.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},r.prototype.notifyNext=function(t,e,r){var n=this.values,o=n[r],i=this.toRespond?o===V?--this.toRespond:this.toRespond:0;n[r]=e,0===i&&(this.resultSelector?this._tryResultSelector(n):this.destination.next(n.slice()))},r.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},r}(T);function N(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[d]}(t))return function(t,e){return new _((function(r){var n=new h;return n.add(e.schedule((function(){var o=t[d]();n.add(o.subscribe({next:function(t){n.add(e.schedule((function(){return r.next(t)})))},error:function(t){n.add(e.schedule((function(){return r.error(t)})))},complete:function(){n.add(e.schedule((function(){return r.complete()})))}}))}))),n}))}(t,e);if(k(t))return function(t,e){return new _((function(r){var n=new h;return n.add(e.schedule((function(){return t.then((function(t){n.add(e.schedule((function(){r.next(t),n.add(e.schedule((function(){return r.complete()})))})))}),(function(t){n.add(e.schedule((function(){return r.error(t)})))}))}))),n}))}(t,e);if(z(t))return function(t,e){return new _((function(r){var n=new h,o=0;return n.add(e.schedule((function(){o!==t.length?(r.next(t[o++]),r.closed||n.add(this.schedule())):r.complete()}))),n}))}(t,e);if(function(t){return t&&"function"==typeof t[R]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new _((function(r){var n,o=new h;return o.add((function(){n&&"function"==typeof n.return&&n.return()})),o.add(e.schedule((function(){n=t[R](),o.add(e.schedule((function(){if(!r.closed){var t,e;try{var o=n.next();t=o.value,e=o.done}catch(t){return void r.error(t)}e?r.complete():(r.next(t),this.schedule())}})))}))),o}))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function q(t,e){return e?N(t,e):t instanceof _?t:new _(C(t))}var $=function(t){function r(e){var r=t.call(this)||this;return r.parent=e,r}return e(r,t),r.prototype._next=function(t){this.parent.notifyNext(t)},r.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},r}(p),U=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e(r,t),r.prototype.notifyNext=function(t){this.destination.next(t)},r.prototype.notifyError=function(t){this.destination.error(t)},r.prototype.notifyComplete=function(){this.destination.complete()},r}(p);function H(t,e){if(!e.closed)return t instanceof _?t.subscribe(e):C(t)(e)}function G(t,e){return function(r){return r.lift(new B(t,e))}}var B=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new Y(t,this.predicate,this.thisArg))},t}(),Y=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.predicate=r,o.thisArg=n,o.count=0,o}return e(r,t),r.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},r}(p);var K=function(){function t(t){this.selector=t}return t.prototype.call=function(t,e){return e.subscribe(new W(t,this.selector,this.caught))},t}(),W=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.selector=r,o.caught=n,o}return e(r,t),r.prototype.error=function(e){if(!this.isStopped){var r=void 0;try{r=this.selector(e,this.caught)}catch(e){return void t.prototype.error.call(this,e)}this._unsubscribeAndRecycle();var n=new $(this);this.add(n);var o=H(r,n);o!==n&&this.add(o)}},r}(U);function X(t,e){return function(r){return r.lift(new J(t,e))}}var J=function(){function t(t,e){this.compare=t,this.keySelector=e}return t.prototype.call=function(t,e){return e.subscribe(new Q(t,this.compare,this.keySelector))},t}(),Q=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.keySelector=n,o.hasKey=!1,"function"==typeof r&&(o.compare=r),o}return e(r,t),r.prototype.compare=function(t,e){return t===e},r.prototype._next=function(t){var e;try{var r=this.keySelector;e=r?r(t):t}catch(t){return this.destination.error(t)}var n=!1;if(this.hasKey)try{n=(0,this.compare)(this.key,e)}catch(t){return this.destination.error(t)}else this.hasKey=!0;n||(this.key=e,this.destination.next(t))},r}(p);var Z=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new tt(t,this.project))},t}(),tt=function(t){function r(e,r){var n=t.call(this,e)||this;return n.project=r,n.index=0,n}return e(r,t),r.prototype._next=function(t){var e,r=this.index++;try{e=this.project(t,r)}catch(t){return void this.destination.error(t)}this._innerSub(e)},r.prototype._innerSub=function(t){var e=this.innerSubscription;e&&e.unsubscribe();var r=new $(this),n=this.destination;n.add(r),this.innerSubscription=H(t,r),this.innerSubscription!==r&&n.add(this.innerSubscription)},r.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},r.prototype._unsubscribe=function(){this.innerSubscription=void 0},r.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&t.prototype._complete.call(this)},r.prototype.notifyNext=function(t){this.destination.next(t)},r}(U),et=Array.isArray,rt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function nt(t,e){return t(e={exports:{}},e.exports),e.exports}var ot="object"==typeof rt&&rt&&rt.Object===Object&&rt,it="object"==typeof self&&self&&self.Object===Object&&self,st=ot||it||Function("return this")(),ut=st.Symbol,ct=Object.prototype,at=ct.hasOwnProperty,ht=ct.toString,ft=ut?ut.toStringTag:void 0;var lt=function(t){var e=at.call(t,ft),r=t[ft];try{t[ft]=void 0;var n=!0}catch(t){}var o=ht.call(t);return n&&(e?t[ft]=r:delete t[ft]),o},pt=Object.prototype.toString;var bt=function(t){return pt.call(t)},dt=ut?ut.toStringTag:void 0;var vt=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":dt&&dt in Object(t)?lt(t):bt(t)};var yt=function(t){return null!=t&&"object"==typeof t};var _t=function(t){return"symbol"==typeof t||yt(t)&&"[object Symbol]"==vt(t)},gt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,wt=/^\w*$/;var mt=function(t,e){if(et(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!_t(t))||(wt.test(t)||!gt.test(t)||null!=e&&t in Object(e))};var Et=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var St,jt=function(t){if(!Et(t))return!1;var e=vt(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},xt=st["__core-js_shared__"],Ot=(St=/[^.]+$/.exec(xt&&xt.keys&&xt.keys.IE_PROTO||""))?"Symbol(src)_1."+St:"";var Pt=function(t){return!!Ot&&Ot in t},At=Function.prototype.toString;var Tt=function(t){if(null!=t){try{return At.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Mt=/^\[object .+?Constructor\]$/,It=Function.prototype,Rt=Object.prototype,zt=It.toString,kt=Rt.hasOwnProperty,Ct=RegExp("^"+zt.call(kt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Lt=function(t){return!(!Et(t)||Pt(t))&&(jt(t)?Ct:Mt).test(Tt(t))};var Vt=function(t,e){return null==t?void 0:t[e]};var Dt=function(t,e){var r=Vt(t,e);return Lt(r)?r:void 0},Ft=Dt(Object,"create");var Nt=function(){this.__data__=Ft?Ft(null):{},this.size=0};var qt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},$t=Object.prototype.hasOwnProperty;var Ut=function(t){var e=this.__data__;if(Ft){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return $t.call(e,t)?e[t]:void 0},Ht=Object.prototype.hasOwnProperty;var Gt=function(t){var e=this.__data__;return Ft?void 0!==e[t]:Ht.call(e,t)};var Bt=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Ft&&void 0===e?"__lodash_hash_undefined__":e,this};function Yt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Yt.prototype.clear=Nt,Yt.prototype.delete=qt,Yt.prototype.get=Ut,Yt.prototype.has=Gt,Yt.prototype.set=Bt;var Kt=Yt;var Wt=function(){this.__data__=[],this.size=0};var Xt=function(t,e){return t===e||t!=t&&e!=e};var Jt=function(t,e){for(var r=t.length;r--;)if(Xt(t[r][0],e))return r;return-1},Qt=Array.prototype.splice;var Zt=function(t){var e=this.__data__,r=Jt(e,t);return!(r<0)&&(r==e.length-1?e.pop():Qt.call(e,r,1),--this.size,!0)};var te=function(t){var e=this.__data__,r=Jt(e,t);return r<0?void 0:e[r][1]};var ee=function(t){return Jt(this.__data__,t)>-1};var re=function(t,e){var r=this.__data__,n=Jt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function ne(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ne.prototype.clear=Wt,ne.prototype.delete=Zt,ne.prototype.get=te,ne.prototype.has=ee,ne.prototype.set=re;var oe=ne,ie=Dt(st,"Map");var se=function(){this.size=0,this.__data__={hash:new Kt,map:new(ie||oe),string:new Kt}};var ue=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var ce=function(t,e){var r=t.__data__;return ue(e)?r["string"==typeof e?"string":"hash"]:r.map};var ae=function(t){var e=ce(this,t).delete(t);return this.size-=e?1:0,e};var he=function(t){return ce(this,t).get(t)};var fe=function(t){return ce(this,t).has(t)};var le=function(t,e){var r=ce(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function pe(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}pe.prototype.clear=se,pe.prototype.delete=ae,pe.prototype.get=he,pe.prototype.has=fe,pe.prototype.set=le;var be=pe;function de(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var s=t.apply(this,n);return r.cache=i.set(o,s)||i,s};return r.cache=new(de.Cache||be),r}de.Cache=be;var ve=de;var ye=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,_e=/\\(\\)?/g,ge=function(t){var e=ve(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(ye,(function(t,r,n,o){e.push(n?o.replace(_e,"$1"):r||t)})),e}));var we=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o},me=ut?ut.prototype:void 0,Ee=me?me.toString:void 0;var Se=function t(e){if("string"==typeof e)return e;if(et(e))return we(e,t)+"";if(_t(e))return Ee?Ee.call(e):"";var r=e+"";return"0"==r&&1/e==-1/0?"-0":r};var je=function(t){return null==t?"":Se(t)};var xe=function(t,e){return et(t)?t:mt(t,e)?[t]:ge(je(t))};var Oe=function(t){if("string"==typeof t||_t(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e};var Pe=function(t,e){for(var r=0,n=(e=xe(e,t)).length;null!=t&&r<n;)t=t[Oe(e[r++])];return r&&r==n?t:void 0};var Ae=function(t,e,r){var n=null==t?void 0:Pe(t,e);return void 0===n?r:n};var Te=function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t};var Me=function(t){return yt(t)&&"[object Arguments]"==vt(t)},Ie=Object.prototype,Re=Ie.hasOwnProperty,ze=Ie.propertyIsEnumerable,ke=Me(function(){return arguments}())?Me:function(t){return yt(t)&&Re.call(t,"callee")&&!ze.call(t,"callee")},Ce=ut?ut.isConcatSpreadable:void 0;var Le=function(t){return et(t)||ke(t)||!!(Ce&&t&&t[Ce])};var Ve=function t(e,r,n,o,i){var s=-1,u=e.length;for(n||(n=Le),i||(i=[]);++s<u;){var c=e[s];r>0&&n(c)?r>1?t(c,r-1,n,o,i):Te(i,c):o||(i[i.length]=c)}return i};var De=function(t){return(null==t?0:t.length)?Ve(t,1/0):[]};const Fe="E_COMMIT",Ne="action:next",qe="action:any",$e="action:set",Ue="action:delete",He=["E_INITIAL","E_RESTRICT","E_FILTER","E_VALIDATE","E_PRECOMMIT",Fe,"E_COMPLETE"],Ge=new Map([[Ne,["E_INITIAL","E_FILTER","E_VALIDATE","E_PRECOMMIT",Fe,"E_COMPLETE"]],[$e,[...He]],[qe,["E_INITIAL",Fe,"E_COMPLETE"]]]),Be=["E_INITIAL","E_FILTER","E_VALIDATE","E_PRE_MAP_MERGE","E_MAP_MERGE","E_PRECOMMIT",Fe,"E_COMPLETE"],Ye="ABSENT",Ke=Ye,We=(t,e)=>{"string"!=typeof t&&(t="");const r=new Error(t);try{e&&(r.meta=e)}catch(t){}return r},Xe=t=>{if(!t)return new Map;if(t instanceof Map)return t;const e=new Map;return"object"==typeof t?([...Object.keys(t)].forEach(r=>e.set(r,t[r])),e):e},Je=(...t)=>De(t).reduce((t,e)=>(e instanceof Map&&e.forEach((e,r)=>{t.set(r,e)}),t),new Map);var Qe=Object.freeze({__proto__:null,E_INITIAL:"E_INITIAL",E_FILTER:"E_FILTER",E_VALIDATE:"E_VALIDATE",E_PRECOMMIT:"E_PRECOMMIT",E_PRE_MAP_MERGE:"E_PRE_MAP_MERGE",E_MAP_MERGE:"E_MAP_MERGE",E_COMMIT:Fe,E_COMPLETE:"E_COMPLETE",E_RESTRICT:"E_RESTRICT",A_NEXT:Ne,A_ANY:qe,A_ACTION:"action:",A_SET:$e,A_DELETE:Ue,setEvents:He,defaultEventTree:Ge,mapNextEvents:Be,ABSENT:Ye,"Å":Ke,"eqÅ":(t,e)=>void 0===e||e===Ke||t===e,e:We,toMap:Xe,mergeMaps:Je});class Ze{constructor(t,e,r,n){"object"==typeof t?this._initParams(t):this._initArgs(t,e,r,n),this.target=n}get params(){return this._params||[]}get notes(){return this._notes||(this._notes=new Map),this._notes}_initParams({action:t=Ye,valueStream:e=Ye,stage:r=Ye}){this._initArgs(t,e,r)}_initArgs(t=Ke,e=Ke,r=Ke,n=Ke){this.action=t,this.valueStream=e,this.stage=r,this.target=n,this.completed=[]}set stage(t){this.stage&&this.completed.push(this.stage),this._stage=t}get stage(){return this._stage}get value(){try{return this.valueStream.getValue()}catch(t){return Ke}}get isActive(){return!this.valueStream.isStopped&&!this.valueStream.hasError}get isStopped(){return Ae(this.valueStream,"isStopped")}get thrownError(){return Ae(this.valueStream,"thrownError")}next(t){if(!this.isActive)throw We("attempt to update a stalled stream",this);this.valueStream.next(t)}error(t){this.isActive?this.valueStream.error(t):console.error("cannot register an error on suspended stream",t,this)}complete(){this.valueStream&&this.valueStream.complete()}subscribe(...t){if(this.valueStream)return this.valueStream.subscribe(...t);throw We("attempted to subscribe to a stream-less Event",this)}toString(){const t=["<<"];return this.action!==Ke&&t.push("action: ",this.action.toString()),this.stage!==Ke&&t.push("stage:",this.stage.toString()),this.value!==Ke&&t.push("value",this.value.toString()),t.push(">>"),t.join(" ")}get list(){return[this.thrownError,this.value]}}Ze.toEvent=t=>t?t instanceof Ze?t:Array.isArray(t)?new Ze(...t):new Ze(t):new Ze({});var tr=function(){this.__data__=new oe,this.size=0};var er=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r};var rr=function(t){return this.__data__.get(t)};var nr=function(t){return this.__data__.has(t)};var or=function(t,e){var r=this.__data__;if(r instanceof oe){var n=r.__data__;if(!ie||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new be(n)}return r.set(t,e),this.size=r.size,this};function ir(t){var e=this.__data__=new oe(t);this.size=e.size}ir.prototype.clear=tr,ir.prototype.delete=er,ir.prototype.get=rr,ir.prototype.has=nr,ir.prototype.set=or;var sr=ir;var ur=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var cr=function(t){return this.__data__.has(t)};function ar(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new be;++e<r;)this.add(t[e])}ar.prototype.add=ar.prototype.push=ur,ar.prototype.has=cr;var hr=ar;var fr=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1};var lr=function(t,e){return t.has(e)};var pr=function(t,e,r,n,o,i){var s=1&r,u=t.length,c=e.length;if(u!=c&&!(s&&c>u))return!1;var a=i.get(t),h=i.get(e);if(a&&h)return a==e&&h==t;var f=-1,l=!0,p=2&r?new hr:void 0;for(i.set(t,e),i.set(e,t);++f<u;){var b=t[f],d=e[f];if(n)var v=s?n(d,b,f,e,t,i):n(b,d,f,t,e,i);if(void 0!==v){if(v)continue;l=!1;break}if(p){if(!fr(e,(function(t,e){if(!lr(p,e)&&(b===t||o(b,t,r,n,i)))return p.push(e)}))){l=!1;break}}else if(b!==d&&!o(b,d,r,n,i)){l=!1;break}}return i.delete(t),i.delete(e),l},br=st.Uint8Array;var dr=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r};var vr=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r},yr=ut?ut.prototype:void 0,_r=yr?yr.valueOf:void 0;var gr=function(t,e,r,n,o,i,s){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new br(t),new br(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Xt(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var u=dr;case"[object Set]":var c=1&n;if(u||(u=vr),t.size!=e.size&&!c)return!1;var a=s.get(t);if(a)return a==e;n|=2,s.set(t,e);var h=pr(u(t),u(e),n,o,i,s);return s.delete(t),h;case"[object Symbol]":if(_r)return _r.call(t)==_r.call(e)}return!1};var wr=function(t,e,r){var n=e(t);return et(t)?n:Te(n,r(t))};var mr=function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var s=t[r];e(s,r,t)&&(i[o++]=s)}return i};var Er=function(){return[]},Sr=Object.prototype.propertyIsEnumerable,jr=Object.getOwnPropertySymbols,xr=jr?function(t){return null==t?[]:(t=Object(t),mr(jr(t),(function(e){return Sr.call(t,e)})))}:Er;var Or=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n};var Pr=function(){return!1},Ar=nt((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r?st.Buffer:void 0,i=(o?o.isBuffer:void 0)||Pr;t.exports=i})),Tr=/^(?:0|[1-9]\d*)$/;var Mr=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&Tr.test(t))&&t>-1&&t%1==0&&t<e};var Ir=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},Rr={};Rr["[object Float32Array]"]=Rr["[object Float64Array]"]=Rr["[object Int8Array]"]=Rr["[object Int16Array]"]=Rr["[object Int32Array]"]=Rr["[object Uint8Array]"]=Rr["[object Uint8ClampedArray]"]=Rr["[object Uint16Array]"]=Rr["[object Uint32Array]"]=!0,Rr["[object Arguments]"]=Rr["[object Array]"]=Rr["[object ArrayBuffer]"]=Rr["[object Boolean]"]=Rr["[object DataView]"]=Rr["[object Date]"]=Rr["[object Error]"]=Rr["[object Function]"]=Rr["[object Map]"]=Rr["[object Number]"]=Rr["[object Object]"]=Rr["[object RegExp]"]=Rr["[object Set]"]=Rr["[object String]"]=Rr["[object WeakMap]"]=!1;var zr=function(t){return yt(t)&&Ir(t.length)&&!!Rr[vt(t)]};var kr=function(t){return function(e){return t(e)}},Cr=nt((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r&&ot.process,i=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i})),Lr=Cr&&Cr.isTypedArray,Vr=Lr?kr(Lr):zr,Dr=Object.prototype.hasOwnProperty;var Fr=function(t,e){var r=et(t),n=!r&&ke(t),o=!r&&!n&&Ar(t),i=!r&&!n&&!o&&Vr(t),s=r||n||o||i,u=s?Or(t.length,String):[],c=u.length;for(var a in t)!e&&!Dr.call(t,a)||s&&("length"==a||o&&("offset"==a||"parent"==a)||i&&("buffer"==a||"byteLength"==a||"byteOffset"==a)||Mr(a,c))||u.push(a);return u},Nr=Object.prototype;var qr=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Nr)};var $r=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),Ur=Object.prototype.hasOwnProperty;var Hr=function(t){if(!qr(t))return $r(t);var e=[];for(var r in Object(t))Ur.call(t,r)&&"constructor"!=r&&e.push(r);return e};var Gr=function(t){return null!=t&&Ir(t.length)&&!jt(t)};var Br=function(t){return Gr(t)?Fr(t):Hr(t)};var Yr=function(t){return wr(t,Br,xr)},Kr=Object.prototype.hasOwnProperty;var Wr=function(t,e,r,n,o,i){var s=1&r,u=Yr(t),c=u.length;if(c!=Yr(e).length&&!s)return!1;for(var a=c;a--;){var h=u[a];if(!(s?h in e:Kr.call(e,h)))return!1}var f=i.get(t),l=i.get(e);if(f&&l)return f==e&&l==t;var p=!0;i.set(t,e),i.set(e,t);for(var b=s;++a<c;){var d=t[h=u[a]],v=e[h];if(n)var y=s?n(v,d,h,e,t,i):n(d,v,h,t,e,i);if(!(void 0===y?d===v||o(d,v,r,n,i):y)){p=!1;break}b||(b="constructor"==h)}if(p&&!b){var _=t.constructor,g=e.constructor;_==g||!("constructor"in t)||!("constructor"in e)||"function"==typeof _&&_ instanceof _&&"function"==typeof g&&g instanceof g||(p=!1)}return i.delete(t),i.delete(e),p},Xr=Dt(st,"DataView"),Jr=Dt(st,"Promise"),Qr=Dt(st,"Set"),Zr=Dt(st,"WeakMap"),tn=Tt(Xr),en=Tt(ie),rn=Tt(Jr),nn=Tt(Qr),on=Tt(Zr),sn=vt;(Xr&&"[object DataView]"!=sn(new Xr(new ArrayBuffer(1)))||ie&&"[object Map]"!=sn(new ie)||Jr&&"[object Promise]"!=sn(Jr.resolve())||Qr&&"[object Set]"!=sn(new Qr)||Zr&&"[object WeakMap]"!=sn(new Zr))&&(sn=function(t){var e=vt(t),r="[object Object]"==e?t.constructor:void 0,n=r?Tt(r):"";if(n)switch(n){case tn:return"[object DataView]";case en:return"[object Map]";case rn:return"[object Promise]";case nn:return"[object Set]";case on:return"[object WeakMap]"}return e});var un=sn,cn=Object.prototype.hasOwnProperty;var an=function(t,e,r,n,o,i){var s=et(t),u=et(e),c=s?"[object Array]":un(t),a=u?"[object Array]":un(e),h="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),f="[object Object]"==(a="[object Arguments]"==a?"[object Object]":a),l=c==a;if(l&&Ar(t)){if(!Ar(e))return!1;s=!0,h=!1}if(l&&!h)return i||(i=new sr),s||Vr(t)?pr(t,e,r,n,o,i):gr(t,e,c,r,n,o,i);if(!(1&r)){var p=h&&cn.call(t,"__wrapped__"),b=f&&cn.call(e,"__wrapped__");if(p||b){var d=p?t.value():t,v=b?e.value():e;return i||(i=new sr),o(d,v,r,n,i)}}return!!l&&(i||(i=new sr),Wr(t,e,r,n,o,i))};var hn=function t(e,r,n,o,i){return e===r||(null==e||null==r||!yt(e)&&!yt(r)?e!=e&&r!=r:an(e,r,n,o,t,i))};var fn=function(t,e){return hn(t,e)};class ln{constructor(t,e,r,n){"object"==typeof t?this._initParams(t):this._initArgs(t,e,r,n)}_initArgs(t=Ke,e=Ke,r=Ke,n=Ke){this.action=t,this.value=e,this.stage=r,this.target=n}_initParams({action:t=Ye,valueStream:e=Ye,stage:r=Ye}){this._initArgs(t,e,r)}_matches(t,e,r){const n=Ae(this,e);if(n===Ke)return!0;if(t instanceof ln)return console.error("comparing two EventFilters",this,t),!1;if(t instanceof Ze)return this._matches(Ae(t,e),e);if(r){const r=Ae(t,e,Ke);if(r!==Ke)return this._matches(r,e)}return"function"==typeof n?("value"===e&&console.log("value comparing ",n.toString(),"against",t),n(t,this)):t===n}valueMatches(t,e){return this._matches(t,"value",e)}stageMatches(t,e){return this._matches(t,"stage",e)}nameMatches(t,e){return this._matches(t,"action",e)}matches(t,e){return this.nameMatches(t,e)&&this.stageMatches(t,e)&&this.valueMatches(t,e)}_equals(t,e,r){if(t instanceof ln)return console.error("comparing two EventFilters",this,t),!1;if(t instanceof Ze)return this._equals(Ae(t,e,Ye),e);if(r){const r=Ae(t,e,Ye);if(r!==Ye)return this._equals(r,e)}return"function"==typeof this[e]?this[e](t,this):fn(Ae(this,e),t)}valueEquals(t,e){return this._equals(t,"value",e)}stageEquals(t,e){return this._equals(t,"stage",e)}nameEquals(t,e){return this._equals(t,"action",e)}equals(t,e){return this.nameEquals(t,e)&&this.stageEquals(t,e)&&this.valueEquals(t,e)}}class pn{constructor(t,e={}){this._valueSubject=new x(t),this._errorStream=(new S).pipe(O(t=>t.error&&t.error.message&&!t.message?{...t,message:t.error.message}:t));const{name:r,debug:n=!1,finalize:o}=e;this.name=r||"state_"+Math.random(),this.debug=n}error(t,e){return Ae(t,"error")?this._errorStream.next({...t,target:this}):this._errorStream.next({target:this,event:e,error:t}),this}_updateValue(t){this._valueSubject.next(t)}get isStopped(){return this._valueSubject.isStopped}get closed(){return this._valueSubject.closed}next(t){this._updateValue(t)}get value(){return this._valueSubject.value}getValue(){return this.value}complete(){this._valueSubject.complete(),this._errorStream.complete()}subscribe(t,e,r){if(this.isStopped)throw new Error("cannot subscribe to a stopped stream");if("object"==typeof t){const{next:e,error:r,complete:n}=t;return this.subscribe(e,r,n)}let n;"function"==typeof e&&(n=this._errorStream.subscribe(e));const o={complete:()=>{n&&(n.unsubscribe(),"function"==typeof r&&r())}};return"function"==typeof e&&(o.error=e),"function"==typeof t&&(o.next=t),this._valueSubject.subscribe(o)}pipe(...t){return this._valueSubject.pipe(...t)}}const bn=new ln({action:Ne,stage:Fe}),dn=new ln({action:Ne,stage:"E_PRECOMMIT"});class vn extends pn{constructor(t,e={}){super(t,e),this._eventTree=new Map(Ge),this._errorStream=(new S).pipe(O(t=>t.error&&t.error.message&&!t.message?{...t,message:t.error.message}:t));const{filter:r,finalize:n}=e;"function"==typeof r&&this.filter(r),"function"==typeof n&&this.finalize(n),this._watchEvents()}setStages(t,e){if(!Array.isArray(e)||!e.length)throw new Error("setStages requires a non-empty array");this._eventTree.set(t,e)}get _eventSubject(){return this._$eventSubject||(this._$eventSubject=new S),this._$eventSubject}get _eventStream(){var t;return this._$eventStream||(this._$eventStream=(new S).pipe(function t(e,r){return"function"==typeof r?function(n){return n.pipe(t((function(t,n){return q(e(t,n)).pipe(O((function(e,o){return r(t,e,n,o)})))})))}:function(t){return t.lift(new Z(e))}}(t=>new x(t)),(t=()=>q([Ke]),function(e){var r=new K(t),n=e.lift(r);return r.caught=n}),G(t=>t instanceof Ze))),this._$eventStream}_watchEvents(){this.when(({valueStream:t})=>{this._updateValue(t.value),t.complete()},bn)}filter(t){return this.on(e=>{try{const r=t(e.value,e,this);e.next(r)}catch(t){e.error(t)}},Ne,"E_FILTER")}finalize(t){return this.when(t,dn)}on(t,e=Ne,r="E_FILTER",n=Ke){if("function"!=typeof t)throw We("on() requires function",t);if(e instanceof ln)return this.when(t,e);const o=new ln({action:e,stage:r,value:n});return this.when(t,o)}when(t,e){if("function"!=typeof t)throw We("when() requires function",t);if(!(e instanceof ln))throw We("cannot call when() without a formal event filter",e);const r=this,n=this._eventStream.pipe(G(r=>{const n=e.matches(r);return this.debug&&n&&console.log("matched",r.toString(),"to:",t.toString()),n}));return n.subscribe(e=>{this.debug&&console.log("doing ",e.toString(),t.toString()),t(e,r)}),n}send(t,e,r){const n=r||this._eventTree.get(t)||this._eventTree.get(qe),o=this._errorStream.next.bind(this._errorStream),i=new Ze(t,new x(e),n[0],this);return i.subscribe({error:o}),q(n).pipe(O(t=>(i.stage=t,i)),G(t=>!t.isStopped)).subscribe({next:t=>this._eventStream.next(t),complete(){i.isStopped||i.complete()}}),i.isStopped||i.complete(),i}next(t){this.send(Ne,t)}}function yn(t){return new Proxy(t,{get:(t,e)=>(console.log("target: ",t,"target fieldSubjects",t.fieldSubjects),t.fieldSubjects.has(e)||console.log("attempt to get undefined fieldSubject",e),t.fieldSubjects.get(e))})}function _n(t,e){if(this.fieldSubjects.has(t))throw We("cannot redefine field subject "+t,{key:t,stream:e,target:this});{this.fieldSubjects.set(t,e);const r=e.subscribe(e=>this.set(t,e,!0));this.subscribe({complete(){r.unsubscribe()}})}}function gn(t){Object.defineProperty(t.prototype,"addFieldSubject",{value:_n}),Object.defineProperty(t.prototype,"fields",{get:function(){return"undefined"!=typeof Proxy?(this._fields||(this._fields=yn(this)),this._fields):this._fieldObj}}),Object.defineProperty(t.prototype,"fieldSubjects",{get:function(){return this._fieldSubjects||(this._fieldSubjects=new Map),this._fieldSubjects}}),Object.defineProperty(t.prototype,"_fieldObj",{get:function(){return"undefined"!=typeof Proxy?(this._fields||(this._fields=yn(this)),this._fields):this._fieldObj}})}const wn=new ln({action:Ne,stage:"E_INITIAL"}),mn=new ln({action:Ne,stage:"E_MAP_MERGE"}),En=new ln({action:$e,stage:"E_PRECOMMIT"}),Sn=new ln({action:$e,stage:Fe}),jn=new ln({action:$e,stage:"E_RESTRICT"}),xn=new ln({action:Ue,stage:Fe});function On(t){return[...t.keys()].reduce((e,r)=>{try{e[r]=t.get(r)}catch(t){}return e},{})}const Pn=t=>{try{return Array.from(t.keys()).sort().join(",")}catch{return null}},An=(t,e)=>{if(!(t instanceof Map&&e instanceof Map))return!1;if(t.size!==e.size)return!1;if(!t.size)return!0;const r=Pn(t),n=Pn(e);if(!r||!n||r!==n)return!1;let o=!0;return t.forEach((t,r)=>{o&&(o=fn(t,e.get(r)))}),o},Tn=Symbol("action:set");function Mn(t){t.value instanceof Map||t.error("only accepts map values")}function In(t,e){const r=[...e.value.keys()];t.value.forEach((t,n)=>{if(!r.includes(n))throw We(`key ${n} must be present in ${r.join(", ")}`,e)})}const Rn=(t,e)=>{const r=Je(e.value,t.value);t.complete(),e.send(Ne,r)},zn=(t,e)=>{const r=t.value;t.subscribe({complete(){e.fieldSubjects.has(r)&&(e.fieldSubjects.get(r).complete(),e.fieldSubjects.delete(r));const t=new Map(e.value);t.delete(r),e._valueSubject.next(t)}})},kn=(t,e)=>{t.next(Je(e.value,t.value))};class Cn extends vn{constructor(t,e){super(Xe(t),e),this.setStages(Ne,Be),this.setStages($e,He),Ae(e,"noNewKeys")&&this.when(In,jn),this._watchSet()}_watchSet(){this.when(Mn,En),this.when(kn,mn),this.when(Mn,wn),this.when(Rn,Sn),this.when(zn,xn)}onField(t,e,r="E_PRECOMMIT"){const n=Array.isArray(e)?[...e]:[e],o=t=>(console.log("--- ifInterSetcs looking for ",n,"in ",t),t instanceof Map&&n.reduce((e,r)=>e||t.has(r),!1)),i=new ln($e,o,r),s=this.when(t,i),u=new ln({action:Ne,stage:"E_PRE_MAP_MERGE",value:o,source:t=>t!==Tn}),c=this.when((...e)=>{3===e[0].value.get("y")&&console.log("---- on straight next:",e),t(...e)},u);return c.subscribe({complete:()=>s.complete(),error:t=>s.error(t)}),c}has(t){return this.value.has(t)}set(t,e,r){if(t instanceof Map)return this.send($e,t);if(!r&&this.fieldSubjects.has(t)){const r=this.fieldSubjects.get(t),n=new Ze($e,new x(this.get(t)));let o=Ke,i=Ke;const s=r.subscribe(t=>i=t,t=>o=t);return r.next(e),i===Ke||n.isStopped||n.next(i),s.unsubscribe(),n}return this.send($e,new Map([[t,e]]))}get(t){return this.value.get(t)}get object(){return On(this.value)}_valueProxy(){return new Proxy(this,{get:(t,e)=>t.get(e),set:(t,e,r)=>t.set(e,r)})}get my(){return"undefined"!=typeof Proxy?(this._myProxy||(this._myProxy=this._valueProxy()),this._myProxy):this.object}get size(){return this.value.size}delete(t){this.send(Ue,t)}watch(...t){const e=De(t),r="function"==typeof e[e.length-1]?e.pop():null,n=new Map;e.forEach(t=>{this.has(t)&&n.set(t,this.get(t))});const o=new x(n);return this.on(t=>{t.subscribe({complete:()=>{o.next(t.target.value)}})},Ne,Fe),o.pipe(O(t=>{const r=new Map;return e.forEach(e=>{t.has(e)&&r.set(e,t.get(e))}),r}),X(r||An))}}gn(Cn);class Ln extends pn{constructor(t,e){super(Xe(t),e)}has(t){return this.value.has(t)}set(t,e,r){return t instanceof Map?this.next(t):!r&&this.fieldSubjects.has(t)?this.fieldSubjects.get(t).next(e):this.next(new Map([[t,e]])),this}get(t){return this.value.get(t)}get object(){return On(this.value)}_valueProxy(){return new Proxy(this,{get:(t,e)=>t.get(e),set:(t,e,r)=>t.set(e,r)})}get my(){return"undefined"!=typeof Proxy?(this._myProxy||(this._myProxy=this._valueProxy()),this._myProxy):this.object}get size(){return this.value.size}get fields(){return"undefined"!=typeof Proxy?(this._fields||(this._fields=this._fieldProxy()),this._fields):this._fieldObj}get _fieldObj(){const t={};return this.fieldSubjects.forEach((e,r)=>t[r]=e),t}delete(t){const e=this.value,r=new Map(e);r.delete(t),this._updateValue(r)}next(t){if(!(t instanceof Map))throw new Error("ValueMapStreamFast.next() requires a Map input");this._updateValue(Je(this.value,t))}}gn(Ln);var Vn=function(t,e,r,n){for(var o=t.length,i=r+(n?1:-1);n?i--:++i<o;)if(e(t[i],i,t))return i;return-1};var Dn=function(t){return t!=t};var Fn=function(t,e,r){for(var n=r-1,o=t.length;++n<o;)if(t[n]===e)return n;return-1};var Nn=function(t,e,r){return e==e?Fn(t,e,r):Vn(t,Dn,r)};var qn=function(t,e){return!!(null==t?0:t.length)&&Nn(t,e,0)>-1};var $n=function(t,e,r){for(var n=-1,o=null==t?0:t.length;++n<o;)if(r(e,t[n]))return!0;return!1},Un=Math.min;var Hn=function(t,e,r){for(var n=r?$n:qn,o=t[0].length,i=t.length,s=i,u=Array(i),c=1/0,a=[];s--;){var h=t[s];s&&e&&(h=we(h,kr(e))),c=Un(h.length,c),u[s]=!r&&(e||o>=120&&h.length>=120)?new hr(s&&h):void 0}h=t[0];var f=-1,l=u[0];t:for(;++f<o&&a.length<c;){var p=h[f],b=e?e(p):p;if(p=r||0!==p?p:0,!(l?lr(l,b):n(a,b,r))){for(s=i;--s;){var d=u[s];if(!(d?lr(d,b):n(t[s],b,r)))continue t}l&&l.push(b),a.push(p)}}return a};var Gn=function(t){return t};var Bn=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)},Yn=Math.max;var Kn=function(t,e,r){return e=Yn(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,i=Yn(n.length-e,0),s=Array(i);++o<i;)s[o]=n[e+o];o=-1;for(var u=Array(e+1);++o<e;)u[o]=n[o];return u[e]=r(s),Bn(t,this,u)}};var Wn=function(t){return function(){return t}},Xn=function(){try{var t=Dt(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Jn=Xn?function(t,e){return Xn(t,"toString",{configurable:!0,enumerable:!1,value:Wn(e),writable:!0})}:Gn,Qn=Date.now;var Zn=function(t){var e=0,r=0;return function(){var n=Qn(),o=16-(n-r);if(r=n,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(Jn);var to=function(t){return yt(t)&&Gr(t)};var eo=function(t){return to(t)?t:[]};ro=function(t){var e=we(t,eo);return e.length&&e[0]===t[0]?Hn(e):[]},Zn(Kn(ro,no,Gn),ro+"");var ro,no;function oo(t){t.value&&"object"==typeof t.value||t.error("only accepts map values")}const io=(t,e)=>{const r=Array.from(Object.keys(t)),n=Array.from(Object.keys(e));return!!fn(new Set(r),new Set(n))&&r.reduce((r,n)=>r&&e[n]===t[n],!0)},so=Symbol("action:set");function uo(t,e){const r=[...e.value.keys()];t.value.forEach((t,n)=>{if(!r.includes(n))throw We(`key ${n} must be present in ${r.join(", ")}`,e)})}const co=(t,e)=>{const r={...e.value};if(Array.isArray(t.value)){const e=[...t.value];for(;e.length;){r[e.shift()]=e.shift()}}else Object.assign(r,t.value);t.complete(),e.send(Ne,r)},ao=(t,e)=>{const r=t.value;t.subscribe({complete(){e.fieldSubjects.has(r)&&(e.fieldSubjects.get(r).complete(),e.fieldSubjects.delete(r));const t={...e.value};delete t[r],e._valueSubject.next(t)}})},ho=(t,e)=>{const r={...e.value};Object.assign(r,t.value),t.next(r)};class fo extends vn{constructor(t,e){if("object"!=typeof t)throw new Error("ValueObjectStream requires an object as a starting value");super({...t},e),this.setStages(Ne,Be),this.setStages($e,He),Ae(e,"noNewKeys")&&this.when(uo,jn),this._watchSet()}_watchSet(){this.when(oo,En),this.when(ho,mn),this.when(oo,wn),this.when(co,Sn),this.when(ao,xn)}get size(){return[...this.value.keys()].length}onField(t,e,r="E_PRECOMMIT"){const n=Array.isArray(e)?[...e]:[e],o=t=>!(!t||"object"!=typeof t)&&!!n.find(e=>e in t),i=new ln($e,o,r),s=this.when(t,i),u=new ln({action:Ne,stage:"E_PRE_MAP_MERGE",value:o,source:t=>t!==so}),c=this.when(t,u);return c.subscribe({complete:()=>s.complete(),error:t=>s.error(t)}),c}has(t){return t in this.value}set(t,e,r){if("object"==typeof t)return this.send($e,t);if(!r&&this.fieldSubjects.has(t)){const r=this.fieldSubjects.get(t),n=new Ze($e,new x(this.get(t)));let o=Ke,i=Ke;const s=r.subscribe(t=>i=t,t=>o=t);return r.next(e),i===Ke||n.isStopped||n.next(i),s.unsubscribe(),n}return this.send($e,{[t]:e})}get(t){return this.value[t]}get object(){return{...this.value}}_valueProxy(){return new Proxy(this,{get:(t,e)=>t.get(e),set:(t,e,r)=>t.set(e,r)})}get my(){return"undefined"!=typeof Proxy?(this._myProxy||(this._myProxy=this._valueProxy()),this._myProxy):this.object}delete(t){this.send(Ue,t)}watch(...t){const e=De(t),r="function"==typeof e[e.length-1]?e.pop():null,n=new Map;e.forEach(t=>{this.has(t)&&(n[t]=this.value[t])});const o=new x(n);return this.on(t=>{t.subscribe({complete:()=>{o.next(t.target.value)}})},Ne,Fe),o.pipe(O(t=>{const r={};return e.forEach(e=>{e in t&&(r[e]=t[e])}),r}),X(r||io))}}gn(fo);const lo=/^set(.+)$/i,po=(t,e)=>new Proxy(t,{get(t,r){if(t._actions.has(r))return e&&"function"==typeof t.send?(...e)=>t.send(r,e):(...e)=>t._actions.get(r)(t,...e);if("function"==typeof t.set){const e=""+r;if(lo.test(e)){const[r,n]=lo.exec(e),o=n.substr(0,1).toLowerCase()+n.substr(1);if(t.has(o))return e=>t.set(o,e);if(t.has(n))return e=>t.set(n,e)}}throw We("no action "+r,t)}}),bo=t=>(t._do&&[...Object.keys(t._do)].length-t.size===t._actions.size||(t._do={},t._actions.keys().forEach(e=>{t._do[e]=(...r)=>t._actions.get(e)(t,...r)})),t._do);return{...Qe,addActions:(t,e)=>(Object.assign(t,{addActions:e=>(Xe(e).forEach((e,r)=>{t.addAction(r,e)}),t),_actions:Xe(e),addAction:(e,r)=>"function"!=typeof r?(console.error("cannot add ",e," -- not a function",r),t):(t._actions.has(e)&&console.warn("redefining action",e),t._actions.set(e,r),t),get do(){return"undefined"==typeof Proxy?bo(t):(t._doProxy||(t._doProxy=po(t)),t._doProxy)},get try(){return"undefined"==typeof Proxy?bo(t):(t._doProxyAct||(t._doProxyAct=po(t,!0)),t._doProxyAct)}}),t.on((t,e)=>{if(!t.isStopped)try{if(!Array.isArray(t.value))throw new Error("action requires array of props: "+t.name);const r=e._actions.get(t.action);if("function"!=typeof r)throw new Error("cannot find action "+t.action);const n=r(e,...t.value);console.log("result of ",t.action,"is",n),t.next(n),t.complete()}catch(e){console.log("action error",e),t.error(e)}},e=>t._actions.has(e),Fe),t.on((t,e)=>{t.isStopped||t.error(new Error(`somehow -- action ${t.action} has not executed`))},e=>t._actions.has(e),"E_COMPLETE"),t),Event:Ze,EventFilter:ln,ValueStream:vn,ValueStreamFast:pn,ValueMapStream:Cn,ValueMapStreamFast:Ln,ValueObjectStream:fo,setProxy:function(t){if("undefined"!=typeof Proxy){return new Proxy(new Set,{get(e,r){if(r in e)return"function"==typeof e[r]?(...n)=>{t(r,n,Ke);const o=e[r].apply(e,n);return t(r,n,o),o}:e[r]}})}return new Set},addTrans:t=>Object.assign(t,{_transStream:new x(new Set),addTrans(e){e||(e=new S);const r=t._transStream.value;r.add(e),t._transStream.next(r);const n=()=>{t.finishTrans(e)};return e.subscribe({complete:n,error:n}),e},subscribe:(...e)=>function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=null;return"function"==typeof t[t.length-1]&&(r=t.pop()),1===t.length&&u(t[0])&&(t=t[0].slice()),function(e){return e.lift.call(q([e].concat(t)),new D(r))}}([t._valueSubject,t._transStream]).pipe(O(([t,e])=>[t,e.size]),G(([t,e])=>e<1),O(([t])=>t),X()).subscribe(...e),doTrans(t,...e){if("function"!=typeof t)throw We("doTrans requires a function",this);const r=this.addTrans();let n=null;try{n=t(r,...e)}catch(t){throw r.isStopped||r.error(t),t}return r.isStopped||r.complete(),n},finishTrans(e){const r=new Set(t._transStream.value);r.has(e)&&(r.remove(e),t._transStream.next(r))}})}}));
