!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).LGE=e()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};function e(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}function r(t){return"function"==typeof t}var n=!1,o={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;n=t},get useDeprecatedSynchronousErrorHandling(){return n}};function i(t){setTimeout((function(){throw t}),0)}var s={closed:!0,next:function(t){},error:function(t){if(o.useDeprecatedSynchronousErrorHandling)throw t;i(t)},complete:function(){}},u=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();function c(t){return null!==t&&"object"==typeof t}var a=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),h=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var e;if(!this.closed){var n=this._parentOrParents,o=this._ctorUnsubscribe,i=this._unsubscribe,s=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof t)n.remove(this);else if(null!==n)for(var h=0;h<n.length;++h){n[h].remove(this)}if(r(i)){o&&(this._unsubscribe=void 0);try{i.call(this)}catch(t){e=t instanceof a?f(t.errors):[t]}}if(u(s)){h=-1;for(var l=s.length;++h<l;){var p=s[h];if(c(p))try{p.unsubscribe()}catch(t){e=e||[],t instanceof a?e=e.concat(f(t.errors)):e.push(t)}}}if(e)throw new a(e)}},t.prototype.add=function(e){var r=e;if(!e)return t.EMPTY;switch(typeof e){case"function":r=new t(e);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof t)){var n=r;(r=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var o=r._parentOrParents;if(null===o)r._parentOrParents=this;else if(o instanceof t){if(o===this)return r;r._parentOrParents=[o,this]}else{if(-1!==o.indexOf(this))return r;o.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[r]:i.push(r),r},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function f(t){return t.reduce((function(t,e){return t.concat(e instanceof a?e.errors:e)}),[])}var l=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),p=function(t){function r(e,n,o){var i=t.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=s;break;case 1:if(!e){i.destination=s;break}if("object"==typeof e){e instanceof r?(i.syncErrorThrowable=e.syncErrorThrowable,i.destination=e,e.add(i)):(i.syncErrorThrowable=!0,i.destination=new b(i,e));break}default:i.syncErrorThrowable=!0,i.destination=new b(i,e,n,o)}return i}return e(r,t),r.prototype[l]=function(){return this},r.create=function(t,e,n){var o=new r(t,e,n);return o.syncErrorThrowable=!1,o},r.prototype.next=function(t){this.isStopped||this._next(t)},r.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},r.prototype._next=function(t){this.destination.next(t)},r.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},r}(h),b=function(t){function n(e,n,o,i){var u,c=t.call(this)||this;c._parentSubscriber=e;var a=c;return r(n)?u=n:n&&(u=n.next,o=n.error,i=n.complete,n!==s&&(r((a=Object.create(n)).unsubscribe)&&c.add(a.unsubscribe.bind(a)),a.unsubscribe=c.unsubscribe.bind(c))),c._context=a,c._next=u,c._error=o,c._complete=i,c}return e(n,t),n.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;o.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},n.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,r=o.useDeprecatedSynchronousErrorHandling;if(this._error)r&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):i(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;i(t)}}},n.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var r=function(){return t._complete.call(t._context)};o.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},n.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),o.useDeprecatedSynchronousErrorHandling)throw t;i(t)}},n.prototype.__tryOrSetError=function(t,e,r){if(!o.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(e){return o.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(i(e),!0)}return!1},n.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},n}(p);var v=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function d(t){return t}function y(t){return 0===t.length?d:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var _=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n=this.operator,i=function(t,e,r){if(t){if(t instanceof p)return t;if(t[l])return t[l]()}return t||e||r?new p(t,e,r):new p(s)}(t,e,r);if(n?i.add(n.call(i,this.source)):i.add(this.source||o.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),o.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){o.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),!function(t){for(;t;){var e=t,r=e.closed,n=e.destination,o=e.isStopped;if(r||o)return!1;t=n&&n instanceof p?n:null}return!0}(t)?console.warn(e):t.error(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=g(e))((function(e,n){var o;o=r.subscribe((function(e){try{t(e)}catch(t){n(t),o&&o.unsubscribe()}}),n,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[v]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:y(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=g(t))((function(t,r){var n;e.subscribe((function(t){return n=t}),(function(t){return r(t)}),(function(){return t(n)}))}))},t.create=function(e){return new t(e)},t}();function g(t){if(t||(t=Promise),!t)throw new Error("no Promise impl found");return t}var w=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),E=function(t){function r(e,r){var n=t.call(this)||this;return n.subject=e,n.subscriber=r,n.closed=!1,n}return e(r,t),r.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var r=e.indexOf(this.subscriber);-1!==r&&e.splice(r,1)}}},r}(h),m=function(t){function r(e){var r=t.call(this,e)||this;return r.destination=e,r}return e(r,t),r}(p),S=function(t){function r(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return e(r,t),r.prototype[l]=function(){return new m(this)},r.prototype.lift=function(t){var e=new j(this,this);return e.operator=t,e},r.prototype.next=function(t){if(this.closed)throw new w;if(!this.isStopped)for(var e=this.observers,r=e.length,n=e.slice(),o=0;o<r;o++)n[o].next(t)},r.prototype.error=function(t){if(this.closed)throw new w;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,r=e.length,n=e.slice(),o=0;o<r;o++)n[o].error(t);this.observers.length=0},r.prototype.complete=function(){if(this.closed)throw new w;this.isStopped=!0;for(var t=this.observers,e=t.length,r=t.slice(),n=0;n<e;n++)r[n].complete();this.observers.length=0},r.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},r.prototype._trySubscribe=function(e){if(this.closed)throw new w;return t.prototype._trySubscribe.call(this,e)},r.prototype._subscribe=function(t){if(this.closed)throw new w;return this.hasError?(t.error(this.thrownError),h.EMPTY):this.isStopped?(t.complete(),h.EMPTY):(this.observers.push(t),new E(this,t))},r.prototype.asObservable=function(){var t=new _;return t.source=this,t},r.create=function(t,e){return new j(t,e)},r}(_),j=function(t){function r(e,r){var n=t.call(this)||this;return n.destination=e,n.source=r,n}return e(r,t),r.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},r.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},r.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},r.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):h.EMPTY},r}(S),x=function(t){function r(e){var r=t.call(this)||this;return r._value=e,r}return e(r,t),Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),r.prototype._subscribe=function(e){var r=t.prototype._subscribe.call(this,e);return r&&!r.closed&&e.next(this._value),r},r.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new w;return this._value},r.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},r}(S);function O(t,e){return function(r){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new A(t,e))}}var A=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new M(t,this.project,this.thisArg))},t}(),M=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.project=r,o.count=0,o.thisArg=n||o,o}return e(r,t),r.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},r}(p),T=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e(r,t),r.prototype.notifyNext=function(t,e,r,n,o){this.destination.next(e)},r.prototype.notifyError=function(t,e){this.destination.error(t)},r.prototype.notifyComplete=function(t){this.destination.complete()},r}(p),P=function(t){function r(e,r,n){var o=t.call(this)||this;return o.parent=e,o.outerValue=r,o.outerIndex=n,o.index=0,o}return e(r,t),r.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},r.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},r}(p);function I(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var R=I(),C=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function L(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var k=function(t){if(t&&"function"==typeof t[v])return o=t,function(t){var e=o[v]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if(C(t))return n=t,function(t){for(var e=0,r=n.length;e<r&&!t.closed;e++)t.next(n[e]);t.complete()};if(L(t))return r=t,function(t){return r.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,i),t};if(t&&"function"==typeof t[R])return e=t,function(t){for(var r=e[R]();;){var n=void 0;try{n=r.next()}catch(e){return t.error(e),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}return"function"==typeof r.return&&t.add((function(){r.return&&r.return()})),t};var e,r,n,o,s=c(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+s+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function z(t,e,r,n,o){if(void 0===o&&(o=new P(t,r,n)),!o.closed)return e instanceof _?e.subscribe(o):k(e)(o)}var V={},D=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new N(t,this.resultSelector))},t}(),N=function(t){function r(e,r){var n=t.call(this,e)||this;return n.resultSelector=r,n.active=0,n.values=[],n.observables=[],n}return e(r,t),r.prototype._next=function(t){this.values.push(V),this.observables.push(t)},r.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var r=0;r<e;r++){var n=t[r];this.add(z(this,n,void 0,r))}}},r.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},r.prototype.notifyNext=function(t,e,r){var n=this.values,o=n[r],i=this.toRespond?o===V?--this.toRespond:this.toRespond:0;n[r]=e,0===i&&(this.resultSelector?this._tryResultSelector(n):this.destination.next(n.slice()))},r.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},r}(T);function F(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[v]}(t))return function(t,e){return new _((function(r){var n=new h;return n.add(e.schedule((function(){var o=t[v]();n.add(o.subscribe({next:function(t){n.add(e.schedule((function(){return r.next(t)})))},error:function(t){n.add(e.schedule((function(){return r.error(t)})))},complete:function(){n.add(e.schedule((function(){return r.complete()})))}}))}))),n}))}(t,e);if(L(t))return function(t,e){return new _((function(r){var n=new h;return n.add(e.schedule((function(){return t.then((function(t){n.add(e.schedule((function(){r.next(t),n.add(e.schedule((function(){return r.complete()})))})))}),(function(t){n.add(e.schedule((function(){return r.error(t)})))}))}))),n}))}(t,e);if(C(t))return function(t,e){return new _((function(r){var n=new h,o=0;return n.add(e.schedule((function(){o!==t.length?(r.next(t[o++]),r.closed||n.add(this.schedule())):r.complete()}))),n}))}(t,e);if(function(t){return t&&"function"==typeof t[R]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new _((function(r){var n,o=new h;return o.add((function(){n&&"function"==typeof n.return&&n.return()})),o.add(e.schedule((function(){n=t[R](),o.add(e.schedule((function(){if(!r.closed){var t,e;try{var o=n.next();t=o.value,e=o.done}catch(t){return void r.error(t)}e?r.complete():(r.next(t),this.schedule())}})))}))),o}))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function q(t,e){return e?F(t,e):t instanceof _?t:new _(k(t))}var $=function(t){function r(e){var r=t.call(this)||this;return r.parent=e,r}return e(r,t),r.prototype._next=function(t){this.parent.notifyNext(t)},r.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},r}(p),U=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e(r,t),r.prototype.notifyNext=function(t){this.destination.next(t)},r.prototype.notifyError=function(t){this.destination.error(t)},r.prototype.notifyComplete=function(){this.destination.complete()},r}(p);function H(t,e){if(!e.closed)return t instanceof _?t.subscribe(e):k(t)(e)}function G(t,e){return function(r){return r.lift(new Y(t,e))}}var Y=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new B(t,this.predicate,this.thisArg))},t}(),B=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.predicate=r,o.thisArg=n,o.count=0,o}return e(r,t),r.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},r}(p);var K=function(){function t(t){this.selector=t}return t.prototype.call=function(t,e){return e.subscribe(new W(t,this.selector,this.caught))},t}(),W=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.selector=r,o.caught=n,o}return e(r,t),r.prototype.error=function(e){if(!this.isStopped){var r=void 0;try{r=this.selector(e,this.caught)}catch(e){return void t.prototype.error.call(this,e)}this._unsubscribeAndRecycle();var n=new $(this);this.add(n);var o=H(r,n);o!==n&&this.add(o)}},r}(U);function X(t,e){return function(r){return r.lift(new J(t,e))}}var J=function(){function t(t,e){this.compare=t,this.keySelector=e}return t.prototype.call=function(t,e){return e.subscribe(new Q(t,this.compare,this.keySelector))},t}(),Q=function(t){function r(e,r,n){var o=t.call(this,e)||this;return o.keySelector=n,o.hasKey=!1,"function"==typeof r&&(o.compare=r),o}return e(r,t),r.prototype.compare=function(t,e){return t===e},r.prototype._next=function(t){var e;try{var r=this.keySelector;e=r?r(t):t}catch(t){return this.destination.error(t)}var n=!1;if(this.hasKey)try{n=(0,this.compare)(this.key,e)}catch(t){return this.destination.error(t)}else this.hasKey=!0;n||(this.key=e,this.destination.next(t))},r}(p);var Z=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new tt(t,this.project))},t}(),tt=function(t){function r(e,r){var n=t.call(this,e)||this;return n.project=r,n.index=0,n}return e(r,t),r.prototype._next=function(t){var e,r=this.index++;try{e=this.project(t,r)}catch(t){return void this.destination.error(t)}this._innerSub(e)},r.prototype._innerSub=function(t){var e=this.innerSubscription;e&&e.unsubscribe();var r=new $(this),n=this.destination;n.add(r),this.innerSubscription=H(t,r),this.innerSubscription!==r&&n.add(this.innerSubscription)},r.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},r.prototype._unsubscribe=function(){this.innerSubscription=void 0},r.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&t.prototype._complete.call(this)},r.prototype.notifyNext=function(t){this.destination.next(t)},r}(U);var et=function(){this.__data__=[],this.size=0};var rt=function(t,e){return t===e||t!=t&&e!=e};var nt=function(t,e){for(var r=t.length;r--;)if(rt(t[r][0],e))return r;return-1},ot=Array.prototype.splice;var it=function(t){var e=this.__data__,r=nt(e,t);return!(r<0)&&(r==e.length-1?e.pop():ot.call(e,r,1),--this.size,!0)};var st=function(t){var e=this.__data__,r=nt(e,t);return r<0?void 0:e[r][1]};var ut=function(t){return nt(this.__data__,t)>-1};var ct=function(t,e){var r=this.__data__,n=nt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function at(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}at.prototype.clear=et,at.prototype.delete=it,at.prototype.get=st,at.prototype.has=ut,at.prototype.set=ct;var ht=at;var ft=function(){this.__data__=new ht,this.size=0};var lt=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r};var pt=function(t){return this.__data__.get(t)};var bt=function(t){return this.__data__.has(t)},vt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function dt(t,e){return t(e={exports:{}},e.exports),e.exports}var yt="object"==typeof vt&&vt&&vt.Object===Object&&vt,_t="object"==typeof self&&self&&self.Object===Object&&self,gt=yt||_t||Function("return this")(),wt=gt.Symbol,Et=Object.prototype,mt=Et.hasOwnProperty,St=Et.toString,jt=wt?wt.toStringTag:void 0;var xt=function(t){var e=mt.call(t,jt),r=t[jt];try{t[jt]=void 0;var n=!0}catch(t){}var o=St.call(t);return n&&(e?t[jt]=r:delete t[jt]),o},Ot=Object.prototype.toString;var At=function(t){return Ot.call(t)},Mt=wt?wt.toStringTag:void 0;var Tt=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Mt&&Mt in Object(t)?xt(t):At(t)};var Pt=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var It,Rt=function(t){if(!Pt(t))return!1;var e=Tt(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},Ct=gt["__core-js_shared__"],Lt=(It=/[^.]+$/.exec(Ct&&Ct.keys&&Ct.keys.IE_PROTO||""))?"Symbol(src)_1."+It:"";var kt=function(t){return!!Lt&&Lt in t},zt=Function.prototype.toString;var Vt=function(t){if(null!=t){try{return zt.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Dt=/^\[object .+?Constructor\]$/,Nt=Function.prototype,Ft=Object.prototype,qt=Nt.toString,$t=Ft.hasOwnProperty,Ut=RegExp("^"+qt.call($t).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Ht=function(t){return!(!Pt(t)||kt(t))&&(Rt(t)?Ut:Dt).test(Vt(t))};var Gt=function(t,e){return null==t?void 0:t[e]};var Yt=function(t,e){var r=Gt(t,e);return Ht(r)?r:void 0},Bt=Yt(gt,"Map"),Kt=Yt(Object,"create");var Wt=function(){this.__data__=Kt?Kt(null):{},this.size=0};var Xt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Jt=Object.prototype.hasOwnProperty;var Qt=function(t){var e=this.__data__;if(Kt){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return Jt.call(e,t)?e[t]:void 0},Zt=Object.prototype.hasOwnProperty;var te=function(t){var e=this.__data__;return Kt?void 0!==e[t]:Zt.call(e,t)};var ee=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Kt&&void 0===e?"__lodash_hash_undefined__":e,this};function re(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}re.prototype.clear=Wt,re.prototype.delete=Xt,re.prototype.get=Qt,re.prototype.has=te,re.prototype.set=ee;var ne=re;var oe=function(){this.size=0,this.__data__={hash:new ne,map:new(Bt||ht),string:new ne}};var ie=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var se=function(t,e){var r=t.__data__;return ie(e)?r["string"==typeof e?"string":"hash"]:r.map};var ue=function(t){var e=se(this,t).delete(t);return this.size-=e?1:0,e};var ce=function(t){return se(this,t).get(t)};var ae=function(t){return se(this,t).has(t)};var he=function(t,e){var r=se(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function fe(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}fe.prototype.clear=oe,fe.prototype.delete=ue,fe.prototype.get=ce,fe.prototype.has=ae,fe.prototype.set=he;var le=fe;var pe=function(t,e){var r=this.__data__;if(r instanceof ht){var n=r.__data__;if(!Bt||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new le(n)}return r.set(t,e),this.size=r.size,this};function be(t){var e=this.__data__=new ht(t);this.size=e.size}be.prototype.clear=ft,be.prototype.delete=lt,be.prototype.get=pt,be.prototype.has=bt,be.prototype.set=pe;var ve=be;var de=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var ye=function(t){return this.__data__.has(t)};function _e(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new le;++e<r;)this.add(t[e])}_e.prototype.add=_e.prototype.push=de,_e.prototype.has=ye;var ge=_e;var we=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1};var Ee=function(t,e){return t.has(e)};var me=function(t,e,r,n,o,i){var s=1&r,u=t.length,c=e.length;if(u!=c&&!(s&&c>u))return!1;var a=i.get(t),h=i.get(e);if(a&&h)return a==e&&h==t;var f=-1,l=!0,p=2&r?new ge:void 0;for(i.set(t,e),i.set(e,t);++f<u;){var b=t[f],v=e[f];if(n)var d=s?n(v,b,f,e,t,i):n(b,v,f,t,e,i);if(void 0!==d){if(d)continue;l=!1;break}if(p){if(!we(e,(function(t,e){if(!Ee(p,e)&&(b===t||o(b,t,r,n,i)))return p.push(e)}))){l=!1;break}}else if(b!==v&&!o(b,v,r,n,i)){l=!1;break}}return i.delete(t),i.delete(e),l},Se=gt.Uint8Array;var je=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r};var xe=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r},Oe=wt?wt.prototype:void 0,Ae=Oe?Oe.valueOf:void 0;var Me=function(t,e,r,n,o,i,s){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new Se(t),new Se(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return rt(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var u=je;case"[object Set]":var c=1&n;if(u||(u=xe),t.size!=e.size&&!c)return!1;var a=s.get(t);if(a)return a==e;n|=2,s.set(t,e);var h=me(u(t),u(e),n,o,i,s);return s.delete(t),h;case"[object Symbol]":if(Ae)return Ae.call(t)==Ae.call(e)}return!1};var Te=function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t},Pe=Array.isArray;var Ie=function(t,e,r){var n=e(t);return Pe(t)?n:Te(n,r(t))};var Re=function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var s=t[r];e(s,r,t)&&(i[o++]=s)}return i};var Ce=function(){return[]},Le=Object.prototype.propertyIsEnumerable,ke=Object.getOwnPropertySymbols,ze=ke?function(t){return null==t?[]:(t=Object(t),Re(ke(t),(function(e){return Le.call(t,e)})))}:Ce;var Ve=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n};var De=function(t){return null!=t&&"object"==typeof t};var Ne=function(t){return De(t)&&"[object Arguments]"==Tt(t)},Fe=Object.prototype,qe=Fe.hasOwnProperty,$e=Fe.propertyIsEnumerable,Ue=Ne(function(){return arguments}())?Ne:function(t){return De(t)&&qe.call(t,"callee")&&!$e.call(t,"callee")};var He=function(){return!1},Ge=dt((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r?gt.Buffer:void 0,i=(o?o.isBuffer:void 0)||He;t.exports=i})),Ye=/^(?:0|[1-9]\d*)$/;var Be=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&Ye.test(t))&&t>-1&&t%1==0&&t<e};var Ke=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},We={};We["[object Float32Array]"]=We["[object Float64Array]"]=We["[object Int8Array]"]=We["[object Int16Array]"]=We["[object Int32Array]"]=We["[object Uint8Array]"]=We["[object Uint8ClampedArray]"]=We["[object Uint16Array]"]=We["[object Uint32Array]"]=!0,We["[object Arguments]"]=We["[object Array]"]=We["[object ArrayBuffer]"]=We["[object Boolean]"]=We["[object DataView]"]=We["[object Date]"]=We["[object Error]"]=We["[object Function]"]=We["[object Map]"]=We["[object Number]"]=We["[object Object]"]=We["[object RegExp]"]=We["[object Set]"]=We["[object String]"]=We["[object WeakMap]"]=!1;var Xe=function(t){return De(t)&&Ke(t.length)&&!!We[Tt(t)]};var Je=function(t){return function(e){return t(e)}},Qe=dt((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r&&yt.process,i=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i})),Ze=Qe&&Qe.isTypedArray,tr=Ze?Je(Ze):Xe,er=Object.prototype.hasOwnProperty;var rr=function(t,e){var r=Pe(t),n=!r&&Ue(t),o=!r&&!n&&Ge(t),i=!r&&!n&&!o&&tr(t),s=r||n||o||i,u=s?Ve(t.length,String):[],c=u.length;for(var a in t)!e&&!er.call(t,a)||s&&("length"==a||o&&("offset"==a||"parent"==a)||i&&("buffer"==a||"byteLength"==a||"byteOffset"==a)||Be(a,c))||u.push(a);return u},nr=Object.prototype;var or=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||nr)};var ir=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),sr=Object.prototype.hasOwnProperty;var ur=function(t){if(!or(t))return ir(t);var e=[];for(var r in Object(t))sr.call(t,r)&&"constructor"!=r&&e.push(r);return e};var cr=function(t){return null!=t&&Ke(t.length)&&!Rt(t)};var ar=function(t){return cr(t)?rr(t):ur(t)};var hr=function(t){return Ie(t,ar,ze)},fr=Object.prototype.hasOwnProperty;var lr=function(t,e,r,n,o,i){var s=1&r,u=hr(t),c=u.length;if(c!=hr(e).length&&!s)return!1;for(var a=c;a--;){var h=u[a];if(!(s?h in e:fr.call(e,h)))return!1}var f=i.get(t),l=i.get(e);if(f&&l)return f==e&&l==t;var p=!0;i.set(t,e),i.set(e,t);for(var b=s;++a<c;){var v=t[h=u[a]],d=e[h];if(n)var y=s?n(d,v,h,e,t,i):n(v,d,h,t,e,i);if(!(void 0===y?v===d||o(v,d,r,n,i):y)){p=!1;break}b||(b="constructor"==h)}if(p&&!b){var _=t.constructor,g=e.constructor;_==g||!("constructor"in t)||!("constructor"in e)||"function"==typeof _&&_ instanceof _&&"function"==typeof g&&g instanceof g||(p=!1)}return i.delete(t),i.delete(e),p},pr=Yt(gt,"DataView"),br=Yt(gt,"Promise"),vr=Yt(gt,"Set"),dr=Yt(gt,"WeakMap"),yr=Vt(pr),_r=Vt(Bt),gr=Vt(br),wr=Vt(vr),Er=Vt(dr),mr=Tt;(pr&&"[object DataView]"!=mr(new pr(new ArrayBuffer(1)))||Bt&&"[object Map]"!=mr(new Bt)||br&&"[object Promise]"!=mr(br.resolve())||vr&&"[object Set]"!=mr(new vr)||dr&&"[object WeakMap]"!=mr(new dr))&&(mr=function(t){var e=Tt(t),r="[object Object]"==e?t.constructor:void 0,n=r?Vt(r):"";if(n)switch(n){case yr:return"[object DataView]";case _r:return"[object Map]";case gr:return"[object Promise]";case wr:return"[object Set]";case Er:return"[object WeakMap]"}return e});var Sr=mr,jr=Object.prototype.hasOwnProperty;var xr=function(t,e,r,n,o,i){var s=Pe(t),u=Pe(e),c=s?"[object Array]":Sr(t),a=u?"[object Array]":Sr(e),h="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),f="[object Object]"==(a="[object Arguments]"==a?"[object Object]":a),l=c==a;if(l&&Ge(t)){if(!Ge(e))return!1;s=!0,h=!1}if(l&&!h)return i||(i=new ve),s||tr(t)?me(t,e,r,n,o,i):Me(t,e,c,r,n,o,i);if(!(1&r)){var p=h&&jr.call(t,"__wrapped__"),b=f&&jr.call(e,"__wrapped__");if(p||b){var v=p?t.value():t,d=b?e.value():e;return i||(i=new ve),o(v,d,r,n,i)}}return!!l&&(i||(i=new ve),lr(t,e,r,n,o,i))};var Or=function t(e,r,n,o,i){return e===r||(null==e||null==r||!De(e)&&!De(r)?e!=e&&r!=r:xr(e,r,n,o,t,i))};var Ar=function(t,e){return Or(t,e)};var Mr=function(t){return"symbol"==typeof t||De(t)&&"[object Symbol]"==Tt(t)},Tr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Pr=/^\w*$/;var Ir=function(t,e){if(Pe(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!Mr(t))||(Pr.test(t)||!Tr.test(t)||null!=e&&t in Object(e))};function Rr(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var s=t.apply(this,n);return r.cache=i.set(o,s)||i,s};return r.cache=new(Rr.Cache||le),r}Rr.Cache=le;var Cr=Rr;var Lr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,kr=/\\(\\)?/g,zr=function(t){var e=Cr(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Lr,(function(t,r,n,o){e.push(n?o.replace(kr,"$1"):r||t)})),e}));var Vr=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o},Dr=wt?wt.prototype:void 0,Nr=Dr?Dr.toString:void 0;var Fr=function t(e){if("string"==typeof e)return e;if(Pe(e))return Vr(e,t)+"";if(Mr(e))return Nr?Nr.call(e):"";var r=e+"";return"0"==r&&1/e==-1/0?"-0":r};var qr=function(t){return null==t?"":Fr(t)};var $r=function(t,e){return Pe(t)?t:Ir(t,e)?[t]:zr(qr(t))};var Ur=function(t){if("string"==typeof t||Mr(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e};var Hr=function(t,e){for(var r=0,n=(e=$r(e,t)).length;null!=t&&r<n;)t=t[Ur(e[r++])];return r&&r==n?t:void 0};var Gr=function(t,e,r){var n=null==t?void 0:Hr(t,e);return void 0===n?r:n},Yr=wt?wt.isConcatSpreadable:void 0;var Br=function(t){return Pe(t)||Ue(t)||!!(Yr&&t&&t[Yr])};var Kr=function t(e,r,n,o,i){var s=-1,u=e.length;for(n||(n=Br),i||(i=[]);++s<u;){var c=e[s];r>0&&n(c)?r>1?t(c,r-1,n,o,i):Te(i,c):o||(i[i.length]=c)}return i};var Wr=function(t){return(null==t?0:t.length)?Kr(t,1/0):[]};const Xr="A_SET",Jr=["E_INITIAL","E_RESTRICT","E_FILTER","E_VALIDATE","E_PRECOMMIT","E_COMMIT","E_COMPLETE"],Qr=new Map([["next",["E_INITIAL","E_FILTER","E_VALIDATE","E_PRECOMMIT","E_COMMIT","E_COMPLETE"]],[Xr,[...Jr]],["A_ANY",["E_INITIAL","E_COMMIT","E_COMPLETE"]]]),Zr=["E_INITIAL","E_FILTER","E_VALIDATE","E_PRE_MAP_MERGE","E_MAP_MERGE","E_PRECOMMIT","E_COMMIT","E_COMPLETE"],tn="ABSENT",en=tn,rn=(t,e)=>Object.assign(new Error(t),{meta:e}),nn=t=>{if(!t)return new Map;if(t instanceof Map)return t;const e=new Map;return"object"==typeof t?([...Object.keys(t)].forEach(r=>e.set(r,t[r])),e):e},on=(...t)=>Wr(t).reduce((t,e)=>(e instanceof Map&&e.forEach((e,r)=>{t.set(r,e)}),t),new Map);var sn=Object.freeze({__proto__:null,E_INITIAL:"E_INITIAL",E_FILTER:"E_FILTER",E_VALIDATE:"E_VALIDATE",E_PRECOMMIT:"E_PRECOMMIT",E_PRE_MAP_MERGE:"E_PRE_MAP_MERGE",E_MAP_MERGE:"E_MAP_MERGE",E_COMMIT:"E_COMMIT",E_COMPLETE:"E_COMPLETE",E_RESTRICT:"E_RESTRICT",A_NEXT:"next",A_ANY:"A_ANY",A_ACTION:"A_ACTION",A_SET:Xr,A_DELETE:"A_DELETE",setEvents:Jr,defaultEventTree:Qr,mapNextEvents:Zr,ABSENT:tn,"Å":en,"eqÅ":(t,e)=>void 0===e||e===en||t===e,e:rn,toMap:nn,mergeMaps:on});class un{constructor(t,e,r,n){"object"==typeof t?this._initParams(t):this._initArgs(t,e,r,n),this.target=n}_initParams({action:t=tn,valueStream:e=tn,stage:r=tn}){this._initArgs(t,e,r)}_initArgs(t=en,e=en,r=en,n=en){this.action=t,this.valueStream=e,this.stage=r,this.target=n,this.completed=[]}set stage(t){this.stage&&this.completed.push(this.stage),this._stage=t}get stage(){return this._stage}get value(){return this.activeStream?this.valueStream.getValue():en}get activeStream(){return!this.valueStream.isStopped&&!this.valueStream.hasError}get isStopped(){return this.valueStream.isStopped}next(t){if(!this.activeStream)throw rn("attempt to update a stalled stream",this);this.valueStream.next(t)}error(t){this.activeStream?this.valueStream.error(t):console.error("cannot register an error on suspended stream",t,this)}complete(){this.valueStream&&this.valueStream.complete()}subscribe(...t){if(this.valueStream)return this.valueStream.subscribe(...t);throw rn("attempted to subscribe to a stream-less Event",this)}toString(){const t=["<<"];return this.action!==en&&t.push("action: ",this.action.toString()),this.stage!==en&&t.push("stage:",this.stage.toString()),this.value!==en&&t.push("value",this.value.toString()),t.push(">>"),t.join(" ")}}un.toEvent=t=>t?t instanceof un?t:Array.isArray(t)?new un(...t):new un(t):new un({});class cn{constructor(t,e,r,n){"object"==typeof t?this._initParams(t):this._initArgs(t,e,r,n)}_initArgs(t=en,e=en,r=en,n=en){this.action=t,this.value=e,this.stage=r,this.target=n}_initParams({action:t=tn,valueStream:e=tn,stage:r=tn}){this._initArgs(t,e,r)}_matches(t,e,r){const n=Gr(this,e);if(n===en)return!0;if(t instanceof cn)return console.error("comparing two EventFilters",this,t),!1;if(t instanceof un)return this._matches(Gr(t,e),e);if(r){const r=Gr(t,e,en);if(r!==en)return this._matches(r,e)}return"function"==typeof n?n(t,this):t===n}valueMatches(t,e){return this._matches(t,"value",e)}stageMatches(t,e){return this._matches(t,"stage",e)}nameMatches(t,e){return this._matches(t,"action",e)}matches(t,e){return this.nameMatches(t,e)&&this.stageMatches(t,e)&&this.valueMatches(t,e)}_equals(t,e,r){if(t instanceof cn)return console.error("comparing two EventFilters",this,t),!1;if(t instanceof un)return this._equals(Gr(t,e,tn),e);if(r){const r=Gr(t,e,tn);if(r!==tn)return this._equals(r,e)}return"function"==typeof this[e]?this[e](t,this):Ar(Gr(this,e),t)}valueEquals(t,e){return this._equals(t,"value",e)}stageEquals(t,e){return this._equals(t,"stage",e)}nameEquals(t,e){return this._equals(t,"action",e)}equals(t,e){return this.nameEquals(t,e)&&this.stageEquals(t,e)&&this.valueEquals(t,e)}}un.EventFilter=cn;class an{constructor(t,e={}){this._valueSubject=new x(t),this._errorStream=(new S).pipe(O(t=>t.error&&t.error.message&&!t.message?{...t,message:t.error.message}:t));const{name:r,debug:n=!1,finalize:o}=e;this.name=r||"state_"+Math.random(),this.debug=n}error(t,e){return Gr(t,"error")?this._errorStream.next({...t,target:this}):this._errorStream.next({target:this,event:e,error:t}),this}_updateValue(t){this._valueSubject.next(t)}get isStopped(){return this._valueSubject.isStopped}get closed(){return this._valueSubject.closed}next(t){this._updateValue(t)}get value(){return this._valueSubject.value}getValue(){return this.value}complete(){this._valueSubject.complete(),this._errorStream.complete()}subscribe(t,e,r){if(this.isStopped)throw new Error("cannot subscribe to a stopped stream");if("object"==typeof t){const{next:e,error:r,complete:n}=t;return this.subscribe(e,r,n)}let n;"function"==typeof e&&(n=this._errorStream.subscribe(e));const o={complete:()=>{n&&(n.unsubscribe(),"function"==typeof r&&r())}};return"function"==typeof e&&(o.error=e),"function"==typeof t&&(o.next=t),this._valueSubject.subscribe(o)}pipe(...t){return this._valueSubject.pipe(...t)}}const hn=new cn({action:"next",stage:"E_COMMIT"}),fn=new cn({action:"next",stage:"E_PRECOMMIT"});class ln extends an{constructor(t,e={}){super(t,e),this._eventTree=new Map(Qr),this._errorStream=(new S).pipe(O(t=>t.error&&t.error.message&&!t.message?{...t,message:t.error.message}:t));const{filter:r,finalize:n}=e;"function"==typeof r&&this.filter(r),"function"==typeof n&&this.finalize(n),this._watchEvents()}setStages(t,e){if(!Array.isArray(e)||!e.length)throw new Error("setStages requires a non-empty array");this._eventTree.set(t,e)}get _eventSubject(){return this._$eventSubject||(this._$eventSubject=new S),this._$eventSubject}get _eventStream(){var t;return this._$eventStream||(this._$eventStream=(new S).pipe(function t(e,r){return"function"==typeof r?function(n){return n.pipe(t((function(t,n){return q(e(t,n)).pipe(O((function(e,o){return r(t,e,n,o)})))})))}:function(t){return t.lift(new Z(e))}}(t=>new x(t)),(t=()=>q([en]),function(e){var r=new K(t),n=e.lift(r);return r.caught=n}),G(t=>t instanceof un))),this._$eventStream}_watchEvents(){this.when(({valueStream:t})=>{this._updateValue(t.value),t.complete()},hn)}filter(t){return this.on(e=>{try{const r=t(e.value,e,this);e.next(r)}catch(t){e.error(t)}},"next","E_FILTER")}finalize(t){return this.when(t,fn)}on(t,e="next",r="E_FILTER",n=en){if("function"!=typeof t)throw rn("on() requires function",t);if(e instanceof cn)return this.when(t,e);const o=new cn({action:e,stage:r,value:n});return this.when(t,o)}when(t,e){if("function"!=typeof t)throw rn("when() requires function",t);if(!(e instanceof cn))throw rn("cannot call when() without a formal event filter",e);const r=this,n=this._eventStream.pipe(G(r=>{const n=e.matches(r);return this.debug&&n&&console.log("matched",r.toString(),"to:",t.toString()),n}));return n.subscribe(e=>{this.debug&&console.log("doing ",e.toString(),t.toString()),t(e,r)}),n}send(t,e,r){const n=r||this._eventTree.get(t)||this._eventTree.get("A_ANY"),o=this._errorStream.next.bind(this._errorStream),i=new un(t,new x(e),n[0],this);i.subscribe({error:o}),q(n).pipe(O(t=>(i.stage=t,i)),G(t=>!t.isStopped)).subscribe({next:t=>this._eventStream.next(t),complete(){i.isStopped||i.complete()}})}next(t){this.send("next",t)}}function pn(t){return new Proxy(t,{get:(t,e)=>(console.log("target: ",t,"target fieldSubjects",t.fieldSubjects),t.fieldSubjects.has(e)||console.log("attempt to get undefined fieldSubject",e),t.fieldSubjects.get(e))})}function bn(t,e){if(this.fieldSubjects.has(t))throw rn("cannot redefine field subject "+t,{key:t,stream:e,target:this});{this.fieldSubjects.set(t,e);const r=e.subscribe(e=>this.set(t,e,!0));this.subscribe({complete(){r.unsubscribe()}})}}function vn(t){Object.defineProperty(t.prototype,"addFieldSubject",{value:bn}),Object.defineProperty(t.prototype,"fields",{get:function(){return"undefined"!=typeof Proxy?(this._fields||(this._fields=pn(this)),this._fields):this._fieldObj}}),Object.defineProperty(t.prototype,"fieldSubjects",{get:function(){return this._fieldSubjects||(this._fieldSubjects=new Map),this._fieldSubjects}}),Object.defineProperty(t.prototype,"_fieldObj",{get:function(){return"undefined"!=typeof Proxy?(this._fields||(this._fields=pn(this)),this._fields):this._fieldObj}})}const dn=new cn({action:"next",stage:"E_INITIAL"}),yn=new cn({action:"next",stage:"E_MAP_MERGE"}),_n=new cn({action:Xr,stage:"E_PRECOMMIT"}),gn=new cn({action:Xr,stage:"E_COMMIT"}),wn=new cn({action:Xr,stage:"E_RESTRICT"}),En=new cn({action:"A_DELETE",stage:"E_COMMIT"}),mn=t=>{try{return Array.from(t.keys()).sort().join(",")}catch{return null}},Sn=(t,e)=>{if(!(t instanceof Map&&e instanceof Map))return!1;if(t.size!==e.size)return!1;if(!t.size)return!0;const r=mn(t),n=mn(e);if(!r||!n||r!==n)return!1;let o=!0;return t.forEach((t,r)=>{o&&(o=Ar(t,e.get(r)))}),o},jn=Symbol("action:set");function xn(t){t.value instanceof Map||t.error("only accepts map values")}function On(t,e){const r=[...e.value.keys()];t.value.forEach((t,n)=>{if(!r.includes(n))throw rn(`key ${n} must be present in ${r.join(", ")}`,e)})}const An=(t,e)=>{const r=on(e.value,t.value);t.complete(),e.send("next",r)},Mn=(t,e)=>{const r=t.value;t.subscribe({complete(){e.fieldSubjects.has(r)&&(e.fieldSubjects.get(r).complete(),e.fieldSubjects.delete(r));const t=new Map(e.value);t.delete(r),e._valueSubject.next(t)}})},Tn=(t,e)=>{t.next(on(e.value,t.value))};class Pn extends ln{constructor(t,e){super(nn(t),e),this.setStages("next",Zr),this.setStages(Xr,Jr),Gr(e,"noNewKeys")&&this.when(On,wn),this._watchSet()}_watchSet(){this.when(xn,_n),this.when(Tn,yn),this.when(xn,dn),this.when(An,gn),this.when(Mn,En)}onField(t,e,r="E_PRECOMMIT"){const n=Array.isArray(e)?[...e]:[e],o=t=>t instanceof Map&&!![...t.keys()].find(t=>n.includes(t)),i=new cn(Xr,o,r),s=this.when(t,i),u=new cn({action:"next",stage:"E_PRE_MAP_MERGE",value:o,source:t=>t!==jn}),c=this.when(t,u);return c.subscribe({complete:()=>s.complete(),error:t=>s.error(t)}),c}set(t,e,r){return t instanceof Map?this.send(Xr,t):!r&&this.fieldSubjects.has(t)?this.fieldSubjects.get(t).next(e):this.send(Xr,new Map([[t,e]])),this}get(t){return this.value.get(t)}get object(){return[...this.value.keys()].reduce((t,e)=>{try{t[e]=this.get(e)}catch(t){}return t},{})}_valueProxy(){return new Proxy(this,{get:(t,e)=>t.get(e),set:(t,e,r)=>t.set(e,r)})}get my(){return"undefined"!=typeof Proxy?(this._myProxy||(this._myProxy=this._valueProxy()),this._myProxy):this.object}delete(t){this.send("A_DELETE",t)}watch(...t){const e=Wr(t),r="function"==typeof e[e.length-1]?e.pop():null,n=new Map;e.forEach(t=>{this.value.has(t)&&n.set(t,this.value.get(t))});const o=new x(n);return this.on(t=>{t.subscribe({complete:()=>{o.next(t.target.value)}})},"next","E_COMMIT"),o.pipe(O(t=>{const r=new Map;return e.forEach(e=>{t.has(e)&&r.set(e,t.get(e))}),r}),X(r||Sn))}}vn(Pn);class In extends an{constructor(t,e){super(nn(t),e)}set(t,e,r){return t instanceof Map?this.next(t):!r&&this.fieldSubjects.has(t)?this.fieldSubjects.get(t).next(e):this.next(new Map([[t,e]])),this}get(t){return this.value.get(t)}get object(){return[...this.value.keys()].reduce((t,e)=>{try{t[e]=this.get(e)}catch(t){}return t},{})}_valueProxy(){return new Proxy(this,{get:(t,e)=>t.get(e),set:(t,e,r)=>t.set(e,r)})}get my(){return"undefined"!=typeof Proxy?(this._myProxy||(this._myProxy=this._valueProxy()),this._myProxy):this.object}get fields(){return"undefined"!=typeof Proxy?(this._fields||(this._fields=this._fieldProxy()),this._fields):this._fieldObj}get _fieldObj(){const t={};return this.fieldSubjects.forEach((e,r)=>t[r]=e),t}delete(t){const e=this.value,r=new Map(e);r.delete(t),console.log("deleted: ",t,"from",e,"made",r),this._updateValue(r),console.log("--- after delete value is ",this.value)}next(t){if(!(t instanceof Map))throw new Error("ValueMapStreamFast.next() requires a Map input");this._updateValue(on(this.value,t))}}vn(In);var Rn=function(t,e,r,n){for(var o=t.length,i=r+(n?1:-1);n?i--:++i<o;)if(e(t[i],i,t))return i;return-1};var Cn=function(t){return t!=t};var Ln=function(t,e,r){for(var n=r-1,o=t.length;++n<o;)if(t[n]===e)return n;return-1};var kn=function(t,e,r){return e==e?Ln(t,e,r):Rn(t,Cn,r)};var zn=function(t,e){return!!(null==t?0:t.length)&&kn(t,e,0)>-1};var Vn=function(t,e,r){for(var n=-1,o=null==t?0:t.length;++n<o;)if(r(e,t[n]))return!0;return!1},Dn=Math.min;var Nn=function(t,e,r){for(var n=r?Vn:zn,o=t[0].length,i=t.length,s=i,u=Array(i),c=1/0,a=[];s--;){var h=t[s];s&&e&&(h=Vr(h,Je(e))),c=Dn(h.length,c),u[s]=!r&&(e||o>=120&&h.length>=120)?new ge(s&&h):void 0}h=t[0];var f=-1,l=u[0];t:for(;++f<o&&a.length<c;){var p=h[f],b=e?e(p):p;if(p=r||0!==p?p:0,!(l?Ee(l,b):n(a,b,r))){for(s=i;--s;){var v=u[s];if(!(v?Ee(v,b):n(t[s],b,r)))continue t}l&&l.push(b),a.push(p)}}return a};var Fn=function(t){return t};var qn=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)},$n=Math.max;var Un=function(t,e,r){return e=$n(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,i=$n(n.length-e,0),s=Array(i);++o<i;)s[o]=n[e+o];o=-1;for(var u=Array(e+1);++o<e;)u[o]=n[o];return u[e]=r(s),qn(t,this,u)}};var Hn=function(t){return function(){return t}},Gn=function(){try{var t=Yt(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Yn=Gn?function(t,e){return Gn(t,"toString",{configurable:!0,enumerable:!1,value:Hn(e),writable:!0})}:Fn,Bn=Date.now;var Kn=function(t){var e=0,r=0;return function(){var n=Bn(),o=16-(n-r);if(r=n,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(Yn);var Wn=function(t){return De(t)&&cr(t)};var Xn=function(t){return Wn(t)?t:[]};Jn=function(t){var e=Vr(t,Xn);return e.length&&e[0]===t[0]?Nn(e):[]},Kn(Un(Jn,Qn,Fn),Jn+"");var Jn,Qn;function Zn(t){t.value&&"object"==typeof t.value||t.error("only accepts map values")}const to=(t,e)=>{const r=Array.from(Object.keys(t)),n=Array.from(Object.keys(e));return!!Ar(new Set(r),new Set(n))&&r.reduce((r,n)=>r&&e[n]===t[n],!0)},eo=Symbol("action:set");function ro(t,e){const r=[...e.value.keys()];t.value.forEach((t,n)=>{if(!r.includes(n))throw rn(`key ${n} must be present in ${r.join(", ")}`,e)})}const no=(t,e)=>{const r={...e.value};if(Array.isArray(t.value)){const e=[...t.value];for(;e.length;){const t=e.shift(),n=e.shift();r[t]=n}}else Object.assign(r,t.value);t.complete(),e.send("next",r)},oo=(t,e)=>{const r=t.value;t.subscribe({complete(){e.fieldSubjects.has(r)&&(e.fieldSubjects.get(r).complete(),e.fieldSubjects.delete(r));const t={...e.value};delete t[r],e._valueSubject.next(t)}})},io=(t,e)=>{const r={...e.value};Object.assign(r,t.value),t.next(r)};class so extends ln{constructor(t,e){if("object"!=typeof t)throw new Error("ValueObjectStream requires an object as a starting value");super({...t},e),this.setStages("next",Zr),this.setStages(Xr,Jr),Gr(e,"noNewKeys")&&this.when(ro,wn),this._watchSet()}_watchSet(){this.when(Zn,_n),this.when(io,yn),this.when(Zn,dn),this.when(no,gn),this.when(oo,En)}onField(t,e,r="E_PRECOMMIT"){const n=Array.isArray(e)?[...e]:[e],o=t=>!(!t||"object"!=typeof t)&&!!n.find(e=>e in t),i=new cn(Xr,o,r),s=this.when(t,i),u=new cn({action:"next",stage:"E_PRE_MAP_MERGE",value:o,source:t=>t!==eo});return this.when(t,u).subscribe({complete:()=>s.complete(),error:t=>s.error(t)})}set(t,e,r){return"object"==typeof t?this.send(Xr,t):!r&&this.fieldSubjects.has(t)?this.fieldSubjects.get(t).next(e):this.send(Xr,{[t]:e}),this}get(t){return this.value[t]}get object(){return{...this.value}}_valueProxy(){return new Proxy(this,{get:(t,e)=>t.get(e),set:(t,e,r)=>t.set(e,r)})}get my(){return"undefined"!=typeof Proxy?(this._myProxy||(this._myProxy=this._valueProxy()),this._myProxy):this.object}delete(t){this.send("A_DELETE",t)}watch(...t){const e=Wr(t),r="function"==typeof e[e.length-1]?e.pop():null,n=new Map;e.forEach(t=>{t in this.value&&(n[t]=this.value[t])});const o=new x(n);return this.on(t=>{t.subscribe({complete:()=>{o.next(t.target.value)}})},"next","E_COMMIT"),o.pipe(O(t=>{const r={};return e.forEach(e=>{e in t&&(r[e]=t[e])}),r}),X(r||to))}}vn(so);const uo=/^set(.+)$/i;return{...sn,addActions:(t,e)=>Object.assign(t,{addActions:e=>(nn(e).forEach((e,r)=>{t.addAction(r,e)}),t),_actions:nn(e),addAction:(e,r)=>"function"!=typeof r?(console.error("cannot add ",e," -- not a function",r),t):(t._actions.has(e)&&console.warn("redefining action",e),t._actions.set(e,r),t),get do(){return"undefined"==typeof Proxy?(t=>{const e={};return t._actions.forEach((r,n)=>{e[n]=(...e)=>r(t,...e)}),e})(t):(t._doProxy||(t._doProxy=(t=>new Proxy(t,{get(t,e){if(t._actions.has(e))return(...r)=>t._actions.get(e)(t,...r);if(t instanceof Pn){const r=""+e;if(uo.test(r)){const[e,n]=uo.exec(r),o=n.substr(0,1).toLowerCase+n.substr(1);if(t.value.has(o))return e=>t.set(o,e);const i=n.toLowerCase(),s=[...t.value.keys()].reduce((t,e)=>t||("string"==typeof e?e.toLowerCase()===i&&e:void 0),!1);if(s)return e=>t.set(s,e)}}throw rn("no action "+e,t)}}))(t)),t._doProxy)}}),Event:un,EventFilter:cn,ValueStream:ln,ValueStreamFast:an,ValueMapStream:Pn,ValueMapStreamFast:In,ValueObjectStream:so,setProxy:function(t){if("undefined"!=typeof Proxy){return new Proxy(new Set,{get(e,r){if(r in e)return"function"==typeof e[r]?(...n)=>{t(r,n,en);const o=e[r].apply(e,n);return t(r,n,o),o}:e[r]}})}return new Set},addTrans:t=>Object.assign(t,{transStream:new x(new Set),addTrans(e){const r=new Set(t.transStream.value);r.add(e),t.transStream.next(r);const n=()=>{t.finishTrans(e)};e.subscribe({complete:n,error:n})},subscribe:(...e)=>function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=null;return"function"==typeof t[t.length-1]&&(r=t.pop()),1===t.length&&u(t[0])&&(t=t[0].slice()),function(e){return e.lift.call(q([e].concat(t)),new D(r))}}(t._valueSubject,t.transStream).pipe(O(([t,e])=>[t,e.size]),G(([t,e])=>e<1),O(([t])=>t)).subscribe(...e),finishTrans(e){const r=new Set(t.transStream.value);r.remove(e),t.transStream.next(r)}})}}));
