!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@wonderlandlabs/validators"),require("@wonderlandlabs/propper")):"function"==typeof define&&define.amd?define(["@wonderlandlabs/validators","@wonderlandlabs/propper"],e):(t=t||self).LGE=e(t.validators,t.propper)}(this,(function(t,e){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;const r=Symbol("ABSENT"),n=t=>t,o=t(),i=o.is("function"),s=o.is("array"),u=o.is("object"),c=o.is("string");o.is("number"),o.is("map"),o.is("set");
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */
var a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function h(t,e){function r(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function f(t){return"function"==typeof t}var p=!1,l={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;p=t},get useDeprecatedSynchronousErrorHandling(){return p}};function b(t){setTimeout((function(){throw t}),0)}var d={closed:!0,next:function(t){},error:function(t){if(l.useDeprecatedSynchronousErrorHandling)throw t;b(t)},complete:function(){}},y=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();function _(t){return null!==t&&"object"==typeof t}var v=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),g=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var e;if(!this.closed){var r=this,n=r._parentOrParents,o=r._ctorUnsubscribe,i=r._unsubscribe,s=r._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof t)n.remove(this);else if(null!==n)for(var u=0;u<n.length;++u){n[u].remove(this)}if(f(i)){o&&(this._unsubscribe=void 0);try{i.call(this)}catch(t){e=t instanceof v?w(t.errors):[t]}}if(y(s)){u=-1;for(var c=s.length;++u<c;){var a=s[u];if(_(a))try{a.unsubscribe()}catch(t){e=e||[],t instanceof v?e=e.concat(w(t.errors)):e.push(t)}}}if(e)throw new v(e)}},t.prototype.add=function(e){var r=e;if(!e)return t.EMPTY;switch(typeof e){case"function":r=new t(e);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof t)){var n=r;(r=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var o=r._parentOrParents;if(null===o)r._parentOrParents=this;else if(o instanceof t){if(o===this)return r;r._parentOrParents=[o,this]}else{if(-1!==o.indexOf(this))return r;o.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[r]:i.push(r),r},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function w(t){return t.reduce((function(t,e){return t.concat(e instanceof v?e.errors:e)}),[])}var S=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),m=function(t){function e(r,n,o){var i=t.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=d;break;case 1:if(!r){i.destination=d;break}if("object"==typeof r){r instanceof e?(i.syncErrorThrowable=r.syncErrorThrowable,i.destination=r,r.add(i)):(i.syncErrorThrowable=!0,i.destination=new E(i,r));break}default:i.syncErrorThrowable=!0,i.destination=new E(i,r,n,o)}return i}return h(e,t),e.prototype[S]=function(){return this},e.create=function(t,r,n){var o=new e(t,r,n);return o.syncErrorThrowable=!1,o},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(g),E=function(t){function e(e,r,n,o){var i,s=t.call(this)||this;s._parentSubscriber=e;var u=s;return f(r)?i=r:r&&(i=r.next,n=r.error,o=r.complete,r!==d&&(f((u=Object.create(r)).unsubscribe)&&s.add(u.unsubscribe.bind(u)),u.unsubscribe=s.unsubscribe.bind(s))),s._context=u,s._next=i,s._error=n,s._complete=o,s}return h(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;l.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,r=l.useDeprecatedSynchronousErrorHandling;if(this._error)r&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):b(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;b(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var r=function(){return t._complete.call(t._context)};l.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),l.useDeprecatedSynchronousErrorHandling)throw t;b(t)}},e.prototype.__tryOrSetError=function(t,e,r){if(!l.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(e){return l.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(b(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(m);var x=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function j(t){return t}function O(t){return 0===t.length?j:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var P=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n=this.operator,o=function(t,e,r){if(t){if(t instanceof m)return t;if(t[S])return t[S]()}return t||e||r?new m(t,e,r):new m(d)}(t,e,r);if(n?o.add(n.call(o,this.source)):o.add(this.source||l.useDeprecatedSynchronousErrorHandling&&!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),l.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){l.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),!function(t){for(;t;){var e=t,r=e.closed,n=e.destination,o=e.isStopped;if(r||o)return!1;t=n&&n instanceof m?n:null}return!0}(t)?console.warn(e):t.error(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=A(e))((function(e,n){var o;o=r.subscribe((function(e){try{t(e)}catch(t){n(t),o&&o.unsubscribe()}}),n,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[x]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:O(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=A(t))((function(t,r){var n;e.subscribe((function(t){return n=t}),(function(t){return r(t)}),(function(){return t(n)}))}))},t.create=function(e){return new t(e)},t}();function A(t){if(t||(t=Promise),!t)throw new Error("no Promise impl found");return t}var T=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),z=function(t){function e(e,r){var n=t.call(this)||this;return n.subject=e,n.subscriber=r,n.closed=!1,n}return h(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var r=e.indexOf(this.subscriber);-1!==r&&e.splice(r,1)}}},e}(g),D=function(t){function e(e){var r=t.call(this,e)||this;return r.destination=e,r}return h(e,t),e}(m),k=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return h(e,t),e.prototype[S]=function(){return new D(this)},e.prototype.lift=function(t){var e=new N(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new T;if(!this.isStopped)for(var e=this.observers,r=e.length,n=e.slice(),o=0;o<r;o++)n[o].next(t)},e.prototype.error=function(t){if(this.closed)throw new T;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,r=e.length,n=e.slice(),o=0;o<r;o++)n[o].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new T;this.isStopped=!0;for(var t=this.observers,e=t.length,r=t.slice(),n=0;n<e;n++)r[n].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new T;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new T;return this.hasError?(t.error(this.thrownError),g.EMPTY):this.isStopped?(t.complete(),g.EMPTY):(this.observers.push(t),new z(this,t))},e.prototype.asObservable=function(){var t=new P;return t.source=this,t},e.create=function(t,e){return new N(t,e)},e}(P),N=function(t){function e(e,r){var n=t.call(this)||this;return n.destination=e,n.source=r,n}return h(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):g.EMPTY},e}(k),M=function(t){function e(e){var r=t.call(this)||this;return r._value=e,r}return h(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var r=t.prototype._subscribe.call(this,e);return r&&!r.closed&&e.next(this._value),r},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new T;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(k);function V(t){return t&&"function"==typeof t.schedule}var F=function(t){return function(e){for(var r=0,n=t.length;r<n&&!e.closed;r++)e.next(t[r]);e.complete()}};function H(t,e){return e?function(t,e){return new P((function(r){var n=new g,o=0;return n.add(e.schedule((function(){o!==t.length?(r.next(t[o++]),r.closed||n.add(this.schedule())):r.complete()}))),n}))}(t,e):new P(F(t))}function C(t,e){return function(r){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new U(t,e))}}var U=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new R(t,this.project,this.thisArg))},t}(),R=function(t){function e(e,r,n){var o=t.call(this,e)||this;return o.project=r,o.count=0,o.thisArg=n||o,o}return h(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(m),I=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.notifyNext=function(t,e,r,n,o){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(m),G=function(t){function e(e,r,n){var o=t.call(this)||this;return o.parent=e,o.outerValue=r,o.outerIndex=n,o.index=0,o}return h(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(m);function K(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var $=K();var B=function(t){if(t&&"function"==typeof t[x])return o=t,function(t){var e=o[x]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if((n=t)&&"number"==typeof n.length&&"function"!=typeof n)return F(t);if(function(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}(t))return r=t,function(t){return r.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,b),t};if(t&&"function"==typeof t[$])return e=t,function(t){for(var r=e[$]();;){var n=void 0;try{n=r.next()}catch(e){return t.error(e),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}return"function"==typeof r.return&&t.add((function(){r.return&&r.return()})),t};var e,r,n,o,i=_(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+i+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function L(t,e,r,n,o){if(void 0===o&&(o=new G(t,r,n)),!o.closed)return e instanceof P?e.subscribe(o):B(e)(o)}var Y={};function q(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=void 0,n=void 0;return V(t[t.length-1])&&(n=t.pop()),"function"==typeof t[t.length-1]&&(r=t.pop()),1===t.length&&y(t[0])&&(t=t[0]),H(t,n).lift(new W(r))}var W=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new X(t,this.resultSelector))},t}(),X=function(t){function e(e,r){var n=t.call(this,e)||this;return n.resultSelector=r,n.active=0,n.values=[],n.observables=[],n}return h(e,t),e.prototype._next=function(t){this.values.push(Y),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var r=0;r<e;r++){var n=t[r];this.add(L(this,n,void 0,r))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,r){var n=this.values,o=n[r],i=this.toRespond?o===Y?--this.toRespond:this.toRespond:0;n[r]=e,0===i&&(this.resultSelector?this._tryResultSelector(n):this.destination.next(n.slice()))},e.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(I),J=function(t){function e(e){var r=t.call(this)||this;return r.parent=e,r}return h(e,t),e.prototype._next=function(t){this.parent.notifyNext(t)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}(m),Q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.destination.complete()},e}(m);function Z(t,e){return function(r){return r.lift(new tt(t,e))}}var tt=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new et(t,this.predicate,this.thisArg))},t}(),et=function(t){function e(e,r,n){var o=t.call(this,e)||this;return o.predicate=r,o.thisArg=n,o.count=0,o}return h(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},e}(m);var rt=function(){function t(t,e){this.keySelector=t,this.flushes=e}return t.prototype.call=function(t,e){return e.subscribe(new nt(t,this.keySelector,this.flushes))},t}(),nt=function(t){function e(e,r,n){var o=t.call(this,e)||this;return o.keySelector=r,o.values=new Set,n&&o.add(function(t,e){if(!e.closed)return t instanceof P?t.subscribe(e):B(t)(e)}(n,new J(o))),o}return h(e,t),e.prototype.notifyNext=function(){this.values.clear()},e.prototype.notifyError=function(t){this._error(t)},e.prototype._next=function(t){this.keySelector?this._useKeySelector(t):this._finalizeNext(t,t)},e.prototype._useKeySelector=function(t){var e,r=this.destination;try{e=this.keySelector(t)}catch(t){return void r.error(t)}this._finalizeNext(e,t)},e.prototype._finalizeNext=function(t,e){var r=this.values;r.has(t)||(r.add(t),this.destination.next(e))},e}(Q),ot="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var it=function(t,e,r){return t(r={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&r.path)}},r.exports),r.exports}((function(t,e){var r="__lodash_hash_undefined__",n=9007199254740991,o="[object Arguments]",i="[object Array]",s="[object Boolean]",u="[object Date]",c="[object Error]",a="[object Function]",h="[object Map]",f="[object Number]",p="[object Object]",l="[object Promise]",b="[object RegExp]",d="[object Set]",y="[object String]",_="[object Symbol]",v="[object WeakMap]",g="[object ArrayBuffer]",w="[object DataView]",S=/^\[object .+?Constructor\]$/,m=/^(?:0|[1-9]\d*)$/,E={};E["[object Float32Array]"]=E["[object Float64Array]"]=E["[object Int8Array]"]=E["[object Int16Array]"]=E["[object Int32Array]"]=E["[object Uint8Array]"]=E["[object Uint8ClampedArray]"]=E["[object Uint16Array]"]=E["[object Uint32Array]"]=!0,E[o]=E[i]=E[g]=E[s]=E[w]=E[u]=E[c]=E[a]=E[h]=E[f]=E[p]=E[b]=E[d]=E[y]=E[v]=!1;var x="object"==typeof ot&&ot&&ot.Object===Object&&ot,j="object"==typeof self&&self&&self.Object===Object&&self,O=x||j||Function("return this")(),P=e&&!e.nodeType&&e,A=P&&t&&!t.nodeType&&t,T=A&&A.exports===P,z=T&&x.process,D=function(){try{return z&&z.binding&&z.binding("util")}catch(t){}}(),k=D&&D.isTypedArray;function N(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}function M(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r}function V(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r}var F,H,C,U=Array.prototype,R=Function.prototype,I=Object.prototype,G=O["__core-js_shared__"],K=R.toString,$=I.hasOwnProperty,B=(F=/[^.]+$/.exec(G&&G.keys&&G.keys.IE_PROTO||""))?"Symbol(src)_1."+F:"",L=I.toString,Y=RegExp("^"+K.call($).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),q=T?O.Buffer:void 0,W=O.Symbol,X=O.Uint8Array,J=I.propertyIsEnumerable,Q=U.splice,Z=W?W.toStringTag:void 0,tt=Object.getOwnPropertySymbols,et=q?q.isBuffer:void 0,rt=(H=Object.keys,C=Object,function(t){return H(C(t))}),nt=kt(O,"DataView"),it=kt(O,"Map"),st=kt(O,"Promise"),ut=kt(O,"Set"),ct=kt(O,"WeakMap"),at=kt(Object,"create"),ht=Ft(nt),ft=Ft(it),pt=Ft(st),lt=Ft(ut),bt=Ft(ct),dt=W?W.prototype:void 0,yt=dt?dt.valueOf:void 0;function _t(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function vt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function gt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function wt(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new gt;++e<r;)this.add(t[e])}function St(t){var e=this.__data__=new vt(t);this.size=e.size}function mt(t,e){var r=Ut(t),n=!r&&Ct(t),o=!r&&!n&&Rt(t),i=!r&&!n&&!o&&Bt(t),s=r||n||o||i,u=s?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],c=u.length;for(var a in t)!e&&!$.call(t,a)||s&&("length"==a||o&&("offset"==a||"parent"==a)||i&&("buffer"==a||"byteLength"==a||"byteOffset"==a)||Vt(a,c))||u.push(a);return u}function Et(t,e){for(var r=t.length;r--;)if(Ht(t[r][0],e))return r;return-1}function xt(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Z&&Z in Object(t)?function(t){var e=$.call(t,Z),r=t[Z];try{t[Z]=void 0;var n=!0}catch(t){}var o=L.call(t);n&&(e?t[Z]=r:delete t[Z]);return o}(t):function(t){return L.call(t)}(t)}function jt(t){return $t(t)&&xt(t)==o}function Ot(t,e,r,n,a){return t===e||(null==t||null==e||!$t(t)&&!$t(e)?t!=t&&e!=e:function(t,e,r,n,a,l){var v=Ut(t),S=Ut(e),m=v?i:Mt(t),E=S?i:Mt(e),x=(m=m==o?p:m)==p,j=(E=E==o?p:E)==p,O=m==E;if(O&&Rt(t)){if(!Rt(e))return!1;v=!0,x=!1}if(O&&!x)return l||(l=new St),v||Bt(t)?Tt(t,e,r,n,a,l):function(t,e,r,n,o,i,a){switch(r){case w:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case g:return!(t.byteLength!=e.byteLength||!i(new X(t),new X(e)));case s:case u:case f:return Ht(+t,+e);case c:return t.name==e.name&&t.message==e.message;case b:case y:return t==e+"";case h:var p=M;case d:var l=1&n;if(p||(p=V),t.size!=e.size&&!l)return!1;var v=a.get(t);if(v)return v==e;n|=2,a.set(t,e);var S=Tt(p(t),p(e),n,o,i,a);return a.delete(t),S;case _:if(yt)return yt.call(t)==yt.call(e)}return!1}(t,e,m,r,n,a,l);if(!(1&r)){var P=x&&$.call(t,"__wrapped__"),A=j&&$.call(e,"__wrapped__");if(P||A){var T=P?t.value():t,z=A?e.value():e;return l||(l=new St),a(T,z,r,n,l)}}if(!O)return!1;return l||(l=new St),function(t,e,r,n,o,i){var s=1&r,u=zt(t),c=u.length,a=zt(e).length;if(c!=a&&!s)return!1;var h=c;for(;h--;){var f=u[h];if(!(s?f in e:$.call(e,f)))return!1}var p=i.get(t);if(p&&i.get(e))return p==e;var l=!0;i.set(t,e),i.set(e,t);var b=s;for(;++h<c;){var d=t[f=u[h]],y=e[f];if(n)var _=s?n(y,d,f,e,t,i):n(d,y,f,t,e,i);if(!(void 0===_?d===y||o(d,y,r,n,i):_)){l=!1;break}b||(b="constructor"==f)}if(l&&!b){var v=t.constructor,g=e.constructor;v==g||!("constructor"in t)||!("constructor"in e)||"function"==typeof v&&v instanceof v&&"function"==typeof g&&g instanceof g||(l=!1)}return i.delete(t),i.delete(e),l}(t,e,r,n,a,l)}(t,e,r,n,Ot,a))}function Pt(t){return!(!Kt(t)||function(t){return!!B&&B in t}(t))&&(It(t)?Y:S).test(Ft(t))}function At(t){if(r=(e=t)&&e.constructor,n="function"==typeof r&&r.prototype||I,e!==n)return rt(t);var e,r,n,o=[];for(var i in Object(t))$.call(t,i)&&"constructor"!=i&&o.push(i);return o}function Tt(t,e,r,n,o,i){var s=1&r,u=t.length,c=e.length;if(u!=c&&!(s&&c>u))return!1;var a=i.get(t);if(a&&i.get(e))return a==e;var h=-1,f=!0,p=2&r?new wt:void 0;for(i.set(t,e),i.set(e,t);++h<u;){var l=t[h],b=e[h];if(n)var d=s?n(b,l,h,e,t,i):n(l,b,h,t,e,i);if(void 0!==d){if(d)continue;f=!1;break}if(p){if(!N(e,(function(t,e){if(s=e,!p.has(s)&&(l===t||o(l,t,r,n,i)))return p.push(e);var s}))){f=!1;break}}else if(l!==b&&!o(l,b,r,n,i)){f=!1;break}}return i.delete(t),i.delete(e),f}function zt(t){return function(t,e,r){var n=e(t);return Ut(t)?n:function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}(n,r(t))}(t,Lt,Nt)}function Dt(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function kt(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return Pt(r)?r:void 0}_t.prototype.clear=function(){this.__data__=at?at(null):{},this.size=0},_t.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},_t.prototype.get=function(t){var e=this.__data__;if(at){var n=e[t];return n===r?void 0:n}return $.call(e,t)?e[t]:void 0},_t.prototype.has=function(t){var e=this.__data__;return at?void 0!==e[t]:$.call(e,t)},_t.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=at&&void 0===e?r:e,this},vt.prototype.clear=function(){this.__data__=[],this.size=0},vt.prototype.delete=function(t){var e=this.__data__,r=Et(e,t);return!(r<0)&&(r==e.length-1?e.pop():Q.call(e,r,1),--this.size,!0)},vt.prototype.get=function(t){var e=this.__data__,r=Et(e,t);return r<0?void 0:e[r][1]},vt.prototype.has=function(t){return Et(this.__data__,t)>-1},vt.prototype.set=function(t,e){var r=this.__data__,n=Et(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this},gt.prototype.clear=function(){this.size=0,this.__data__={hash:new _t,map:new(it||vt),string:new _t}},gt.prototype.delete=function(t){var e=Dt(this,t).delete(t);return this.size-=e?1:0,e},gt.prototype.get=function(t){return Dt(this,t).get(t)},gt.prototype.has=function(t){return Dt(this,t).has(t)},gt.prototype.set=function(t,e){var r=Dt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this},wt.prototype.add=wt.prototype.push=function(t){return this.__data__.set(t,r),this},wt.prototype.has=function(t){return this.__data__.has(t)},St.prototype.clear=function(){this.__data__=new vt,this.size=0},St.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},St.prototype.get=function(t){return this.__data__.get(t)},St.prototype.has=function(t){return this.__data__.has(t)},St.prototype.set=function(t,e){var r=this.__data__;if(r instanceof vt){var n=r.__data__;if(!it||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new gt(n)}return r.set(t,e),this.size=r.size,this};var Nt=tt?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var s=t[r];e(s,r,t)&&(i[o++]=s)}return i}(tt(t),(function(e){return J.call(t,e)})))}:function(){return[]},Mt=xt;function Vt(t,e){return!!(e=null==e?n:e)&&("number"==typeof t||m.test(t))&&t>-1&&t%1==0&&t<e}function Ft(t){if(null!=t){try{return K.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Ht(t,e){return t===e||t!=t&&e!=e}(nt&&Mt(new nt(new ArrayBuffer(1)))!=w||it&&Mt(new it)!=h||st&&Mt(st.resolve())!=l||ut&&Mt(new ut)!=d||ct&&Mt(new ct)!=v)&&(Mt=function(t){var e=xt(t),r=e==p?t.constructor:void 0,n=r?Ft(r):"";if(n)switch(n){case ht:return w;case ft:return h;case pt:return l;case lt:return d;case bt:return v}return e});var Ct=jt(function(){return arguments}())?jt:function(t){return $t(t)&&$.call(t,"callee")&&!J.call(t,"callee")},Ut=Array.isArray;var Rt=et||function(){return!1};function It(t){if(!Kt(t))return!1;var e=xt(t);return e==a||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}function Gt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}function Kt(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function $t(t){return null!=t&&"object"==typeof t}var Bt=k?function(t){return function(e){return t(e)}}(k):function(t){return $t(t)&&Gt(t.length)&&!!E[xt(t)]};function Lt(t){return null!=(e=t)&&Gt(e.length)&&!It(e)?mt(t):At(t);var e}t.exports=function(t,e){return Ot(t,e)}}));const st="initial",ut="process",ct="pending",at="complete",ht="next",ft="map set";const pt=(...t)=>{let e=t;do{e=e.reduce(((t,e)=>s(e)?[...t,...e]:[...t,e]),[])}while(e.some(s));return e};var lt=t=>{do{t=pt(t)}while(t.some(s));return t};const bt=t=>{if(t instanceof Map)return t;if(t&&u(t)){const e=new Map;return Object.keys(t).forEach((r=>e.set(r,t[r]))),e}return new Map};class dt{constructor(t,e,r,n="initial"){this._action=e,this.target=t,this.stageSubject=new M(n),this.subject=new M(r),this.stream=q([this.subject,this.stageSubject]).pipe(C((([t,e])=>({value:t,stage:e,action:this.action})))),this.output=null}nextStage(t){this.stageSubject.next(t)}get action(){return this._action}get stage(){return this.stageSubject.value}complete(){this.subject.complete(),this.stageSubject.complete()}}["isStopped","hasError","thrownError","value"].forEach((t=>{const e={configurable:!1,enumerable:!0,get(){return this.subject[t]}};Object.defineProperty(dt.prototype,t,e)})),["subscribe","pipe"].forEach((t=>{const e={configurable:!1,enumerable:!1,get(){return(...e)=>this.stream[t](...e)}};Object.defineProperty(dt.prototype,t,e)})),["error","next"].forEach((t=>{const e={configurable:!1,enumerable:!1,get(){return(...e)=>this.subject[t](...e)}};Object.defineProperty(dt.prototype,t,e)}));const yt=[st,ct,at],_t=[st,ut,ct,at],vt=Symbol("default stages"),gt=_t,wt=t=>{s(t)||(t=[]);let e=t.filter((t=>!yt.includes(t)));return e=(t=>s(t)?t.reduce(((t,e)=>t.includes(e)?t:[...t,e]),[]):[])(lt([st,e,ut,ct,at])).filter(n),e};class St{constructor(t=null,e={}){this.extend(e),this._watchForNext(),this._watchForActions(),this.next(t)}extend(t){if(!t||!u(t))return this;const e=bt(t);return e.has("actions")&&this.addActions(e.get("actions")),e.has("nextStages")&&this.setStages(ht,e.get("nextStages")),e.has("defaultStages")&&this.setDefaultStages(e.get("defaultStages")),e.has("actionStages")&&bt(e.get("actionStages")).forEach(((t,e)=>this.setStages(e,t))),this}execute(t,e,n=r){const o=new dt(this,t,e);var i,s;o.pipe((i=({stage:t})=>t,function(t){return t.lift(new rt(i,s))})).subscribe((()=>{this.eventSubject.next(o)}),(()=>{this.errorSubject.next(o)}));let u=n;return u=n===r?this.stagesFor(t):wt(n),u.forEach((t=>{t&&!o.isStopped&&o.nextStage(t)})),o.isStopped||o.complete(),o}next(t){return this.execute(ht,t)}_watchForNext(){this.on({action:ht,stage:at},(t=>{this._valueSubject.next(t.value),t.hasError||this.errorSubject.next(!1)}))}on(t,e){if(!i(e))throw new Error("on must end in a function");if(c(t))return this.on({action:t},e);let r;if(u(t)){const e=Array.from(Object.keys(t));r=this.eventSubject.pipe(Z((r=>!r.hasError&&e.reduce(((e,n)=>{if(!e)return e;const o=t[n],a=r[n];return i(o)?o(a,r,this):o instanceof RegExp?c(a)&&o.test(a):s(o)?o.includes(a):u(o)?it(o,a):o===a}),!0))))}else{if(!i(t))throw new Error("on requires object or functional condition");r=this.eventSubject.pipe(Z((t=>!t.hasError)),Z((e=>t(e,this))))}const n=r.subscribe((t=>{try{e(t)}catch(e){t.error(e)}}));return this.subSets.add(n),n}_watchForActions(){this.on(((t,e)=>{const r=t.stage===ut,n=e.actions.has(t.action);return r&&n}),(t=>{if(t.hasError)return;const e=s(t.value)?t.value:[];try{t.output=this.actions.get(t.action)(...e)}catch(e){t.error(e)}}))}setDefaultStages(t){if(!s(t))throw new Error("must be an array");return this.setStages(vt,t),this}setNextStages(...t){return this.setStages(ht,t),this}setStages(t,e){return this._stages.set(t,wt(e)),this}stagesFor(t){return t===ft?gt:this._stages.has(t)?this._stages.get(t):this._stages.has(vt)?this._stages.get(vt):_t}get _changePipe(){if(!this.__changePipe){let t=new Set;this.__changePipe=new M(t),this.on({stage:st},(e=>{if(!t.has(e)){t=new Set(t),t.add(e),this.__changePipe.next(t);const r=()=>{t=new Set(t),t.delete(e),this.__changePipe.next(t)};e.subscribe(n,r,r)}}))}return this.__changePipe}preprocess(t){return this.on({action:ht,stage:st},(e=>{e.next(t(e.value,this))})),this}_bindToChange(t){return q(t,this._changePipe).pipe(Z((([t,e])=>0===e.size)),C((([t])=>t)))}get changeSubject(){return this.__distinctSubject||(this.__distinctSubject=this._bindToChange(this._valueSubject)),this.__distinctSubject}addActions(t){if(!u(t))throw new Error("non-obj set to addActions");return bt(t).forEach(((t,e)=>{if(s(t)){if(i(t[0]))return void this.action(e,...t)}else if(i(t))return void this.action(e,t);console.log("bad action definition:",e,t)})),this}get _proxyHandler(){return this.__proxyHandler||(this.__proxyHandler={get:(t,e)=>(...r)=>{const n=t.execute(e,r);if(n.hasError)throw n.thrownError;return n.output}}),this.__proxyHandler}_updateDoNoProxy(){this._do={},this.actions.forEach(((t,e)=>this._do[e]=(...t)=>{const r=this.execute(e,t);if(r.hasError)throw r.thrownError;return"output"in r?r.output:r}))}get do(){return this._do||this._updateDo(!0),this._do}_updateDo(t){"undefined"!=typeof Proxy?this._do||(this._do=new Proxy(this,this._proxyHandler)):this._updateDoNoProxy(t)}action(t,e,n=r){if(this.actions.has(t))throw new Error(`cannot rename ${t}`);return this.actions.set(t,((...t)=>e(this,...t))),s(n)&&this.setStages(t,n),this._updateDo(),this}get actions(){return this._actions||(this._actions=new Map),this._actions}complete(){this.subSets.forEach((t=>t.complete())),this._valueSubject.complete(),this._eventSubject.complete()}}["isStopped","hasError","thrownError","value"].forEach((t=>{const e={configurable:!1,enumerable:!0,get(){return this._valueSubject[t]}};Object.defineProperty(St.prototype,t,e)})),["subscribe","pipe"].forEach((t=>{const e={configurable:!1,enumerable:!1,get(){return(...e)=>this.changeSubject[t](...e)}};Object.defineProperty(St.prototype,t,e)})),e.proppify(St).addProp("subSets",(()=>new Set)).addProp("_stages",(()=>new Map)).addProp("parent",null).addProp("eventSubject",(()=>new k)).addProp("errorSubject",(()=>new k)).addProp("_valueSubject",(()=>new M));const mt=/^set([\w].*)/;var Et=(t,e)=>{if(t.stage!==ut)return!1;if(e.actions.has(t.action))return!1;if(!c(t.action))return!1;return mt.test(t.action)};const xt=/^set([\w].*)/;class jt extends St{constructor(t,e,...r){super(t,e,...r),this._valueToStreams(t),this._watchForMapSet(),this._watchForKeySet()}watch(...t){const e=lt(t).filter((t=>this.streams.has(t))),r=e.map((t=>{const e=this.streams.get(t);return e.changeSubject?e.changeSubject:e}));return this._watchStream(e,r)}_watchStream(t,e){throw new Error("_watchStream must be implemented by concrete class")}forEach(t,e){throw new Error("must be overrirdden by implementing class")}_valueToStreams(t){this.forEach(t,((t,e)=>{this.createStream(e,t)}))}_updateDoNoProxy(){super._updateDoNoProxy(),this.streams.forEach(((t,e)=>{const r=`set${n=e,c(n)?n.charAt(0).toUpperCase()+n.slice(1):""}`;var n;this.do[r]=(...t)=>{this.execute(r,t)}}))}_watchForKeySet(){this.on(Et,(t=>{const e=xt.exec(t.action),r=(n=e[1],c(n)?n.charAt(0).toLowerCase()+n.slice(1):"");var n;this.set(r,t.value[0])}))}set(t,e){return this.execute(ft,{name:t,value:e})}_watchForMapSet(){this.on({action:ft,stage:ct},(t=>{const{name:e,value:r}=t.value;this.streams.has(e)&&(this.streams.get(e).next(r),t.complete())})),this.on({action:ft,stage:at},(t=>{const{name:e,value:r}=t.value;this._updateKeyValue(e,r)}))}_updateKeyValue(t,e){throw new Error("must be overridden")}get(t){throw new Error("must be overridden")}get my(){return"undefined"==typeof Proxy?this.asObject():(this._my||(this._my=new Proxy(this,{get:(t,e)=>t.get(e)})),this._my)}asObject(){const t={};return this.value.forEach(((e,r)=>{try{t[r]=e}catch(t){}})),t}addStream(t,e){return this.streams.has(t)&&this.streams.get(t).complete(),this.subSets.add(e.subscribe((e=>{this._updateKeyValue(t,e)}))),this.streams.set(t,e),this.set(t,this.my[t]),this}createStream(t,e){const r=new M(e);return this.addStream(t,r),r}}e.proppify(jt).addProp("streams",(()=>new Map));return{STAGE_PERFORM:"perform",STAGE_PENDING:ct,STAGE_COMPLETE:at,STAGE_BEGIN:st,STAGE_PROCESS:ut,ACTION_NEXT:ht,validators:o,ValueStream:St,ValueStore:jt,ValueStoreMap:class extends jt{constructor(t,e){super(bt(t),e)}forEach(t,e){t.forEach(e)}_updateKeyValue(t,e){const r=new Map(this.value);return r.set(t,e),this.next(r)}get(t){return this.value.get(t)}_watchStream(t,e){return q(e).pipe(C((e=>{const r=new Map;return t.forEach(((t,n)=>{r.set(t,e[n])})),r})))}},ValueStoreObject:class extends jt{forEach(t,e){Object.keys(t).forEach((r=>e(t[r],r)))}_updateKeyValue(t,e){const r={...this.value};return r[t]=e,this.next(r)}get(t){return this.value[t]}_watchStream(t,e){return q(e).pipe(C((e=>{const r={};return t.forEach(((t,n)=>{r[t]=e[n]})),r})))}},ABSENT:r,Change:dt}}));
