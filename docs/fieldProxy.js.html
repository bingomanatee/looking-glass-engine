<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: fieldProxy.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: fieldProxy.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { e } from './constants';

function _fieldProxy(target) {
  return new Proxy(target, {
    get(tgt, key) {
      console.log('target: ', tgt, 'target fieldSubjects', tgt.fieldSubjects)
      if (!tgt.fieldSubjects.has(key)) console.log('attempt to get undefined fieldSubject', key);
      return tgt.fieldSubjects.get(key);
    },
  });
}

function addFn(key, stream) {
  if (!this.fieldSubjects.has(key)) {
    this.fieldSubjects.set(key, stream);
    const sub = stream.subscribe((value) => this.set(key, value, true));
    this.subscribe({
      complete() {
        sub.unsubscribe();
      },
    });
  } else {
    throw e(`cannot redefine field subject ${key}`, { key, stream, target: this });
  }
}

export default function (classDef) {
  // noinspection ES6ShorthandObjectProperty
  /**
     * adds a stream whose values are transported to a key in the map's value.
     * @param key {string}
     * @param stream {Subject} any RxJS subject or a ValueStream/ValueMapStream
     */
  Object.defineProperty(
    classDef.prototype,
    'addFieldSubject',
    {
      value: addFn,
    },
  );

  /**
     * a proxy to the values in the value map
     * @returns {*}
     */

  function getFn() {
    if (!(typeof Proxy === 'undefined')) {
      if (!this._fields) {
        this._fields = _fieldProxy(this);
      }
      return this._fields;
    }
    return this._fieldObj;
  }
  Object.defineProperty(classDef.prototype,
    'fields',
    {
      get: getFn,
    });

  function subjectFn() {
    if (!this._fieldSubjects) this._fieldSubjects = new Map();
    return this._fieldSubjects;
  }

  Object.defineProperty(
    classDef.prototype,
    'fieldSubjects',
    {
      get: subjectFn,
    },
  );

  function foFn() {
    if (!(typeof Proxy === 'undefined')) {
      if (!this._fields) {
        this._fields = _fieldProxy(this);
      }
      return this._fields;
    }
    return this._fieldObj;
  }

  Object.defineProperty(
    classDef.prototype,
    '_fieldObj',
    {
      get: foFn,
    },
  );
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Event.html">Event</a></li><li><a href="EventFilter.html">EventFilter</a></li><li><a href="ValueMapStream.html">ValueMapStream</a></li><li><a href="ValueMapStreamFast.html">ValueMapStreamFast</a></li><li><a href="ValueObjectStream.html">ValueObjectStream</a></li><li><a href="ValueStream.html">ValueStream</a></li><li><a href="ValueStreamFast.html">ValueStreamFast</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Fri Feb 19 2021 12:21:33 GMT-0800 (Pacific Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
